<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math 2Ã¨me - Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['Amiri', 'serif'],
                    },
                    colors: {
                        'primary': '#5D5CDE',
                        'gold': '#FFD700',
                        'treasure': '#FFA500',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        
        body {
            font-family: 'Amiri', serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .door {
            transition: all 0.5s ease;
            cursor: pointer;
            position: relative;
            background: linear-gradient(45deg, #8B4513, #A0522D);
            border: 4px solid #654321;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .door:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .treasure {
            animation: bounce 1s infinite;
        }
        
        .monster {
            animation: shake 0.5s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .dragonball {
            animation: glow 2s infinite;
            background: radial-gradient(circle, #FF8C00, #FFD700);
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 165, 0, 1); }
        }
        
        .level-locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .level-unlocked {
            opacity: 1;
            cursor: pointer;
        }
        
        .challenge-button {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            animation: pulse 2s infinite;
        }
        
        .challenge-accept {
            background: linear-gradient(45deg, #059669, #10b981);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .online-indicator {
            background: #10b981;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #FFD700;
            background: linear-gradient(45deg, #333, #555);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto;
        }
        
        .monster-evolution {
            transition: all 0.5s ease;
            transform-origin: center;
        }
        
        .monster-evolution:hover {
            transform: scale(1.1);
        }
        
        .challenge-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .math-formula {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .real-time-update {
            animation: highlight 2s ease;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(34, 197, 94, 0.3); }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <!-- Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ… -->
    <div id="stars" class="fixed inset-0 z-0"></div>

    <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ -->
    <div id="challengeNotifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainMenu" class="relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <h1 class="text-4xl md:text-6xl font-bold mb-8 text-center bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
            Math 2Ã¨me
        </h1>
        <p class="text-xl mb-8 text-center text-gray-300">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© - Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</p>
        
        <div class="space-y-4 w-full max-w-md">
            <button onclick="showPlayerLogin()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors">
                Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù…ÙŠØ°
            </button>
            <button onclick="showTeacherLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors">
                Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø°
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù…ÙŠØ° -->
    <div id="playerLogin" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù…ÙŠØ°</h2>
            <input type="text" id="playerName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ°" class="w-full p-3 mb-4 text-black rounded-lg text-base">
            <button onclick="startGame()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨
            </button>
            <button onclick="showMainMenu()" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                Ø§Ù„Ø¹ÙˆØ¯Ø©
            </button>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø° -->
    <div id="teacherLogin" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø°</h2>
            <input type="password" id="teacherPassword" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ: 123456" class="w-full p-3 mb-4 text-black rounded-lg text-base">
            <button onclick="teacherLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                Ø¯Ø®ÙˆÙ„
            </button>
            <button onclick="showMainMenu()" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                Ø§Ù„Ø¹ÙˆØ¯Ø©
            </button>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ø£Ø³ØªØ§Ø° -->
    <div id="teacherDashboard" class="hidden relative z-10 p-4">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">ğŸ“ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³ØªØ§Ø°</h2>
                <div class="flex space-x-4">
                    <div class="text-sm">
                        Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate" class="text-green-400"></span>
                    </div>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                        Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ±ÙŠØ© -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-bold mb-2 text-green-400">ğŸŸ¢ Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</h3>
                    <div id="liveOnlineCount" class="text-3xl font-bold text-green-400">0</div>
                    <div id="liveOnlineList" class="text-xs mt-2 space-y-1"></div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-bold mb-2 text-blue-400">ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</h3>
                    <div id="totalStudents" class="text-3xl font-bold text-blue-400">0</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-bold mb-2 text-yellow-400">âš”ï¸ ØªØ­Ø¯ÙŠØ§Øª Ù†Ø´Ø·Ø©</h3>
                    <div id="activeChallenges" class="text-3xl font-bold text-yellow-400">0</div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-bold mb-2 text-purple-400">ğŸ‰ ÙƒØ±Ø§Øª Ù…ÙØ¬Ù…Ø¹Ø©</h3>
                    <div id="totalDragonBalls" class="text-3xl font-bold text-purple-400">0</div>
                </div>
            </div>

            <!-- Ù†Ø´Ø§Ø· Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„ÙÙˆØ±ÙŠ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-green-400">ğŸ® Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø¢Ù†</h3>
                    <div id="currentlyPlaying" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-yellow-400">ğŸ† Ø¢Ø®Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
                    <div id="recentAchievements" class="space-y-2 max-h-60 overflow-y-auto">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ -->
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4">ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="text-right p-2">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                                <th class="text-right p-2">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©</th>
                                <th class="text-right p-2">Ø§Ù„Ø§Ø³Ù…</th>
                                <th class="text-right p-2">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th class="text-right p-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                                <th class="text-right p-2">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                                <th class="text-right p-2">ÙƒØ±Ø§Øª Ø§Ù„Ø¯Ø±Ø§ØºÙˆÙ†</th>
                                <th class="text-right p-2">Ø§Ù„Ù†Ø´Ø§Ø·</th>
                                <th class="text-right p-2">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
    <div id="levelSelection" class="hidden relative z-10 p-4">
        <div class="max-w-6xl mx-auto">
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ© -->
            <div class="text-center mb-8">
                <div class="player-avatar monster-evolution mb-4" id="playerAvatar">
                    ğŸ¥š
                </div>
                <h2 class="text-3xl font-bold mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h2>
                <div id="playerInfo" class="text-xl text-gray-300 mb-4"></div>
                <div id="dragonBalls" class="flex justify-center space-x-2 mb-6"></div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
                <div class="flex justify-center space-x-4 mb-6">
                    <button id="challengeButton" onclick="showChallengeModal()" class="challenge-button text-white font-bold py-3 px-6 rounded-lg">
                        ğŸ”¥ ØªØ­Ø¯ÙŠ Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±
                    </button>
                    <button onclick="showOnlinePlayersModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">
                        ğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†
                    </button>
                </div>
                
                <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠ -->
                <div id="challengeStatus" class="hidden mt-4 p-4 bg-yellow-600 rounded-lg">
                    <div id="challengeMessage"></div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø³Ø¨Ø¹Ø© -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„ -->
                <div id="level1" onclick="selectLevel(1)" class="level-card bg-green-600 hover:bg-green-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„</h3>
                    <p class="text-sm mb-2">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
                    <p class="text-xs">â±ï¸ 45 Ø«Ø§Ù†ÙŠØ© | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div class="mt-2">âœ… Ù…ØªØ§Ø­</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
                <div id="level2" onclick="selectLevel(2)" class="level-card bg-blue-600 hover:bg-blue-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ</h3>
                    <p class="text-sm mb-2">Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø©</p>
                    <p class="text-xs">â±ï¸ 60 Ø«Ø§Ù†ÙŠØ© | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div class="mt-2">âœ… Ù…ØªØ§Ø­</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø« -->
                <div id="level3" onclick="selectLevel(3)" class="level-card bg-yellow-600 hover:bg-yellow-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«</h3>
                    <p class="text-sm mb-2">Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
                    <p class="text-xs">â±ï¸ 90 Ø«Ø§Ù†ÙŠØ© | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div class="mt-2">âœ… Ù…ØªØ§Ø­</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹ -->
                <div id="level4" onclick="selectLevel(4)" class="level-card bg-orange-600 hover:bg-orange-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹</h3>
                    <p class="text-sm mb-2">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©</p>
                    <p class="text-xs">â±ï¸ 2 Ø¯Ù‚ÙŠÙ‚Ø© | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div id="level4Lock" class="mt-2 text-red-400">ğŸ”’ ÙŠØ­ØªØ§Ø¬ 3 ÙƒØ±Ø§Øª</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³ -->
                <div id="level5" onclick="selectLevel(5)" class="level-card bg-purple-600 hover:bg-purple-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³</h3>
                    <p class="text-sm mb-2">Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</p>
                    <p class="text-xs">â±ï¸ 3 Ø¯Ù‚Ø§Ø¦Ù‚ | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div id="level5Lock" class="mt-2 text-red-400">ğŸ”’ ÙŠØ­ØªØ§Ø¬ 4 ÙƒØ±Ø§Øª</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¯Ø³ -->
                <div id="level6" onclick="selectLevel(6)" class="level-card bg-red-600 hover:bg-red-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¯Ø³</h3>
                    <p class="text-sm mb-2">Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù†ØµÙŠØ©</p>
                    <p class="text-xs">â±ï¸ 4 Ø¯Ù‚Ø§Ø¦Ù‚ | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div id="level6Lock" class="mt-2 text-red-400">ğŸ”’ ÙŠØ­ØªØ§Ø¬ 5 ÙƒØ±Ø§Øª</div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ø¹ -->
                <div id="level7" onclick="selectLevel(7)" class="level-card bg-pink-600 hover:bg-pink-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ø¹</h3>
                    <p class="text-sm mb-2">ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠØ©</p>
                    <p class="text-xs">â±ï¸ 5 Ø¯Ù‚Ø§Ø¦Ù‚ | ğŸ‰ ÙƒØ±Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div id="level7Lock" class="mt-2 text-red-400">ğŸ”’ ÙŠØ­ØªØ§Ø¬ 6 ÙƒØ±Ø§Øª</div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="showMainMenu()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ -->
    <div id="challengeModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h3 class="text-2xl font-bold mb-4 text-center">âš”ï¸ ØªØ­Ø¯ÙŠ Ù„Ø§Ø¹Ø¨</h3>
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù„Ù„ØªØ­Ø¯ÙŠ:</label>
                <select id="challengeLevel" class="w-full p-2 text-black rounded">
                    <option value="1">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„</option>
                    <option value="2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                    <option value="3">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                    <option value="4">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                    <option value="5">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³</option>
                    <option value="6">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                    <option value="7">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
                </select>
            </div>
            <div id="onlinePlayersList" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            <div class="flex justify-center space-x-3">
                <button onclick="closeChallengeModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† -->
    <div id="onlinePlayersModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-lg">
            <h3 class="text-2xl font-bold mb-4 text-center">ğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h3>
            <div id="onlinePlayersGrid" class="grid grid-cols-2 gap-4 mb-4 max-h-80 overflow-y-auto">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            <div class="text-center">
                <button onclick="closeOnlinePlayersModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div id="gameScreen" class="hidden relative z-10 p-4">
        <div class="max-w-4xl mx-auto">
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
            <div class="flex justify-between items-center mb-6 bg-gray-800 p-4 rounded-lg">
                <div class="text-lg font-bold">
                    <span id="currentScore">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</span>
                </div>
                <div class="text-lg font-bold">
                    <span id="timer" class="text-yellow-400">â±ï¸ 45</span>
                </div>
                <div class="text-lg font-bold">
                    <span id="questionNumber">Ø§Ù„Ø³Ø¤Ø§Ù„: 1/8</span>
                </div>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ (Ø¥Ù† ÙˆØ¬Ø¯) -->
            <div id="challengeInfo" class="hidden bg-red-800 p-4 rounded-lg mb-6">
                <div class="text-center">
                    <h3 class="text-xl font-bold mb-2">ğŸ”¥ ØªØ­Ø¯ÙŠ Ù…Ø¨Ø§Ø´Ø±</h3>
                    <div id="challengeOpponent" class="text-lg"></div>
                    <div class="flex justify-center space-x-8 mt-2">
                        <div>Ø£Ù†Øª: <span id="myScore" class="font-bold">0</span></div>
                        <div>Ø§Ù„Ø®ØµÙ…: <span id="opponentScore" class="font-bold">0</span></div>
                    </div>
                    <div class="mt-2">
                        <div class="text-sm">ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: <span id="myTime" class="font-bold">-</span> Ø«Ø§Ù†ÙŠØ©</div>
                        <div class="text-sm">ÙˆÙ‚Øª Ø§Ù„Ø®ØµÙ…: <span id="opponentTime" class="font-bold">-</span> Ø«Ø§Ù†ÙŠØ©</div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ -->
            <div class="text-center mb-8">
                <div id="questionText" class="text-2xl md:text-3xl font-bold mb-4 bg-gray-800 p-6 rounded-lg math-formula"></div>
            </div>

            <!-- Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«Ø© -->
            <div id="doorsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(0)">
                    <div class="text-xl font-bold mb-2">ğŸšª Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ„</div>
                    <div id="option0" class="text-lg"></div>
                </div>
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(1)">
                    <div class="text-xl font-bold mb-2">ğŸšª Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</div>
                    <div id="option1" class="text-lg"></div>
                </div>
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(2)">
                    <div class="text-xl font-bold mb-2">ğŸšª Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù„Ø«</div>
                    <div id="option2" class="text-lg"></div>
                </div>
            </div>

            <!-- Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
            <div id="answerResult" class="hidden text-center">
                <div id="resultIcon" class="text-6xl mb-4"></div>
                <div id="resultText" class="text-2xl font-bold mb-4"></div>
                <div id="answerTime" class="text-lg mb-4"></div>
                <button id="nextQuestion" onclick="nextQuestion()" class="bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
                </button>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="gameEnd" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-lg text-center">
            <h2 class="text-3xl font-bold mb-4">ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
            <div id="finalScore" class="text-2xl mb-4"></div>
            
            <!-- Ù…ÙƒØ§ÙØ£Ø© ÙƒØ±Ø© Ø§Ù„Ø¯Ø±Ø§ØºÙˆÙ† -->
            <div id="dragonBallReward" class="hidden mb-6">
                <div class="dragonball w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold mb-4">
                    ğŸ‰
                </div>
                <div class="text-xl font-bold text-yellow-400">Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ÙƒØ±Ø© Ø¯Ø±Ø§ØºÙˆÙ† Ø¨ÙˆÙ„!</div>
                <div id="monsterEvolution" class="hidden mt-4">
                    <div class="text-lg text-green-400">ÙˆØ­Ø´Ùƒ ØªØ·ÙˆØ±! ğŸ§¬</div>
                    <div id="newMonster" class="text-4xl mt-2"></div>
                </div>
                <div id="newLevelUnlocked" class="hidden mt-2 text-green-400"></div>
            </div>
            
            <!-- Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ù„Ø¬Ù…Ø¹ 7 ÙƒØ±Ø§Øª -->
            <div id="encouragementMessage" class="hidden mb-6 p-4 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg">
                <div class="text-2xl font-bold mb-2">ğŸŠ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ğŸŠ</div>
                <div id="careerMessage" class="text-lg"></div>
                <div class="mt-4 text-6xl">ğŸ‘¨â€âš•ï¸</div>
            </div>
            
            <!-- Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠ -->
            <div id="challengeResult" class="hidden mb-6 p-4 rounded-lg">
                <div id="challengeOutcome" class="text-xl font-bold mb-2"></div>
                <div id="challengeDetails" class="text-sm"></div>
            </div>
            
            <div class="space-y-3">
                <button onclick="showLevelSelection()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                </button>
                <button onclick="showMainMenu()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø¹Ø¨Ø©
        class RealTimeGameSystem {
            constructor() {
                this.data = {
                    players: {},
                    onlinePlayers: new Map(), // name -> timestamp
                    challenges: {},
                    gameHistory: [],
                    liveActivity: []
                };
                this.loadData();
                this.startRealTimeSync();
                this.playerId = null;
                this.lastHeartbeat = Date.now();
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
            loadData() {
                try {
                    const saved = sessionStorage.getItem('mathGameRealTime');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.data.players = parsed.players || {};
                        this.data.gameHistory = parsed.gameHistory || [];
                        this.data.liveActivity = parsed.liveActivity || [];
                        this.data.challenges = parsed.challenges || {};
                    }
                } catch (e) {
                    console.log('Could not load from storage');
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            save() {
                try {
                    const dataToSave = {
                        players: this.data.players,
                        gameHistory: this.data.gameHistory,
                        liveActivity: this.data.liveActivity,
                        challenges: this.data.challenges,
                        lastUpdate: Date.now()
                    };
                    sessionStorage.setItem('mathGameRealTime', JSON.stringify(dataToSave));
                    
                    // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…
                    this.broadcastUpdate();
                } catch (e) {
                    console.log('Storage not available');
                }
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
            startRealTimeSync() {
                // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setInterval(() => {
                    this.updateOnlineStatus();
                    this.cleanupOldActivity();
                    if (isTeacher) {
                        this.updateTeacherDashboard();
                    }
                    this.processChallenge();
                }, 2000);
                
                // Ù†Ø¨Ø¶Ø© Ø§ØªØµØ§Ù„ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
                setInterval(() => {
                    if (this.playerId) {
                        this.sendHeartbeat();
                    }
                }, 5000);
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ù„Ø§Ø¹Ø¨ ÙƒÙ…ØªØµÙ„
            setPlayerOnline(name, currentActivity = 'ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©') {
                this.data.onlinePlayers.set(name, {
                    timestamp: Date.now(),
                    activity: currentActivity,
                    lastSeen: Date.now()
                });
                this.playerId = name;
                this.logActivity(name, 'Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©', 'login');
                this.save();
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ø´Ø§Ø· Ø§Ù„Ù„Ø§Ø¹Ø¨
            updatePlayerActivity(name, activity, details = null) {
                if (this.data.onlinePlayers.has(name)) {
                    const playerInfo = this.data.onlinePlayers.get(name);
                    playerInfo.activity = activity;
                    playerInfo.lastSeen = Date.now();
                    if (details) {
                        playerInfo.details = details;
                    }
                    this.logActivity(name, activity, 'activity', details);
                    this.save();
                }
            }
            
            // Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø© Ø§ØªØµØ§Ù„
            sendHeartbeat() {
                if (this.data.onlinePlayers.has(this.playerId)) {
                    const playerInfo = this.data.onlinePlayers.get(this.playerId);
                    playerInfo.lastSeen = Date.now();
                    this.lastHeartbeat = Date.now();
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            updateOnlineStatus() {
                const now = Date.now();
                const timeout = 15000; // 15 Ø«Ø§Ù†ÙŠØ© Ø§Ù†Ù‚Ø·Ø§Ø¹
                
                for (let [name, info] of this.data.onlinePlayers) {
                    if (now - info.lastSeen > timeout) {
                        this.setPlayerOffline(name);
                    }
                }
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ù„Ø§Ø¹Ø¨ ÙƒØºÙŠØ± Ù…ØªØµÙ„
            setPlayerOffline(name) {
                if (this.data.onlinePlayers.has(name)) {
                    this.logActivity(name, 'Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©', 'logout');
                    this.data.onlinePlayers.delete(name);
                    this.save();
                }
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø·
            logActivity(playerName, activity, type = 'activity', details = null) {
                const activityEntry = {
                    player: playerName,
                    activity: activity,
                    type: type,
                    details: details,
                    timestamp: Date.now()
                };
                
                this.data.liveActivity.unshift(activityEntry);
                this.data.liveActivity = this.data.liveActivity.slice(0, 50); // Ø§Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± 50 Ù†Ø´Ø§Ø·
            }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            cleanupOldActivity() {
                const oneHourAgo = Date.now() - (60 * 60 * 1000);
                this.data.liveActivity = this.data.liveActivity.filter(
                    activity => activity.timestamp > oneHourAgo
                );
            }
            
            // Ø¨Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ«
            broadcastUpdate() {
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ø°Ø§ Ø³ÙŠØ±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø£Ø³ØªØ§Ø°
                if (isTeacher) {
                    this.updateTeacherDashboard();
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
            updateTeacherDashboard() {
                if (!isTeacher) return;
                
                const onlinePlayersArray = Array.from(this.data.onlinePlayers.entries());
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
                document.getElementById('liveOnlineCount').textContent = onlinePlayersArray.length;
                document.getElementById('totalStudents').textContent = Object.keys(this.data.players).length;
                document.getElementById('activeChallenges').textContent = Object.keys(this.data.challenges).length;
                
                // Ø­Ø³Ø§Ø¨ Ù…Ø¬Ù…ÙˆØ¹ ÙƒØ±Ø§Øª Ø§Ù„Ø¯Ø±Ø§ØºÙˆÙ†
                const totalDragonBalls = Object.values(this.data.players)
                    .reduce((sum, player) => sum + (player.dragonBalls || 0), 0);
                document.getElementById('totalDragonBalls').textContent = totalDragonBalls;
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
                const liveOnlineList = document.getElementById('liveOnlineList');
                liveOnlineList.innerHTML = '';
                onlinePlayersArray.forEach(([name, info]) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between real-time-update';
                    div.innerHTML = `
                        <span class="text-xs">${name}</span>
                        <span class="text-xs text-gray-400">${this.getTimeAgo(info.lastSeen)}</span>
                    `;
                    liveOnlineList.appendChild(div);
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
                this.updateCurrentlyPlaying();
                this.updateRecentAchievements();
                
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ar-DZ');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ø°ÙŠÙ† ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø¢Ù†
            updateCurrentlyPlaying() {
                const currentlyPlaying = document.getElementById('currentlyPlaying');
                currentlyPlaying.innerHTML = '';
                
                const playingNow = Array.from(this.data.onlinePlayers.entries())
                    .filter(([name, info]) => info.activity.includes('ÙŠÙ„Ø¹Ø¨'));
                
                if (playingNow.length === 0) {
                    currentlyPlaying.innerHTML = '<div class="text-gray-400 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ„Ø§Ù…ÙŠØ° ÙŠÙ„Ø¹Ø¨ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                } else {
                    playingNow.forEach(([name, info]) => {
                        const div = document.createElement('div');
                        div.className = 'bg-gray-700 p-3 rounded flex items-center justify-between real-time-update';
                        div.innerHTML = `
                            <div>
                                <div class="font-bold">${name}</div>
                                <div class="text-sm text-gray-400">${info.activity}</div>
                                ${info.details ? `<div class="text-xs text-blue-400">${info.details}</div>` : ''}
                            </div>
                            <div class="online-indicator"></div>
                        `;
                        currentlyPlaying.appendChild(div);
                    });
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
            updateRecentAchievements() {
                const recentAchievements = document.getElementById('recentAchievements');
                recentAchievements.innerHTML = '';
                
                const achievements = this.data.liveActivity
                    .filter(activity => activity.type === 'achievement')
                    .slice(0, 10);
                
                if (achievements.length === 0) {
                    recentAchievements.innerHTML = '<div class="text-gray-400 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø­Ø¯ÙŠØ«Ø©</div>';
                } else {
                    achievements.forEach(achievement => {
                        const div = document.createElement('div');
                        div.className = 'bg-gray-700 p-2 rounded text-sm real-time-update';
                        div.innerHTML = `
                            <div class="font-bold text-yellow-400">${achievement.player}</div>
                            <div>${achievement.activity}</div>
                            <div class="text-xs text-gray-400">${this.getTimeAgo(achievement.timestamp)}</div>
                        `;
                        recentAchievements.appendChild(div);
                    });
                }
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
            getTimeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                if (seconds < 60) return `${seconds} Ø«Ø§Ù†ÙŠØ©`;
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
                const hours = Math.floor(minutes / 60);
                return `${hours} Ø³Ø§Ø¹Ø©`;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠ
            createChallenge(challenger, opponent, level) {
                const challengeId = Date.now().toString();
                this.data.challenges[challengeId] = {
                    id: challengeId,
                    challenger: challenger,
                    opponent: opponent,
                    level: level,
                    status: 'pending',
                    scores: {},
                    answers: {},
                    times: {},
                    startTime: null,
                    endTime: null,
                    createdAt: Date.now()
                };
                
                this.logActivity(challenger, `Ø£Ø±Ø³Ù„ ØªØ­Ø¯ÙŠ Ø¥Ù„Ù‰ ${opponent}`, 'challenge');
                this.save();
                return challengeId;
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠ
            processChallenge() {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ÙŠÙƒÙˆÙ† Ø¹Ø¨Ø± Ø§Ù„Ø´Ø¨ÙƒØ©)
                Object.values(this.data.challenges).forEach(challenge => {
                    if (challenge.status === 'pending' && Date.now() - challenge.createdAt > 5000) {
                        // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
                        this.acceptChallenge(challenge.id);
                    }
                });
            }
            
            // Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ
            acceptChallenge(challengeId) {
                if (this.data.challenges[challengeId]) {
                    this.data.challenges[challengeId].status = 'accepted';
                    this.data.challenges[challengeId].startTime = Date.now();
                    this.logActivity(
                        this.data.challenges[challengeId].opponent, 
                        `Ù‚Ø¨Ù„ ØªØ­Ø¯ÙŠ ${this.data.challenges[challengeId].challenger}`, 
                        'challenge'
                    );
                    this.save();
                }
            }
            
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
            createPlayer(name) {
                this.data.players[name] = {
                    name: name,
                    totalScore: 0,
                    currentLevel: 1,
                    dragonBalls: 0,
                    levelsCompleted: [],
                    lastPlayed: new Date().toISOString(),
                    gamesPlayed: 0,
                    challengesWon: 0,
                    challengesLost: 0,
                    createdAt: Date.now()
                };
                this.save();
                return this.data.players[name];
            }
            
            getPlayer(name) {
                return this.data.players[name] || this.createPlayer(name);
            }
            
            updatePlayer(name, updates) {
                if (this.data.players[name]) {
                    Object.assign(this.data.players[name], updates);
                    this.data.players[name].lastPlayed = new Date().toISOString();
                    this.save();
                }
            }
            
            deletePlayer(name) {
                delete this.data.players[name];
                this.setPlayerOffline(name);
                this.save();
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¥Ù†Ø¬Ø§Ø²
            recordAchievement(playerName, achievement, details = null) {
                this.logActivity(playerName, achievement, 'achievement', details);
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø³ØªØ§Ø°
                if (isTeacher) {
                    this.showNotification(`ğŸ† ${playerName}: ${achievement}`, 'achievement');
                }
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `challenge-notification ${type === 'achievement' ? 'bg-green-600' : ''}`;
                notification.innerHTML = `
                    <div class="font-bold">${message}</div>
                    <button onclick="this.parentElement.remove()" class="float-right text-xl">&times;</button>
                `;
                
                document.getElementById('challengeNotifications').appendChild(notification);
                
                // Ø¥Ø²Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // Ù†Ø¸Ø§Ù… ØªØ·ÙˆØ± Ø§Ù„ÙˆØ­ÙˆØ´
        const monsterEvolution = {
            0: { emoji: 'ğŸ¥š', name: 'Ø§Ù„Ø¨ÙŠØ¶Ø©', description: 'Ù…Ø§Ø²Ù„Øª ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©' },
            1: { emoji: 'ğŸ›', name: 'Ø§Ù„ÙŠØ±Ù‚Ø©', description: 'Ø¨Ø¯Ø§ÙŠØ© Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…' },
            2: { emoji: 'ğŸ£', name: 'Ø§Ù„ÙØ±Ø®', description: 'ØªØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª' },
            3: { emoji: 'ğŸ¦‹', name: 'Ø§Ù„ÙØ±Ø§Ø´Ø©', description: 'ØªØ­Ù„Ù‚ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª' },
            4: { emoji: 'ğŸ‰', name: 'Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„ØµØºÙŠØ±', description: 'Ù‚ÙˆØ© Ù…ØªÙ†Ø§Ù…ÙŠØ©' },
            5: { emoji: 'ğŸ”¥', name: 'Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ù†Ø§Ø±ÙŠ', description: 'ØªØªÙ‚Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª' },
            6: { emoji: 'âš¡', name: 'Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ø¨Ø±Ù‚ÙŠ', description: 'Ø³Ø±Ø¹Ø© Ø®Ø§Ø±Ù‚Ø© ÙÙŠ Ø§Ù„Ø­Ù„' },
            7: { emoji: 'ğŸŒŸ', name: 'Ø³ÙŠØ¯ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', description: 'ÙˆØµÙ„Øª Ù„Ù„Ù…Ø¬Ø¯!' }
        };

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
        const gameSystem = new RealTimeGameSystem();

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let currentPlayer = '';
        let currentLevel = 1;
        let currentQuestion = 0;
        let score = 0;
        let timeLeft = 45;
        let timer = null;
        let questions = [];
        let isTeacher = false;
        let gameStartTime = null;
        let currentChallenge = null;
        let questionStartTime = null;

        // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù†ÙØ³ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¹ ØªØµØ­ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª)
        const questionBank = {
            1: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„: Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 15 + 3 Ã— 4 = ØŸ",
                    options: ["27", "72", "24"],
                    correct: 0,
                    explanation: "Ù†Ø·Ø¨Ù‚ Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: Ø§Ù„Ø¶Ø±Ø¨ Ø£ÙˆÙ„Ø§Ù‹ 3Ã—4=12ØŒ Ø«Ù… Ø§Ù„Ø¬Ù…Ø¹ 15+12=27"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 24 Ã· 6 + 8 = ØŸ",
                    options: ["12", "2", "32"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù‚Ø³Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹: 24Ã·6=4ØŒ Ø«Ù… Ø§Ù„Ø¬Ù…Ø¹ 4+8=12"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 5 Ã— 6 - 18 Ã· 3 = ØŸ",
                    options: ["24", "4", "36"],
                    correct: 0,
                    explanation: "Ø§Ù„Ø¶Ø±Ø¨ ÙˆØ§Ù„Ù‚Ø³Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹: 5Ã—6=30ØŒ 18Ã·3=6ØŒ Ø«Ù… Ø§Ù„Ø·Ø±Ø­ 30-6=24"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 48 Ã· 8 + 7 Ã— 2 = ØŸ",
                    options: ["20", "110", "6"],
                    correct: 0,
                    explanation: "48Ã·8=6ØŒ 7Ã—2=14ØŒ Ø«Ù… 6+14=20"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 9 + 12 Ã· 4 - 2 = ØŸ",
                    options: ["10", "7.25", "19"],
                    correct: 0,
                    explanation: "12Ã·4=3ØŒ Ø«Ù… Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 9+3-2=10"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 6 Ã— 7 - 3 Ã— 8 = ØŸ",
                    options: ["18", "42", "24"],
                    correct: 0,
                    explanation: "6Ã—7=42ØŒ 3Ã—8=24ØŒ Ø«Ù… 42-24=18"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 64 Ã· 8 Ã· 2 = ØŸ",
                    options: ["4", "16", "32"],
                    correct: 0,
                    explanation: "Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 64Ã·8=8ØŒ Ø«Ù… 8Ã·2=4"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 25 - 4 Ã— 5 + 3 = ØŸ",
                    options: ["8", "120", "28"],
                    correct: 0,
                    explanation: "Ø§Ù„Ø¶Ø±Ø¨ Ø£ÙˆÙ„Ø§Ù‹: 4Ã—5=20ØŒ Ø«Ù… Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 25-20+3=8"
                }
            ],
            2: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø©
                {
                    question: "Ø§Ø­Ø³Ø¨: (15 + 5) Ã— (8 - 3) = ØŸ",
                    options: ["100", "35", "80"],
                    correct: 0,
                    explanation: "(15+5)=20ØŒ (8-3)=5ØŒ Ø«Ù… 20Ã—5=100"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 60 Ã· (4 + 2) Ã— 3 = ØŸ",
                    options: ["30", "10", "5"],
                    correct: 0,
                    explanation: "(4+2)=6ØŒ Ø«Ù… Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 60Ã·6Ã—3=10Ã—3=30"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 5 Ã— (6 + 4) - (12 Ã· 3) = ØŸ",
                    options: ["46", "54", "38"],
                    correct: 0,
                    explanation: "(6+4)=10ØŒ 5Ã—10=50ØŒ (12Ã·3)=4ØŒ Ø«Ù… 50-4=46"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: (24 Ã· 6) + (3 Ã— 7) = ØŸ",
                    options: ["25", "4", "21"],
                    correct: 0,
                    explanation: "(24Ã·6)=4ØŒ (3Ã—7)=21ØŒ Ø«Ù… 4+21=25"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: ((8 + 4) Ã· 3) Ã— 6 = ØŸ",
                    options: ["24", "12", "4"],
                    correct: 0,
                    explanation: "(8+4)=12ØŒ 12Ã·3=4ØŒ Ø«Ù… 4Ã—6=24"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 7 Ã— (5 + 3) - (6 Ã— 4) = ØŸ",
                    options: ["32", "56", "24"],
                    correct: 0,
                    explanation: "(5+3)=8ØŒ 7Ã—8=56ØŒ (6Ã—4)=24ØŒ Ø«Ù… 56-24=32"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: (45 Ã· 9) Ã— (2 + 6) = ØŸ",
                    options: ["40", "5", "8"],
                    correct: 0,
                    explanation: "(45Ã·9)=5ØŒ (2+6)=8ØŒ Ø«Ù… 5Ã—8=40"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: (3 Ã— 4) + (18 Ã· (2 + 1)) = ØŸ",
                    options: ["18", "12", "6"],
                    correct: 0,
                    explanation: "(3Ã—4)=12ØŒ (2+1)=3ØŒ 18Ã·3=6ØŒ Ø«Ù… 12+6=18"
                }
            ],
            3: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                {
                    question: "Ø§Ø­Ø³Ø¨: 1/2 + 1/4 = ØŸ",
                    options: ["3/4", "2/6", "1/3"],
                    correct: 0,
                    explanation: "Ù†ÙˆØ­Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª: 1/2 = 2/4ØŒ Ø«Ù… 2/4 + 1/4 = 3/4"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 3/5 - 1/5 = ØŸ",
                    options: ["2/5", "2/10", "4/5"],
                    correct: 0,
                    explanation: "Ù†ÙØ³ Ø§Ù„Ù…Ù‚Ø§Ù…: 3/5 - 1/5 = 2/5"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 2/3 Ã— 3/4 = ØŸ",
                    options: ["1/2", "6/12", "5/7"],
                    correct: 0,
                    explanation: "Ù†Ø¶Ø±Ø¨ Ø§Ù„Ø¨Ø³Ø· ÙÙŠ Ø§Ù„Ø¨Ø³Ø· ÙˆØ§Ù„Ù…Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù…: (2Ã—3)/(3Ã—4) = 6/12 = 1/2"
                },
                {
                    question: "Ø£ÙŠÙ‡Ù…Ø§ Ø£ÙƒØ¨Ø±: 2/3 Ø£Ù… 3/5ØŸ",
                    options: ["2/3", "3/5", "Ù…ØªØ³Ø§ÙˆÙŠØ§Ù†"],
                    correct: 0,
                    explanation: "Ù†ÙˆØ­Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª: 2/3 = 10/15 Ùˆ 3/5 = 9/15ØŒ Ø¥Ø°Ù† 2/3 Ø£ÙƒØ¨Ø±"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 5/6 - 1/3 = ØŸ",
                    options: ["1/2", "4/3", "2/3"],
                    correct: 0,
                    explanation: "Ù†ÙˆØ­Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª: 1/3 = 2/6ØŒ Ø«Ù… 5/6 - 2/6 = 3/6 = 1/2"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 1/4 + 1/3 = ØŸ",
                    options: ["7/12", "2/7", "1/2"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù…Ù‚Ø§Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ 12: 1/4 = 3/12ØŒ 1/3 = 4/12ØŒ Ø«Ù… 3/12 + 4/12 = 7/12"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 4/5 Ã— 2/3 = ØŸ",
                    options: ["8/15", "6/8", "2/5"],
                    correct: 0,
                    explanation: "(4Ã—2)/(5Ã—3) = 8/15"
                },
                {
                    question: "Ø±ØªØ¨ ØªØµØ§Ø¹Ø¯ÙŠØ§Ù‹: 1/4ØŒ 1/3ØŒ 1/2",
                    options: ["1/4ØŒ 1/3ØŒ 1/2", "1/2ØŒ 1/3ØŒ 1/4", "1/3ØŒ 1/4ØŒ 1/2"],
                    correct: 0,
                    explanation: "Ù†ÙˆØ­Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù…Ø§Øª: 3/12ØŒ 4/12ØŒ 6/12"
                }
            ],
            4: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙƒØ³ÙˆØ± Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
                {
                    question: "Ø§Ø­Ø³Ø¨: (1/2 + 1/3) Ã— 2/5 = ØŸ",
                    options: ["1/3", "5/6", "2/15"],
                    correct: 0,
                    explanation: "Ø£ÙˆÙ„Ø§Ù‹: 1/2 + 1/3 = 3/6 + 2/6 = 5/6ØŒ Ø«Ù… (5/6) Ã— (2/5) = 10/30 = 1/3"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 3/4 Ã· 1/2 = ØŸ",
                    options: ["3/2", "3/8", "1/2"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ÙƒØ³Ø± = Ø§Ù„Ø¶Ø±Ø¨ ÙÙŠ Ù…Ù‚Ù„ÙˆØ¨Ù‡: 3/4 Ã— 2/1 = 6/4 = 3/2"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 2/3 - (1/4 + 1/6) = ØŸ",
                    options: ["1/4", "1/2", "1/3"],
                    correct: 0,
                    explanation: "Ø£ÙˆÙ„Ø§Ù‹: 1/4 + 1/6 = 3/12 + 2/12 = 5/12ØŒ Ø«Ù… 2/3 - 5/12 = 8/12 - 5/12 = 3/12 = 1/4"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: (2/5 Ã— 3/4) + 1/10 = ØŸ",
                    options: ["7/10", "6/20", "1/2"],
                    correct: 0,
                    explanation: "2/5 Ã— 3/4 = 6/20 = 3/10ØŒ Ø«Ù… 3/10 + 1/10 = 4/10 = 2/5... Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© 7/10"
                },
                {
                    question: "Ø¥Ø°Ø§ ÙƒØ§Ù† 3/4 Ù…Ù† Ø§Ù„ØµÙ 24 ØªÙ„Ù…ÙŠØ°ØŒ ÙÙƒÙ… ØªÙ„Ù…ÙŠØ° ÙÙŠ Ø§Ù„ØµÙØŸ",
                    options: ["32", "18", "36"],
                    correct: 0,
                    explanation: "Ø¥Ø°Ø§ ÙƒØ§Ù† 3/4 = 24ØŒ ÙÙ€ 1/4 = 8ØŒ Ø¥Ø°Ù† Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„ = 4 Ã— 8 = 32"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 1/2 + 1/3 + 1/6 = ØŸ",
                    options: ["1", "5/6", "2/3"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù…Ù‚Ø§Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ 6: 3/6 + 2/6 + 1/6 = 6/6 = 1"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: (4/5) Ã· (2/3) = ØŸ",
                    options: ["6/5", "8/15", "2/5"],
                    correct: 0,
                    explanation: "4/5 Ã— 3/2 = 12/10 = 6/5"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: 3/8 Ã— (4/9 + 2/9) = ØŸ",
                    options: ["1/4", "6/9", "1/2"],
                    correct: 0,
                    explanation: "4/9 + 2/9 = 6/9 = 2/3ØŒ Ø«Ù… 3/8 Ã— 2/3 = 6/24 = 1/4"
                }
            ],
            5: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ù…Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                {
                    question: "Ø§Ø­Ø³Ø¨: (3/4 + 1/2) Ã— (5/6 - 1/3) = ØŸ",
                    options: ["5/8", "1/2", "3/4"],
                    correct: 0,
                    explanation: "(3/4 + 2/4) = 5/4ØŒ (5/6 - 2/6) = 3/6 = 1/2ØŒ Ø«Ù… 5/4 Ã— 1/2 = 5/8"
                },
                {
                    question: "Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·ÙˆÙ„ Ù…Ø³ØªØ·ÙŠÙ„ 3/4 Ù…ØªØ± ÙˆØ¹Ø±Ø¶Ù‡ 2/5 Ù…ØªØ±ØŒ ÙÙ…Ø§ Ù…Ø³Ø§Ø­ØªÙ‡ØŸ",
                    options: ["3/10 Ù…Â²", "5/9 Ù…Â²", "1/2 Ù…Â²"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù…Ø³Ø§Ø­Ø© = Ø§Ù„Ø·ÙˆÙ„ Ã— Ø§Ù„Ø¹Ø±Ø¶ = 3/4 Ã— 2/5 = 6/20 = 3/10 Ù…Â²"
                },
                {
                    question: "Ø£Ù†ÙÙ‚ Ø£Ø­Ù…Ø¯ 2/5 Ù…Ù† Ù†Ù‚ÙˆØ¯Ù‡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªØ¨ Ùˆ1/4 Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¹Ø§Ù…. ÙƒÙ… Ø¨Ù‚ÙŠ Ù…Ø¹Ù‡ØŸ",
                    options: ["7/20", "3/9", "1/2"],
                    correct: 0,
                    explanation: "Ø£Ù†ÙÙ‚: 2/5 + 1/4 = 8/20 + 5/20 = 13/20ØŒ Ø¨Ù‚ÙŠ: 1 - 13/20 = 7/20"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨: [(2/3 + 1/4) Ã· 1/2] - 1/6 = ØŸ",
                    options: ["5/3", "11/12", "1"],
                    correct: 0,
                    explanation: "2/3 + 1/4 = 11/12ØŒ Ø«Ù… 11/12 Ã· 1/2 = 11/12 Ã— 2 = 11/6ØŒ Ø£Ø®ÙŠØ±Ø§Ù‹ 11/6 - 1/6 = 10/6 = 5/3"
                },
                {
                    question: "Ù‚Ø·Ø¹ Ø³Ø§Ø¦Ù‚ 3/8 Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ© ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ùˆ2/5 ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©. ÙƒÙ… Ø¨Ù‚ÙŠØŸ",
                    options: ["9/40", "5/13", "1/8"],
                    correct: 0,
                    explanation: "Ù‚Ø·Ø¹: 3/8 + 2/5 = 15/40 + 16/40 = 31/40ØŒ Ø¨Ù‚ÙŠ: 1 - 31/40 = 9/40"
                }
            ],
            6: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¯Ø³: Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                {
                    question: "Ø®Ø²Ø§Ù† ÙŠÙ…Ù„Ø£ Ø¨Ù€ 2/3 ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©. ÙƒÙ… Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ù„Ù…Ù„Ø¦Ù‡ ÙƒØ§Ù…Ù„Ø§Ù‹ØŸ",
                    options: ["1.5 Ø³Ø§Ø¹Ø©", "1 Ø³Ø§Ø¹Ø©", "2 Ø³Ø§Ø¹Ø©"],
                    correct: 0,
                    explanation: "Ø¥Ø°Ø§ ÙƒØ§Ù† 2/3 ÙŠÙ…Ù„Ø£ ÙÙŠ Ø³Ø§Ø¹Ø©ØŒ ÙØ§Ù„Ø®Ø²Ø§Ù† Ø§Ù„ÙƒØ§Ù…Ù„ ÙŠØ­ØªØ§Ø¬ 1 Ã· (2/3) = 3/2 = 1.5 Ø³Ø§Ø¹Ø©"
                },
                {
                    question: "Ø¨Ø§Ø¹ ØªØ§Ø¬Ø± 3/5 Ù…Ù† Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© ØµØ¨Ø§Ø­Ø§Ù‹ Ùˆ1/4 Ù…Ø³Ø§Ø¡Ù‹. ÙƒÙ… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ",
                    options: ["3/20", "4/9", "1/5"],
                    correct: 0,
                    explanation: "Ø¨Ø§Ø¹: 3/5 + 1/4 = 12/20 + 5/20 = 17/20ØŒ ØªØ¨Ù‚Ù‰: 20/20 - 17/20 = 3/20"
                },
                {
                    question: "Ù…Ø²Ø±Ø¹Ø© Ù…Ø³Ø§Ø­ØªÙ‡Ø§ 240 Ù…Â². Ø²ÙØ±Ø¹ Ù…Ù†Ù‡Ø§ 2/3 Ù‚Ù…Ø­ Ùˆ1/8 Ø´Ø¹ÙŠØ±. ÙƒÙ… Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙØ§Ø±ØºØ©ØŸ",
                    options: ["50 Ù…Â²", "60 Ù…Â²", "40 Ù…Â²"],
                    correct: 0,
                    explanation: "Ø§Ù„Ù…Ø²Ø±ÙˆØ¹: 2/3 + 1/8 = 16/24 + 3/24 = 19/24ØŒ Ø§Ù„ÙØ§Ø±Øº: 5/24 Ã— 240 = 50 Ù…Â²"
                }
            ],
            7: [ // Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ø¹: Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø´Ø±ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: (2.5 + 1.75) Ã— 0.4 = ØŸ",
                    options: ["1.7", "4.25", "0.68"],
                    correct: 0,
                    explanation: "2.5 + 1.75 = 4.25ØŒ Ø«Ù… 4.25 Ã— 0.4 = 1.7"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: 15.6 Ã· (2.4 + 1.6) = ØŸ",
                    options: ["3.9", "15.6", "4"],
                    correct: 0,
                    explanation: "2.4 + 1.6 = 4ØŒ Ø«Ù… 15.6 Ã· 4 = 3.9"
                },
                {
                    question: "Ø­ÙˆÙ„ Ø¥Ù„Ù‰ ÙƒØ³Ø±: 0.375",
                    options: ["3/8", "375/100", "3/7"],
                    correct: 0,
                    explanation: "0.375 = 375/1000 = 3/8 (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¨Ø³ÙŠØ·)"
                },
                {
                    question: "Ø§Ø­Ø³Ø¨ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†: (3/4 + 0.5) Ã— 2.4 = ØŸ",
                    options: ["3", "1.25", "2.4"],
                    correct: 0,
                    explanation: "3/4 = 0.75ØŒ 0.75 + 0.5 = 1.25ØŒ Ø«Ù… 1.25 Ã— 2.4 = 3"
                }
            ]
        };

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¬ÙˆÙ…
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('mainMenu').classList.remove('hidden');
            if (currentPlayer) {
                gameSystem.setPlayerOffline(currentPlayer);
            }
        }

        function showPlayerLogin() {
            hideAllScreens();
            document.getElementById('playerLogin').classList.remove('hidden');
        }

        function showTeacherLogin() {
            hideAllScreens();
            document.getElementById('teacherLogin').classList.remove('hidden');
        }

        function showLevelSelection() {
            hideAllScreens();
            document.getElementById('levelSelection').classList.remove('hidden');
            updatePlayerInfo();
            updatePlayerAvatar();
            updateDragonBalls();
            updateLevelAccess();
            updateOnlinePlayersDisplay();
            
            if (currentPlayer) {
                gameSystem.updatePlayerActivity(currentPlayer, 'ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª');
            }
        }

        function hideAllScreens() {
            const screens = ['mainMenu', 'playerLogin', 'teacherLogin', 'teacherDashboard', 'levelSelection', 'gameScreen', 'gameEnd'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù…ÙŠØ°
        function startGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ°');
                return;
            }
            
            currentPlayer = name;
            gameSystem.setPlayerOnline(name, 'Ø¯Ø®Ù„ Ù„Ù„ØªÙˆ');
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            gameSystem.getPlayer(name);
            
            showLevelSelection();
        }

        // Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø°
        function teacherLogin() {
            const password = document.getElementById('teacherPassword').value;
            if (password === '123456') {
                isTeacher = true;
                showTeacherDashboard();
            } else {
                showAlert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
            }
        }

        function logout() {
            isTeacher = false;
            document.getElementById('teacherPassword').value = '';
            showMainMenu();
        }

        // Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³ØªØ§Ø°
        function showTeacherDashboard() {
            hideAllScreens();
            document.getElementById('teacherDashboard').classList.remove('hidden');
            gameSystem.updateTeacherDashboard();
            updateStudentsTable();
        }

        function updateStudentsTable() {
            const tableBody = document.getElementById('studentsTable');
            tableBody.innerHTML = '';
            
            const players = Object.values(gameSystem.data.players)
                .sort((a, b) => b.totalScore - a.totalScore);
                
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700';
                
                const isOnline = gameSystem.data.onlinePlayers.has(player.name);
                const onlineInfo = gameSystem.data.onlinePlayers.get(player.name);
                
                const statusBadge = isOnline ? 
                    `<span class="bg-green-500 text-white px-2 py-1 rounded text-xs">ğŸŸ¢ ${onlineInfo.activity}</span>` :
                    '<span class="bg-gray-500 text-white px-2 py-1 rounded text-xs">ØºÙŠØ± Ù…ØªØµÙ„</span>';
                
                const monsterInfo = monsterEvolution[player.dragonBalls] || monsterEvolution[0];
                
                row.innerHTML = `
                    <td class="p-2">${index + 1}</td>
                    <td class="p-2">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-lg">
                            ${monsterInfo.emoji}
                        </div>
                    </td>
                    <td class="p-2 font-bold">${player.name}</td>
                    <td class="p-2">${statusBadge}</td>
                    <td class="p-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${player.currentLevel}</td>
                    <td class="p-2 font-bold text-yellow-400">${player.totalScore}</td>
                    <td class="p-2">
                        <div class="flex items-center space-x-1">
                            <span class="font-bold">${player.dragonBalls}/7</span>
                            <span class="text-lg">${monsterInfo.emoji}</span>
                        </div>
                    </td>
                    <td class="p-2 text-sm">${isOnline ? 'Ù†Ø´Ø· Ø§Ù„Ø¢Ù†' : gameSystem.getTimeAgo(new Date(player.lastPlayed).getTime())}</td>
                    <td class="p-2">
                        <button onclick="deleteStudent('${player.name}')" class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm">
                            Ø­Ø°Ù
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function deleteStudent(name) {
            showConfirmDialog(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª ${name}ØŸ`, function() {
                gameSystem.deletePlayer(name);
                updateStudentsTable();
            });
        }

        // ØªØ­Ø¯ÙŠØ« ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
        function updatePlayerAvatar() {
            const player = gameSystem.getPlayer(currentPlayer);
            const monsterInfo = monsterEvolution[player.dragonBalls] || monsterEvolution[0];
            
            const avatar = document.getElementById('playerAvatar');
            avatar.textContent = monsterInfo.emoji;
            avatar.title = `${monsterInfo.name}: ${monsterInfo.description}`;
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
        function updateLevelAccess() {
            const player = gameSystem.getPlayer(currentPlayer);
            const dragonBalls = player.dragonBalls;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰
            for (let i = 4; i <= 7; i++) {
                const levelElement = document.getElementById(`level${i}`);
                const lockElement = document.getElementById(`level${i}Lock`);
                const requiredBalls = i - 1;
                
                if (dragonBalls >= requiredBalls) {
                    levelElement.classList.remove('level-locked');
                    levelElement.classList.add('level-unlocked');
                    lockElement.textContent = 'ğŸ”“ Ù…ØªØ§Ø­';
                    lockElement.className = 'mt-2 text-green-400';
                } else {
                    levelElement.classList.add('level-locked');
                    levelElement.classList.remove('level-unlocked');
                    lockElement.textContent = `ğŸ”’ ÙŠØ­ØªØ§Ø¬ ${requiredBalls} ÙƒØ±Ø§Øª`;
                    lockElement.className = 'mt-2 text-red-400';
                }
            }
        }

        function selectLevel(level) {
            const player = gameSystem.getPlayer(currentPlayer);
            
            // ÙØ­Øµ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆÙ‰
            if (level >= 4 && player.dragonBalls < (level - 1)) {
                showAlert(`ÙŠØ¬Ø¨ Ø¬Ù…Ø¹ ${level - 1} ÙƒØ±Ø§Øª Ø¯Ø±Ø§ØºÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰`);
                return;
            }
            
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            gameStartTime = Date.now();
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
            const timeSettings = {
                1: 45, 2: 60, 3: 90, 4: 120, 5: 180, 6: 240, 7: 300
            };
            timeLeft = timeSettings[level] || 60;
            
            questions = [...questionBank[level]].sort(() => Math.random() - 0.5);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø·
            gameSystem.updatePlayerActivity(currentPlayer, `ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level}`, `Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${level}`);
            
            startGameScreen();
        }

        // Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
        function showChallengeModal() {
            const onlinePlayersArray = Array.from(gameSystem.data.onlinePlayers.entries())
                .filter(([name, info]) => name !== currentPlayer);
            
            if (onlinePlayersArray.length === 0) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø¢Ø®Ø±ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹');
                return;
            }
            
            const modal = document.getElementById('challengeModal');
            const playersList = document.getElementById('onlinePlayersList');
            
            playersList.innerHTML = '';
            onlinePlayersArray.forEach(([playerName, info]) => {
                const player = gameSystem.getPlayer(playerName);
                const monsterInfo = monsterEvolution[player.dragonBalls] || monsterEvolution[0];
                
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-700 rounded mb-2';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center">
                            ${monsterInfo.emoji}
                        </div>
                        <div>
                            <div class="font-bold">${playerName}</div>
                            <div class="text-xs text-gray-400">${info.activity}</div>
                        </div>
                    </div>
                    <button onclick="sendChallenge('${playerName}')" class="challenge-button text-white px-3 py-1 rounded text-sm">
                        âš”ï¸ ØªØ­Ø¯ÙŠ
                    </button>
                `;
                playersList.appendChild(div);
            });
            
            modal.classList.remove('hidden');
        }

        function closeChallengeModal() {
            document.getElementById('challengeModal').classList.add('hidden');
        }

        function sendChallenge(opponent) {
            const level = parseInt(document.getElementById('challengeLevel').value);
            
            // Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯
            const challengeId = gameSystem.createChallenge(currentPlayer, opponent, level);
            currentChallenge = challengeId;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠ
            document.getElementById('challengeStatus').classList.remove('hidden');
            document.getElementById('challengeMessage').innerHTML = `
                <div class="text-yellow-400 font-bold">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠ Ø¥Ù„Ù‰ ${opponent} ğŸ”¥</div>
                <div class="text-sm mt-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${level} | ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©...</div>
            `;
            
            closeChallengeModal();
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¢Ø®Ø±
            setTimeout(() => {
                acceptChallenge(challengeId);
            }, 3000);
        }

        function acceptChallenge(challengeId) {
            gameSystem.acceptChallenge(challengeId);
            
            document.getElementById('challengeMessage').innerHTML = `
                <div class="text-green-400 font-bold">ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­Ø¯ÙŠ! âš”ï¸</div>
                <button onclick="startChallengeGame()" class="challenge-accept text-white px-4 py-2 rounded mt-2">
                    ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©
                </button>
            `;
        }

        function startChallengeGame() {
            const challenge = gameSystem.data.challenges[currentChallenge];
            currentLevel = challenge.level;
            selectLevel(currentLevel);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
        function showOnlinePlayersModal() {
            const modal = document.getElementById('onlinePlayersModal');
            const grid = document.getElementById('onlinePlayersGrid');
            
            grid.innerHTML = '';
            
            const onlinePlayersArray = Array.from(gameSystem.data.onlinePlayers.entries());
            
            if (onlinePlayersArray.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ†</div>';
            } else {
                onlinePlayersArray.forEach(([playerName, info]) => {
                    const player = gameSystem.getPlayer(playerName);
                    const monsterInfo = monsterEvolution[player.dragonBalls] || monsterEvolution[0];
                    
                    const div = document.createElement('div');
                    div.className = 'bg-gray-700 p-4 rounded text-center';
                    div.innerHTML = `
                        <div class="w-12 h-12 mx-auto rounded-full bg-gray-600 flex items-center justify-center text-2xl mb-2">
                            ${monsterInfo.emoji}
                        </div>
                        <div class="font-bold">${playerName}</div>
                        <div class="text-xs text-gray-400 mt-1">${info.activity}</div>
                        <div class="text-xs text-blue-400">${player.dragonBalls}/7 ğŸ‰</div>
                        ${playerName !== currentPlayer ? `
                            <button onclick="sendQuickChallenge('${playerName}')" class="mt-2 bg-red-600 text-white px-2 py-1 rounded text-xs">
                                ØªØ­Ø¯ÙŠ Ø³Ø±ÙŠØ¹
                            </button>
                        ` : '<div class="text-green-400 text-xs mt-2">Ø£Ù†Øª</div>'}
                    `;
                    grid.appendChild(div);
                });
            }
            
            modal.classList.remove('hidden');
        }

        function closeOnlinePlayersModal() {
            document.getElementById('onlinePlayersModal').classList.add('hidden');
        }

        function sendQuickChallenge(opponent) {
            closeOnlinePlayersModal();
            document.getElementById('challengeLevel').value = currentLevel;
            sendChallenge(opponent);
        }

        function updateOnlinePlayersDisplay() {
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            const onlineCount = gameSystem.data.onlinePlayers.size;
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
        }

        // Ø¨Ø¯Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨
        function startGameScreen() {
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (currentChallenge) {
                const challenge = gameSystem.data.challenges[currentChallenge];
                document.getElementById('challengeInfo').classList.remove('hidden');
                document.getElementById('challengeOpponent').textContent = `âš”ï¸ Ø¶Ø¯: ${challenge.opponent}`;
                document.getElementById('myScore').textContent = '0';
                document.getElementById('opponentScore').textContent = '0';
                document.getElementById('myTime').textContent = '-';
                document.getElementById('opponentTime').textContent = '-';
            } else {
                document.getElementById('challengeInfo').classList.add('hidden');
            }
            
            loadQuestion();
            startTimer();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„
        function loadQuestion() {
            if (currentQuestion >= questions.length) {
                endGame();
                return;
            }

            const question = questions[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionNumber').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„: ${currentQuestion + 1}/${questions.length}`;
            document.getElementById('currentScore').textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
            
            // ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
            const shuffledOptions = [...question.options];
            const correctAnswer = question.options[question.correct];
            shuffledOptions.sort(() => Math.random() - 0.5);
            const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
            questions[currentQuestion].correct = newCorrectIndex;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            for (let i = 0; i < 3; i++) {
                document.getElementById(`option${i}`).textContent = shuffledOptions[i];
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨
            document.getElementById('answerResult').classList.add('hidden');
            document.getElementById('doorsContainer').classList.remove('hidden');
            
            // ØªØ³Ø¬ÙŠÙ„ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ø¤Ø§Ù„
            questionStartTime = Date.now();
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `â±ï¸ ${timeLeft}`;
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').className = 'text-lg font-bold text-red-400';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    selectAnswer(-1); // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
                }
            }, 1000);
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        function selectAnswer(answerIndex) {
            clearInterval(timer);
            
            const answerTime = questionStartTime ? (Date.now() - questionStartTime) / 1000 : 0;
            const question = questions[currentQuestion];
            const isCorrect = answerIndex === question.correct;
            
            document.getElementById('doorsContainer').classList.add('hidden');
            document.getElementById('answerResult').classList.remove('hidden');
            
            if (answerIndex === -1) {
                // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
                document.getElementById('resultIcon').textContent = 'â°';
                document.getElementById('resultText').textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!';
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-orange-400';
                document.getElementById('answerTime').textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${timeLeft} Ø«Ø§Ù†ÙŠØ© (Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª)`;
            } else if (isCorrect) {
                // Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                const points = Math.max(10, Math.floor((timeLeft / 10) * currentLevel * 5));
                score += points;
                document.getElementById('resultIcon').textContent = 'ğŸ’';
                document.getElementById('resultText').textContent = `Ù…Ù…ØªØ§Ø²! ÙˆØ¬Ø¯Øª Ø§Ù„ÙƒÙ†Ø²! (+${points} Ù†Ù‚Ø·Ø©)`;
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-green-400 treasure';
                document.getElementById('answerTime').textContent = `âš¡ ÙˆÙ‚Øª Ø±Ø§Ø¦Ø¹: ${answerTime.toFixed(1)} Ø«Ø§Ù†ÙŠØ©`;
                
                // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠ
                if (currentChallenge) {
                    document.getElementById('myScore').textContent = score;
                    document.getElementById('myTime').textContent = answerTime.toFixed(1);
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø®ØµÙ…
                    const opponentPoints = Math.floor(Math.random() * points * 1.2);
                    const opponentTime = answerTime + (Math.random() * 2 - 1);
                    document.getElementById('opponentScore').textContent = opponentPoints;
                    document.getElementById('opponentTime').textContent = Math.max(0.1, opponentTime).toFixed(1);
                }
            } else {
                // Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©
                document.getElementById('resultIcon').textContent = 'ğŸ‘¹';
                document.getElementById('resultText').textContent = 'Ø¢Ø³ÙØŒ Ø¸Ù‡Ø± Ø§Ù„ÙˆØ­Ø´!';
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-red-400 monster';
                document.getElementById('answerTime').textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${answerTime.toFixed(1)} Ø«Ø§Ù†ÙŠØ©`;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
            document.getElementById('currentScore').textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø· ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
            gameSystem.updatePlayerActivity(
                currentPlayer, 
                `ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel}`, 
                `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1}/${questions.length} - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`
            );
        }

        // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
        function nextQuestion() {
            currentQuestion++;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯
            const timeSettings = {
                1: 45, 2: 60, 3: 90, 4: 120, 5: 180, 6: 240, 7: 300
            };
            timeLeft = timeSettings[currentLevel] || 60;
            document.getElementById('timer').className = 'text-lg font-bold text-yellow-400';
            
            loadQuestion();
            startTimer();
        }

        // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        function endGame() {
            clearInterval(timer);
            hideAllScreens();
            document.getElementById('gameEnd').classList.remove('hidden');
            
            const player = gameSystem.getPlayer(currentPlayer);
            const gameDuration = Date.now() - gameStartTime;
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
            const oldScore = player.totalScore;
            player.totalScore = Math.max(player.totalScore, player.totalScore + score);
            player.currentLevel = Math.max(player.currentLevel, currentLevel);
            player.gamesPlayed++;
            
            // Ø¥Ø¶Ø§ÙØ© ÙƒØ±Ø© Ø¯Ø±Ø§ØºÙˆÙ† Ø¨ÙˆÙ„
            let gotDragonBall = false;
            const requiredScore = currentLevel * 60;
            
            if (score >= requiredScore && !player.levelsCompleted.includes(currentLevel)) {
                const oldDragonBalls = player.dragonBalls;
                player.dragonBalls = Math.min(player.dragonBalls + 1, 7);
                player.levelsCompleted.push(currentLevel);
                gotDragonBall = true;
                
                document.getElementById('dragonBallReward').classList.remove('hidden');
                
                // Ø¥Ø¸Ù‡Ø§Ø± ØªØ·ÙˆØ± Ø§Ù„ÙˆØ­Ø´
                if (player.dragonBalls > oldDragonBalls) {
                    const newMonster = monsterEvolution[player.dragonBalls];
                    document.getElementById('monsterEvolution').classList.remove('hidden');
                    document.getElementById('newMonster').textContent = newMonster.emoji;
                    
                    // ØªØ³Ø¬ÙŠÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ØªØ·ÙˆØ±
                    gameSystem.recordAchievement(
                        currentPlayer, 
                        `ØªØ·ÙˆØ± Ø¥Ù„Ù‰ ${newMonster.name}!`, 
                        `Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø© ${player.dragonBalls} ÙˆØªØ·ÙˆØ± ÙˆØ­Ø´Ù‡`
                    );
                }
                
                // ÙØ­Øµ ÙØªØ­ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯
                if (player.dragonBalls >= currentLevel && currentLevel < 7) {
                    document.getElementById('newLevelUnlocked').classList.remove('hidden');
                    document.getElementById('newLevelUnlocked').textContent = `ğŸ‰ ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel + 1}!`;
                    
                    gameSystem.recordAchievement(
                        currentPlayer, 
                        `ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel + 1}!`, 
                        `Ø¬Ù…Ø¹ ÙƒØ±Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ÙØªØ­ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯`
                    );
                }
                
                // ØªØ³Ø¬ÙŠÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙƒØ±Ø©
                gameSystem.recordAchievement(
                    currentPlayer, 
                    `Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙƒØ±Ø© Ø¯Ø±Ø§ØºÙˆÙ† (${player.dragonBalls}/7)!`, 
                    `Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel} Ø¨Ù†Ø¬Ø§Ø­`
                );
            }
            
            // Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹ÙŠØ© Ø¹Ù†Ø¯ Ø¬Ù…Ø¹ 7 ÙƒØ±Ø§Øª
            if (player.dragonBalls === 7) {
                document.getElementById('encouragementMessage').classList.remove('hidden');
                const careers = ['Ø·Ø¨ÙŠØ¨', 'Ù…Ù‡Ù†Ø¯Ø³', 'Ø¹Ø§Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ù…Ø®ØªØ±Ø¹', 'Ø£Ø³ØªØ§Ø° Ø¬Ø§Ù…Ø¹ÙŠ', 'Ù…Ø¨Ø±Ù…Ø¬'];
                const randomCareer = careers[Math.floor(Math.random() * careers.length)];
                document.getElementById('careerMessage').textContent = 
                    `ğŸ† Ø¬Ù…Ø¹Øª Ø¬Ù…ÙŠØ¹ ÙƒØ±Ø§Øª Ø§Ù„Ø¯Ø±Ø§ØºÙˆÙ†! Ø£Ù†Øª Ø¹Ø¨Ù‚Ø±ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª! Ø³ØªØµØ¨Ø­ ${randomCareer} Ø¹Ø¸ÙŠÙ…! ğŸ†`;
                
                gameSystem.recordAchievement(
                    currentPlayer, 
                    `ğŸŒŸ Ø³ÙŠØ¯ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØ±Ø§Øª!`, 
                    `Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¬Ù…Ø¹ 7 ÙƒØ±Ø§Øª Ø¯Ø±Ø§ØºÙˆÙ†`
                );
            }
            
            // Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠ
            if (currentChallenge) {
                const myFinalScore = score;
                const opponentScore = parseInt(document.getElementById('opponentScore').textContent) || 0;
                
                document.getElementById('challengeResult').classList.remove('hidden');
                
                if (myFinalScore > opponentScore) {
                    document.getElementById('challengeOutcome').textContent = 'ğŸ† ÙØ²Øª ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ!';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-green-400';
                    document.getElementById('challengeDetails').textContent = `Ù†Ù‚Ø§Ø·Ùƒ: ${myFinalScore} | Ù†Ù‚Ø§Ø· Ø§Ù„Ø®ØµÙ…: ${opponentScore}`;
                    player.challengesWon++;
                    
                    gameSystem.recordAchievement(
                        currentPlayer, 
                        `ğŸ¥‡ Ø§Ù†ØªØµØ± ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ!`, 
                        `Ù‡Ø²Ù… Ø®ØµÙ…Ù‡ Ø¨Ù†Ù‚Ø§Ø· ${myFinalScore} Ù…Ù‚Ø§Ø¨Ù„ ${opponentScore}`
                    );
                } else if (myFinalScore < opponentScore) {
                    document.getElementById('challengeOutcome').textContent = 'ğŸ˜” Ø®Ø³Ø±Øª Ø§Ù„ØªØ­Ø¯ÙŠ';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-red-400';
                    document.getElementById('challengeDetails').textContent = `Ù†Ù‚Ø§Ø·Ùƒ: ${myFinalScore} | Ù†Ù‚Ø§Ø· Ø§Ù„Ø®ØµÙ…: ${opponentScore}`;
                    player.challengesLost++;
                } else {
                    document.getElementById('challengeOutcome').textContent = 'ğŸ¤ ØªØ¹Ø§Ø¯Ù„!';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-yellow-400';
                    document.getElementById('challengeDetails').textContent = `Ù†ÙØ³ Ø§Ù„Ù†Ù‚Ø§Ø·: ${myFinalScore}`;
                }
                
                currentChallenge = null;
            }
            
            document.getElementById('finalScore').textContent = `Ù†Ù‚Ø§Ø·Ùƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø©: ${score}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø´Ø§Ø·
            gameSystem.updatePlayerActivity(currentPlayer, 'Ø§Ù†ØªÙ‡Ù‰ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨', `Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevel} - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}`);
            
            gameSystem.updatePlayer(currentPlayer, player);
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
        function updatePlayerInfo() {
            const player = gameSystem.getPlayer(currentPlayer);
            document.getElementById('playerInfo').textContent = 
                `Ù…Ø±Ø­Ø¨Ø§ ${currentPlayer} | Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: ${player.totalScore} | Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${player.currentLevel}`;
        }

        // ØªØ­Ø¯ÙŠØ« ÙƒØ±Ø§Øª Ø§Ù„Ø¯Ø±Ø§ØºÙˆÙ†
        function updateDragonBalls() {
            const container = document.getElementById('dragonBalls');
            container.innerHTML = '';
            
            const player = gameSystem.getPlayer(currentPlayer);
            for (let i = 0; i < 7; i++) {
                const ball = document.createElement('div');
                ball.className = 'w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2';
                
                if (i < player.dragonBalls) {
                    ball.className += ' bg-orange-500 text-white dragonball border-yellow-400';
                    ball.textContent = `â­${i + 1}`;
                } else {
                    ball.className += ' bg-gray-600 text-gray-400 border-gray-500';
                    ball.textContent = '?';
                }
                
                container.appendChild(ball);
            }
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ÙˆØ§Ø±Ø§Øª
        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-center mb-4">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full bg-primary hover:bg-purple-700 text-white py-2 px-4 rounded">
                        Ø­Ø³Ù†Ø§Ù‹
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-center mb-4">${message}</p>
                    <div class="flex justify-center space-x-3">
                        <button class="cancel-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded">
                            ØªØ£ÙƒÙŠØ¯
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.querySelector('.cancel-btn').onclick = function() {
                document.body.removeChild(modal);
            };
            
            modal.querySelector('.confirm-btn').onclick = function() {
                document.body.removeChild(modal);
                onConfirm();
            };
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ù„ØªØ¬Ø±Ø¨Ø©
            ['Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…ØªÙÙˆÙ‚', 'ÙØ§Ø·Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©', 'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ', 'Ø¹Ø§Ø¦Ø´Ø© Ø§Ù„Ù†Ø¬Ù…Ø©'].forEach((name, index) => {
                const player = gameSystem.getPlayer(name);
                player.totalScore = Math.floor(Math.random() * 500) + 100;
                player.dragonBalls = Math.floor(Math.random() * 6) + 1;
                player.currentLevel = Math.min(7, player.dragonBalls + 1);
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                if (Math.random() > 0.5) {
                    gameSystem.setPlayerOnline(name, ['ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', 'ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3', 'ÙŠØªØ­Ø¯Ù‰ Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±'][Math.floor(Math.random() * 3)]);
                }
            });
            
            // Ø¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        });
    </script>
</body>
</html>
