<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math 2รจme - ูุนุจุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'arabic': ['Amiri', 'serif'],
                    },
                    colors: {
                        'primary': '#5D5CDE',
                        'gold': '#FFD700',
                        'treasure': '#FFA500',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        
        body {
            font-family: 'Amiri', serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .door {
            transition: all 0.5s ease;
            cursor: pointer;
            position: relative;
            background: linear-gradient(45deg, #8B4513, #A0522D);
            border: 4px solid #654321;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .door:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .treasure {
            animation: bounce 1s infinite;
        }
        
        .monster {
            animation: shake 0.5s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .dragonball {
            animation: glow 2s infinite;
            background: radial-gradient(circle, #FF8C00, #FFD700);
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 165, 0, 1); }
        }
        
        .level-locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .level-unlocked {
            opacity: 1;
            cursor: pointer;
        }
        
        .challenge-button {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            animation: pulse 2s infinite;
        }
        
        .challenge-accept {
            background: linear-gradient(45deg, #059669, #10b981);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .online-indicator {
            background: #10b981;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .hidden {
            display: none !important;
        }
        
        .math-formula {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen">
    <!-- ุฎูููุฉ ุงููุฌูู -->
    <div id="stars" class="fixed inset-0 z-0"></div>

    <!-- ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ -->
    <div id="mainMenu" class="relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <h1 class="text-4xl md:text-6xl font-bold mb-8 text-center bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
            Math 2รจme
        </h1>
        <p class="text-xl mb-8 text-center text-gray-300">ูุนุจุฉ ุงูุฑูุงุถูุงุช ุงูุชูุงุนููุฉ - ุงููููุฌ ุงูุฌุฒุงุฆุฑู</p>
        
        <div class="space-y-4 w-full max-w-md">
            <button onclick="showPlayerLogin()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors">
                ุฏุฎูู ุงูุชูููุฐ
            </button>
            <button onclick="showTeacherLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition-colors">
                ุฏุฎูู ุงูุฃุณุชุงุฐ
            </button>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุฏุฎูู ุงูุชูููุฐ -->
    <div id="playerLogin" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">ุฏุฎูู ุงูุชูููุฐ</h2>
            <input type="text" id="playerName" placeholder="ุงุณู ุงูุชูููุฐ" class="w-full p-3 mb-4 text-black rounded-lg text-base">
            <button onclick="startGame()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ุงุจุฏุฃ ุงููุนุจ
            </button>
            <button onclick="showMainMenu()" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ุงูุนูุฏุฉ
            </button>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุฏุฎูู ุงูุฃุณุชุงุฐ -->
    <div id="teacherLogin" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center">ุฏุฎูู ุงูุฃุณุชุงุฐ</h2>
            <input type="password" id="teacherPassword" placeholder="ุงูุฑูู ุงูุณุฑู: 123456" class="w-full p-3 mb-4 text-black rounded-lg text-base">
            <button onclick="teacherLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ุฏุฎูู
            </button>
            <button onclick="showMainMenu()" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ุงูุนูุฏุฉ
            </button>
        </div>
    </div>

    <!-- ููุญุฉ ุงูุชุญูู ููุฃุณุชุงุฐ -->
    <div id="teacherDashboard" class="hidden relative z-10 p-4">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">ููุญุฉ ุชุญูู ุงูุฃุณุชุงุฐ</h2>
                <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                    ุฎุฑูุฌ
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2">ุงูุชูุงููุฐ ุงููุชุตููู</h3>
                    <div id="onlineStudentsList" class="space-y-2">
                        <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
                    </div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2">ุฅุญุตุงุฆูุงุช ุนุงูุฉ</h3>
                    <div class="space-y-2">
                        <div>ุฅุฌูุงูู ุงูุชูุงููุฐ: <span id="totalStudents" class="text-blue-400 font-bold">0</span></div>
                        <div>ุงูุชุญุฏูุงุช ุงููุดุทุฉ: <span id="activeChallenges" class="text-yellow-400 font-bold">0</span></div>
                        <div>ุงููุงุนุจูู ุงููุชุตููู: <span id="onlineCount" class="text-green-400 font-bold">0</span></div>
                    </div>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-2">ุฃูุถู ุงูุชูุงููุฐ</h3>
                    <div id="topStudents" class="space-y-1 text-sm">
                        <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4">ุฌุฏูู ุงููุชุงุฆุฌ ุงูุดุงูู</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="text-right p-2">ุงูุชุฑุชูุจ</th>
                                <th class="text-right p-2">ุงูุงุณู</th>
                                <th class="text-right p-2">ุงููุณุชูู ุงูุญุงูู</th>
                                <th class="text-right p-2">ุงูููุงุท ุงูุฅุฌูุงููุฉ</th>
                                <th class="text-right p-2">ูุฑุงุช ุงูุฏุฑุงุบูู</th>
                                <th class="text-right p-2">ุงูุญุงูุฉ</th>
                                <th class="text-right p-2">ุขุฎุฑ ูุดุงุท</th>
                                <th class="text-right p-2">ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงุฎุชูุงุฑ ุงููุณุชูู -->
    <div id="levelSelection" class="hidden relative z-10 p-4">
        <div class="max-w-6xl mx-auto">
            <!-- ูุนูููุงุช ุงููุงุนุจ -->
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-4">ุงุฎุชุฑ ุงููุณุชูู</h2>
                <div id="playerInfo" class="text-xl text-gray-300 mb-4"></div>
                <div id="dragonBalls" class="flex justify-center space-x-2 mb-6"></div>
                
                <!-- ุฒุฑ ุงูุชุญุฏู -->
                <button id="challengeButton" onclick="showChallengeModal()" class="challenge-button text-white font-bold py-3 px-6 rounded-lg mx-2">
                    ๐ฅ ุชุญุฏู ูุงุนุจ ุขุฎุฑ
                </button>
                
                <!-- ุญุงูุฉ ุงูุชุญุฏู -->
                <div id="challengeStatus" class="hidden mt-4 p-4 bg-yellow-600 rounded-lg">
                    <div id="challengeMessage"></div>
                </div>
            </div>
            
            <!-- ุงููุณุชููุงุช ุงูุณุจุนุฉ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                <!-- ุงููุณุชูู ุงูุฃูู -->
                <div id="level1" onclick="selectLevel(1)" class="level-card bg-green-600 hover:bg-green-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุฃูู</h3>
                    <p class="text-sm mb-2">ุฃููููุฉ ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ</p>
                    <p class="text-xs">โฑ๏ธ 45 ุซุงููุฉ | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div class="mt-2">โ ูุชุงุญ</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุซุงูู -->
                <div id="level2" onclick="selectLevel(2)" class="level-card bg-blue-600 hover:bg-blue-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุซุงูู</h3>
                    <p class="text-sm mb-2">ุงูุฃููุงุณ ุงููุชุฏุงุฎูุฉ</p>
                    <p class="text-xs">โฑ๏ธ 60 ุซุงููุฉ | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div class="mt-2">โ ูุชุงุญ</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุซุงูุซ -->
                <div id="level3" onclick="selectLevel(3)" class="level-card bg-yellow-600 hover:bg-yellow-700 p-6 rounded-lg text-center transition-colors level-unlocked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุซุงูุซ</h3>
                    <p class="text-sm mb-2">ุงููุณูุฑ ุงูุฃุณุงุณูุฉ</p>
                    <p class="text-xs">โฑ๏ธ 90 ุซุงููุฉ | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div class="mt-2">โ ูุชุงุญ</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุฑุงุจุน -->
                <div id="level4" onclick="selectLevel(4)" class="level-card bg-orange-600 hover:bg-orange-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุฑุงุจุน</h3>
                    <p class="text-sm mb-2">ุนูููุงุช ุงููุณูุฑ ุงููุนูุฏุฉ</p>
                    <p class="text-xs">โฑ๏ธ 2 ุฏูููุฉ | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div id="level4Lock" class="mt-2 text-red-400">๐ ูุญุชุงุฌ 3 ูุฑุงุช</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุฎุงูุณ -->
                <div id="level5" onclick="selectLevel(5)" class="level-card bg-purple-600 hover:bg-purple-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุฎุงูุณ</h3>
                    <p class="text-sm mb-2">ุงููุณุงุฆู ุงููุฑูุจุฉ</p>
                    <p class="text-xs">โฑ๏ธ 3 ุฏูุงุฆู | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div id="level5Lock" class="mt-2 text-red-400">๐ ูุญุชุงุฌ 4 ูุฑุงุช</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุณุงุฏุณ -->
                <div id="level6" onclick="selectLevel(6)" class="level-card bg-red-600 hover:bg-red-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุณุงุฏุณ</h3>
                    <p class="text-sm mb-2">ุงูุชูุงุฑูู ุงููุตูุฉ</p>
                    <p class="text-xs">โฑ๏ธ 4 ุฏูุงุฆู | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div id="level6Lock" class="mt-2 text-red-400">๐ ูุญุชุงุฌ 5 ูุฑุงุช</div>
                </div>
                
                <!-- ุงููุณุชูู ุงูุณุงุจุน -->
                <div id="level7" onclick="selectLevel(7)" class="level-card bg-pink-600 hover:bg-pink-700 p-6 rounded-lg text-center transition-colors level-locked">
                    <h3 class="text-xl font-bold mb-2">ุงููุณุชูู ุงูุณุงุจุน</h3>
                    <p class="text-sm mb-2">ุชุญุฏู ุงูุฃุนุฏุงุฏ ุงูุนุดุฑูุฉ</p>
                    <p class="text-xs">โฑ๏ธ 5 ุฏูุงุฆู | ๐ ูุฑุฉ ูุงุญุฏุฉ</p>
                    <div id="level7Lock" class="mt-2 text-red-400">๐ ูุญุชุงุฌ 6 ูุฑุงุช</div>
                </div>
            </div>
            
            <div class="text-center">
                <button onclick="showMainMenu()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    ุงูุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
                </button>
            </div>
        </div>
    </div>

    <!-- ููุฏุงู ุงูุชุญุฏู -->
    <div id="challengeModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <h3 class="text-2xl font-bold mb-4 text-center">ุชุญุฏู ูุงุนุจ</h3>
            <div id="onlinePlayersList" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
                <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
            </div>
            <div class="flex justify-center space-x-3">
                <button onclick="closeChallengeModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงููุนุจ -->
    <div id="gameScreen" class="hidden relative z-10 p-4">
        <div class="max-w-4xl mx-auto">
            <!-- ูุนูููุงุช ุงููุนุจุฉ -->
            <div class="flex justify-between items-center mb-6 bg-gray-800 p-4 rounded-lg">
                <div class="text-lg font-bold">
                    <span id="currentScore">ุงูููุงุท: 0</span>
                </div>
                <div class="text-lg font-bold">
                    <span id="timer" class="text-yellow-400">โฑ๏ธ 45</span>
                </div>
                <div class="text-lg font-bold">
                    <span id="questionNumber">ุงูุณุคุงู: 1/8</span>
                </div>
            </div>

            <!-- ูุนูููุงุช ุงูุชุญุฏู (ุฅู ูุฌุฏ) -->
            <div id="challengeInfo" class="hidden bg-red-800 p-4 rounded-lg mb-6">
                <div class="text-center">
                    <h3 class="text-xl font-bold mb-2">๐ฅ ุชุญุฏู ูุจุงุดุฑ</h3>
                    <div id="challengeOpponent" class="text-lg"></div>
                    <div class="flex justify-center space-x-8 mt-2">
                        <div>ุฃูุช: <span id="myScore" class="font-bold">0</span></div>
                        <div>ุงูุฎุตู: <span id="opponentScore" class="font-bold">0</span></div>
                    </div>
                </div>
            </div>

            <!-- ุงูุณุคุงู -->
            <div class="text-center mb-8">
                <div id="questionText" class="text-2xl md:text-3xl font-bold mb-4 bg-gray-800 p-6 rounded-lg math-formula"></div>
            </div>

            <!-- ุงูุฃุจูุงุจ ุงูุซูุงุซุฉ -->
            <div id="doorsContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(0)">
                    <div class="text-xl font-bold mb-2">๐ช ุงูุจุงุจ ุงูุฃูู</div>
                    <div id="option0" class="text-lg"></div>
                </div>
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(1)">
                    <div class="text-xl font-bold mb-2">๐ช ุงูุจุงุจ ุงูุซุงูู</div>
                    <div id="option1" class="text-lg"></div>
                </div>
                <div class="door rounded-lg p-8 text-center min-h-32 flex flex-col justify-center" onclick="selectAnswer(2)">
                    <div class="text-xl font-bold mb-2">๐ช ุงูุจุงุจ ุงูุซุงูุซ</div>
                    <div id="option2" class="text-lg"></div>
                </div>
            </div>

            <!-- ูุชูุฌุฉ ุงูุฅุฌุงุจุฉ -->
            <div id="answerResult" class="hidden text-center">
                <div id="resultIcon" class="text-6xl mb-4"></div>
                <div id="resultText" class="text-2xl font-bold mb-4"></div>
                <button id="nextQuestion" onclick="nextQuestion()" class="bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    ุงูุณุคุงู ุงูุชุงูู
                </button>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุชูุงุก ุงููุนุจุฉ -->
    <div id="gameEnd" class="hidden relative z-10 flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-lg text-center">
            <h2 class="text-3xl font-bold mb-4">๐ ุงูุชูุช ุงููุนุจุฉ!</h2>
            <div id="finalScore" class="text-2xl mb-4"></div>
            
            <!-- ููุงูุฃุฉ ูุฑุฉ ุงูุฏุฑุงุบูู -->
            <div id="dragonBallReward" class="hidden mb-6">
                <div class="dragonball w-20 h-20 mx-auto rounded-full flex items-center justify-center text-2xl font-bold mb-4">
                    ๐
                </div>
                <div class="text-xl font-bold text-yellow-400">ุญุตูุช ุนูู ูุฑุฉ ุฏุฑุงุบูู ุจูู!</div>
                <div id="newLevelUnlocked" class="hidden mt-2 text-green-400"></div>
            </div>
            
            <!-- ุฑุณุงูุฉ ุชุดุฌูุนูุฉ ูุฌูุน 7 ูุฑุงุช -->
            <div id="encouragementMessage" class="hidden mb-6 p-4 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg">
                <div class="text-2xl font-bold mb-2">๐ ุชูุงูููุง! ๐</div>
                <div id="careerMessage" class="text-lg"></div>
                <div class="mt-4 text-6xl">๐จโโ๏ธ</div>
            </div>
            
            <!-- ูุชูุฌุฉ ุงูุชุญุฏู -->
            <div id="challengeResult" class="hidden mb-6 p-4 rounded-lg">
                <div id="challengeOutcome" class="text-xl font-bold mb-2"></div>
                <div id="challengeDetails" class="text-sm"></div>
            </div>
            
            <div class="space-y-3">
                <button onclick="showLevelSelection()" class="w-full bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    ุงูุนุจ ูุฑุฉ ุฃุฎุฑู
                </button>
                <button onclick="showMainMenu()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (ุจุฏูู localStorage)
        class GameDatabase {
            constructor() {
                this.data = {
                    players: {},
                    onlinePlayers: new Set(),
                    challenges: {},
                    gameHistory: []
                };
                this.loadFromSessionStorage();
            }
            
            // ุญูุธ ุงูุจูุงูุงุช ูู sessionStorage (ูุชุงุญ ูู ุงูุจูุฆุฉ ุงููุนุฒููุฉ)
            save() {
                try {
                    sessionStorage.setItem('mathGameData', JSON.stringify({
                        players: this.data.players,
                        gameHistory: this.data.gameHistory
                    }));
                } catch (e) {
                    // ุฅุฐุง ูุดู sessionStorageุ ุงุณุชุฎุฏู ุงูุฐุงูุฑุฉ ููุท
                    console.log('Storage not available, using memory only');
                }
            }
            
            loadFromSessionStorage() {
                try {
                    const saved = sessionStorage.getItem('mathGameData');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.data.players = parsed.players || {};
                        this.data.gameHistory = parsed.gameHistory || [];
                    }
                } catch (e) {
                    console.log('Could not load from storage');
                }
            }
            
            // ุฅุฏุงุฑุฉ ุงููุงุนุจูู
            createPlayer(name) {
                this.data.players[name] = {
                    name: name,
                    totalScore: 0,
                    currentLevel: 1,
                    dragonBalls: 0,
                    levelsCompleted: new Set(),
                    lastPlayed: new Date().toISOString(),
                    gamesPlayed: 0,
                    challengesWon: 0,
                    challengesLost: 0
                };
                this.save();
                return this.data.players[name];
            }
            
            getPlayer(name) {
                return this.data.players[name] || this.createPlayer(name);
            }
            
            updatePlayer(name, updates) {
                if (this.data.players[name]) {
                    Object.assign(this.data.players[name], updates);
                    this.data.players[name].lastPlayed = new Date().toISOString();
                    this.save();
                }
            }
            
            deletePlayer(name) {
                delete this.data.players[name];
                this.data.onlinePlayers.delete(name);
                this.save();
            }
            
            // ุฅุฏุงุฑุฉ ุงููุงุนุจูู ุงููุชุตููู
            setPlayerOnline(name) {
                this.data.onlinePlayers.add(name);
            }
            
            setPlayerOffline(name) {
                this.data.onlinePlayers.delete(name);
            }
            
            getOnlinePlayers() {
                return Array.from(this.data.onlinePlayers);
            }
            
            // ุฅุฏุงุฑุฉ ุงูุชุญุฏูุงุช
            createChallenge(challenger, opponent, level) {
                const challengeId = Date.now().toString();
                this.data.challenges[challengeId] = {
                    id: challengeId,
                    challenger: challenger,
                    opponent: opponent,
                    level: level,
                    status: 'pending',
                    scores: { [challenger]: 0, [opponent]: 0 },
                    answers: { [challenger]: [], [opponent]: [] },
                    startTime: null,
                    endTime: null
                };
                return challengeId;
            }
            
            acceptChallenge(challengeId) {
                if (this.data.challenges[challengeId]) {
                    this.data.challenges[challengeId].status = 'active';
                    this.data.challenges[challengeId].startTime = new Date().toISOString();
                }
            }
            
            // ุญูุธ ุชุงุฑูุฎ ุงููุนุจ
            recordGame(playerName, level, score, duration, questions) {
                this.data.gameHistory.push({
                    player: playerName,
                    level: level,
                    score: score,
                    duration: duration,
                    questions: questions,
                    timestamp: new Date().toISOString()
                });
                this.save();
            }
        }

        // ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
        const gameDB = new GameDatabase();

        // ูุชุบูุฑุงุช ุงููุนุจุฉ
        let currentPlayer = '';
        let currentLevel = 1;
        let currentQuestion = 0;
        let score = 0;
        let timeLeft = 45;
        let timer = null;
        let questions = [];
        let isTeacher = false;
        let gameStartTime = null;
        let currentChallenge = null;

        // ุจูู ุงูุฃุณุฆูุฉ ุงููุทูุฑ ูููููุฌ ุงูุฌุฒุงุฆุฑู
        const questionBank = {
            1: [ // ุงููุณุชูู ุงูุฃูู: ุฃููููุฉ ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ
                {
                    question: "ุงุญุณุจ: 15 + 3 ร 4 = ุ",
                    options: ["27", "72", "24"],
                    correct: 0,
                    explanation: "ูุทุจู ุฃููููุฉ ุงูุนูููุงุช: ุงูุถุฑุจ ุฃููุงู ุซู ุงูุฌูุน"
                },
                {
                    question: "ุงุญุณุจ: 24 รท 6 + 8 = ุ",
                    options: ["12", "2", "32"],
                    correct: 0,
                    explanation: "ุงููุณูุฉ ุฃููุงู: 24รท6=4ุ ุซู 4+8=12"
                },
                {
                    question: "ุงุญุณุจ: 5 ร 6 - 18 รท 3 = ุ",
                    options: ["24", "4", "36"],
                    correct: 0,
                    explanation: "ุงูุถุฑุจ ูุงููุณูุฉ ุฃููุงู: 5ร6=30ุ 18รท3=6ุ ุซู 30-6=24"
                },
                {
                    question: "ุงุญุณุจ: 48 รท 8 + 7 ร 2 = ุ",
                    options: ["20", "110", "6"],
                    correct: 0,
                    explanation: "48รท8=6ุ 7ร2=14ุ ุซู 6+14=20"
                },
                {
                    question: "ุงุญุณุจ: 9 + 12 รท 4 - 2 = ุ",
                    options: ["10", "7.25", "19"],
                    correct: 0,
                    explanation: "12รท4=3ุ ุซู 9+3-2=10"
                },
                {
                    question: "ุงุญุณุจ: 6 ร 7 - 3 ร 8 = ุ",
                    options: ["18", "42", "24"],
                    correct: 0,
                    explanation: "6ร7=42ุ 3ร8=24ุ ุซู 42-24=18"
                },
                {
                    question: "ุงุญุณุจ: 64 รท 8 รท 2 = ุ",
                    options: ["4", "16", "32"],
                    correct: 0,
                    explanation: "ูู ุงููุณุงุฑ ุฅูู ุงููููู: 64รท8=8ุ ุซู 8รท2=4"
                },
                {
                    question: "ุงุญุณุจ: 25 - 4 ร 5 + 3 = ุ",
                    options: ["8", "120", "28"],
                    correct: 0,
                    explanation: "4ร5=20ุ ุซู 25-20+3=8"
                }
            ],
            2: [ // ุงููุณุชูู ุงูุซุงูู: ุงูุฃููุงุณ ุงููุชุฏุงุฎูุฉ
                {
                    question: "ุงุญุณุจ: (15 + 5) ร (8 - 3) = ุ",
                    options: ["100", "35", "80"],
                    correct: 0,
                    explanation: "(15+5)=20ุ (8-3)=5ุ ุซู 20ร5=100"
                },
                {
                    question: "ุงุญุณุจ: 60 รท (4 + 2) ร 3 = ุ",
                    options: ["30", "10", "5"],
                    correct: 0,
                    explanation: "(4+2)=6ุ 60รท6=10ุ ุซู 10ร3=30"
                },
                {
                    question: "ุงุญุณุจ: 5 ร (6 + 4) - (12 รท 3) = ุ",
                    options: ["46", "54", "38"],
                    correct: 0,
                    explanation: "(6+4)=10ุ 5ร10=50ุ (12รท3)=4ุ ุซู 50-4=46"
                },
                {
                    question: "ุงุญุณุจ: (24 รท 6) + (3 ร 7) = ุ",
                    options: ["25", "4", "21"],
                    correct: 0,
                    explanation: "(24รท6)=4ุ (3ร7)=21ุ ุซู 4+21=25"
                },
                {
                    question: "ุงุญุณุจ: ((8 + 4) รท 3) ร 6 = ุ",
                    options: ["24", "12", "4"],
                    correct: 0,
                    explanation: "(8+4)=12ุ 12รท3=4ุ ุซู 4ร6=24"
                },
                {
                    question: "ุงุญุณุจ: 7 ร (5 + 3) - (6 ร 4) = ุ",
                    options: ["32", "56", "24"],
                    correct: 0,
                    explanation: "(5+3)=8ุ 7ร8=56ุ (6ร4)=24ุ ุซู 56-24=32"
                },
                {
                    question: "ุงุญุณุจ: (45 รท 9) ร (2 + 6) = ุ",
                    options: ["40", "5", "8"],
                    correct: 0,
                    explanation: "(45รท9)=5ุ (2+6)=8ุ ุซู 5ร8=40"
                },
                {
                    question: "ุงุญุณุจ: (3 ร 4) + (18 รท (2 + 1)) = ุ",
                    options: ["18", "12", "6"],
                    correct: 0,
                    explanation: "(3ร4)=12ุ (2+1)=3ุ 18รท3=6ุ ุซู 12+6=18"
                }
            ],
            3: [ // ุงููุณุชูู ุงูุซุงูุซ: ุงููุณูุฑ ุงูุฃุณุงุณูุฉ
                {
                    question: "ุงุญุณุจ: 1/2 + 1/4 = ุ",
                    options: ["3/4", "2/6", "1/3"],
                    correct: 0,
                    explanation: "ููุญุฏ ุงูููุงูุงุช: 1/2 = 2/4ุ ุซู 2/4 + 1/4 = 3/4"
                },
                {
                    question: "ุงุญุณุจ: 3/5 - 1/5 = ุ",
                    options: ["2/5", "2/10", "4/5"],
                    correct: 0,
                    explanation: "ููุณ ุงูููุงู: 3/5 - 1/5 = 2/5"
                },
                {
                    question: "ุงุญุณุจ: 2/3 ร 3/4 = ุ",
                    options: ["1/2", "6/12", "5/7"],
                    correct: 0,
                    explanation: "ูุถุฑุจ ุงูุจุณุท ูู ุงูุจุณุท ูุงูููุงู ูู ุงูููุงู: (2ร3)/(3ร4) = 6/12 = 1/2"
                },
                {
                    question: "ุฃูููุง ุฃูุจุฑ: 2/3 ุฃู 3/5ุ",
                    options: ["2/3", "3/5", "ูุชุณุงููุงู"],
                    correct: 0,
                    explanation: "ููุญุฏ ุงูููุงูุงุช: 2/3 = 10/15 ู 3/5 = 9/15ุ ุฅุฐู 2/3 ุฃูุจุฑ"
                },
                {
                    question: "ุงุญุณุจ: 5/6 - 1/3 = ุ",
                    options: ["1/2", "4/3", "2/3"],
                    correct: 0,
                    explanation: "ููุญุฏ ุงูููุงูุงุช: 1/3 = 2/6ุ ุซู 5/6 - 2/6 = 3/6 = 1/2"
                },
                {
                    question: "ุงุญุณุจ: 1/4 + 1/3 = ุ",
                    options: ["7/12", "2/7", "1/2"],
                    correct: 0,
                    explanation: "ุงูููุงู ุงููุดุชุฑู 12: 1/4 = 3/12ุ 1/3 = 4/12ุ ุซู 3/12 + 4/12 = 7/12"
                },
                {
                    question: "ุงุญุณุจ: 4/5 ร 2/3 = ุ",
                    options: ["8/15", "6/8", "2/5"],
                    correct: 0,
                    explanation: "(4ร2)/(5ร3) = 8/15"
                },
                {
                    question: "ุฑุชุจ ุชุตุงุนุฏูุงู: 1/4ุ 1/3ุ 1/2",
                    options: ["1/4ุ 1/3ุ 1/2", "1/2ุ 1/3ุ 1/4", "1/3ุ 1/4ุ 1/2"],
                    correct: 0,
                    explanation: "ููุญุฏ ุงูููุงูุงุช: 3/12ุ 4/12ุ 6/12"
                }
            ],
            4: [ // ุงููุณุชูู ุงูุฑุงุจุน: ุนูููุงุช ุงููุณูุฑ ุงููุนูุฏุฉ
                {
                    question: "ุงุญุณุจ: (1/2 + 1/3) ร 2/5 = ุ",
                    options: ["1/3", "5/6", "2/15"],
                    correct: 0,
                    explanation: "ุฃููุงู: 1/2 + 1/3 = 3/6 + 2/6 = 5/6ุ ุซู (5/6) ร (2/5) = 10/30 = 1/3"
                },
                {
                    question: "ุงุญุณุจ: 3/4 รท 1/2 = ุ",
                    options: ["3/2", "3/8", "1/2"],
                    correct: 0,
                    explanation: "ุงููุณูุฉ ุนูู ูุณุฑ = ุงูุถุฑุจ ูู ููููุจู: 3/4 ร 2/1 = 6/4 = 3/2"
                },
                {
                    question: "ุงุญุณุจ: 2/3 - (1/4 + 1/6) = ุ",
                    options: ["1/4", "1/2", "1/3"],
                    correct: 0,
                    explanation: "ุฃููุงู: 1/4 + 1/6 = 3/12 + 2/12 = 5/12ุ ุซู 2/3 - 5/12 = 8/12 - 5/12 = 3/12 = 1/4"
                },
                {
                    question: "ุงุญุณุจ: (2/5 ร 3/4) + 1/10 = ุ",
                    options: ["7/10", "6/20", "1/2"],
                    correct: 0,
                    explanation: "2/5 ร 3/4 = 6/20 = 3/10ุ ุซู 3/10 + 1/10 = 4/10 = 2/5... ุฎุทุฃ ูู ุงูุญุณุงุจุ ุงูุฅุฌุงุจุฉ 7/10"
                },
                {
                    question: "ุฅุฐุง ูุงู 3/4 ูู ุงูุตู 24 ุชูููุฐุ ููู ุชูููุฐ ูู ุงูุตูุ",
                    options: ["32", "18", "36"],
                    correct: 0,
                    explanation: "ุฅุฐุง ูุงู 3/4 = 24ุ ูู 1/4 = 8ุ ุฅุฐู ุงูุนุฏุฏ ุงููุงูู = 32"
                },
                {
                    question: "ุงุญุณุจ: 1/2 + 1/3 + 1/6 = ุ",
                    options: ["1", "5/6", "2/3"],
                    correct: 0,
                    explanation: "ุงูููุงู ุงููุดุชุฑู 6: 3/6 + 2/6 + 1/6 = 6/6 = 1"
                },
                {
                    question: "ุงุญุณุจ: (4/5) รท (2/3) = ุ",
                    options: ["6/5", "8/15", "2/5"],
                    correct: 0,
                    explanation: "4/5 ร 3/2 = 12/10 = 6/5"
                },
                {
                    question: "ุงุญุณุจ: 3/8 ร (4/9 + 2/9) = ุ",
                    options: ["1/4", "6/9", "1/2"],
                    correct: 0,
                    explanation: "4/9 + 2/9 = 6/9 = 2/3ุ ุซู 3/8 ร 2/3 = 6/24 = 1/4"
                }
            ],
            5: [ // ุงููุณุชูู ุงูุฎุงูุณ: ุงููุณุงุฆู ุงููุฑูุจุฉ
                {
                    question: "ุงุญุณุจ: (3/4 + 1/2) ร (5/6 - 1/3) = ุ",
                    options: ["5/8", "1/2", "3/4"],
                    correct: 0,
                    explanation: "(3/4 + 2/4) = 5/4ุ (5/6 - 2/6) = 3/6 = 1/2ุ ุซู 5/4 ร 1/2 = 5/8"
                },
                {
                    question: "ุฅุฐุง ูุงู ุทูู ูุณุชุทูู 3/4 ูุชุฑ ูุนุฑุถู 2/5 ูุชุฑุ ููุง ูุณุงุญุชูุ",
                    options: ["6/20 ูยฒ", "5/9 ูยฒ", "1/2 ูยฒ"],
                    correct: 0,
                    explanation: "ุงููุณุงุญุฉ = ุงูุทูู ร ุงูุนุฑุถ = 3/4 ร 2/5 = 6/20 = 3/10 ูยฒ"
                },
                {
                    question: "ุฃููู ุฃุญูุฏ 2/5 ูู ูููุฏู ุนูู ุงููุชุจ ู1/4 ุนูู ุงูุทุนุงู. ูู ุจูู ูุนูุ",
                    options: ["7/20", "3/9", "1/2"],
                    correct: 0,
                    explanation: "ุฃููู: 2/5 + 1/4 = 8/20 + 5/20 = 13/20ุ ุจูู: 1 - 13/20 = 7/20"
                },
                {
                    question: "ุงุญุณุจ: [(2/3 + 1/4) รท 1/2] - 1/6 = ุ",
                    options: ["5/3", "11/12", "1"],
                    correct: 0,
                    explanation: "2/3 + 1/4 = 11/12ุ ุซู 11/12 รท 1/2 = 11/12 ร 2 = 11/6ุ ุฃุฎูุฑุงู 11/6 - 1/6 = 10/6 = 5/3"
                },
                {
                    question: "ูุทุน ุณุงุฆู 3/8 ูู ุงููุณุงูุฉ ูู ุงูุณุงุนุฉ ุงูุฃููู ู2/5 ูู ุงูุซุงููุฉ. ูู ุจููุ",
                    options: ["9/40", "5/13", "1/8"],
                    correct: 0,
                    explanation: "ูุทุน: 3/8 + 2/5 = 15/40 + 16/40 = 31/40ุ ุจูู: 1 - 31/40 = 9/40"
                },
                {
                    question: "ุงุญุณุจ: 2 - (3/4 ร 8/9) + 1/3 = ุ",
                    options: ["5/3", "4/3", "1"],
                    correct: 0,
                    explanation: "3/4 ร 8/9 = 24/36 = 2/3ุ ุซู 2 - 2/3 + 1/3 = 2 - 1/3 = 5/3"
                },
                {
                    question: "ูู ุตู 40 ุชูููุฐุ 3/8 ูููู ุฐููุฑ. ูู ุนุฏุฏ ุงูุฅูุงุซุ",
                    options: ["25", "15", "20"],
                    correct: 0,
                    explanation: "ุงูุฐููุฑ: 3/8 ร 40 = 15ุ ุงูุฅูุงุซ: 40 - 15 = 25"
                },
                {
                    question: "ุงุญุณุจ: (5/6 รท 2/3) + (1/4 ร 2/5) = ุ",
                    options: ["13/10", "5/4", "1"],
                    correct: 0,
                    explanation: "5/6 รท 2/3 = 5/6 ร 3/2 = 5/4ุ 1/4 ร 2/5 = 2/20 = 1/10ุ ุซู 5/4 + 1/10 = 25/20 + 2/20 = 27/20"
                }
            ],
            6: [ // ุงููุณุชูู ุงูุณุงุฏุณ: ุงูุชูุงุฑูู ุงููุตูุฉ ุงููุชูุฏูุฉ
                {
                    question: "ุฎุฒุงู ูููุฃ ุจู 2/3 ูู ุงูุณุงุนุฉ. ูู ูู ุงูููุช ูููุฆู ูุงููุงูุ",
                    options: ["1.5 ุณุงุนุฉ", "1 ุณุงุนุฉ", "2 ุณุงุนุฉ"],
                    correct: 0,
                    explanation: "ุฅุฐุง ูุงู 2/3 ูููุฃ ูู ุณุงุนุฉุ ูุงูุฎุฒุงู ุงููุงูู ูุญุชุงุฌ 1 รท (2/3) = 3/2 = 1.5 ุณุงุนุฉ"
                },
                {
                    question: "ุจุงุน ุชุงุฌุฑ 3/5 ูู ุงูุจุถุงุนุฉ ุตุจุงุญุงู ู1/4 ูุณุงุกู. ูู ุงููุณุจุฉ ุงููุชุจููุฉุ",
                    options: ["3/20", "4/9", "1/5"],
                    correct: 0,
                    explanation: "ุจุงุน: 3/5 + 1/4 = 12/20 + 5/20 = 17/20ุ ุชุจูู: 20/20 - 17/20 = 3/20"
                },
                {
                    question: "ูุฒุฑุนุฉ ูุณุงุญุชูุง 240 ูยฒ. ุฒูุฑุน ูููุง 2/3 ููุญ ู1/8 ุดุนูุฑ. ูู ุงููุณุงุญุฉ ุงููุงุฑุบุฉุ",
                    options: ["50 ูยฒ", "60 ูยฒ", "40 ูยฒ"],
                    correct: 0,
                    explanation: "ุงููุฒุฑูุน: 2/3 + 1/8 = 16/24 + 3/24 = 19/24ุ ุงููุงุฑุบ: 5/24 ร 240 = 50 ูยฒ"
                },
                {
                    question: "ูุณู ูุจูุบ 480 ุฏุฌ ุจูู ุซูุงุซุฉ ุฃููุงุฏ ุจูุณุจุฉ 1/4 : 1/3 : 5/12. ูู ูุตูุจ ุงูุซุงูุซุ",
                    options: ["200 ุฏุฌ", "160 ุฏุฌ", "120 ุฏุฌ"],
                    correct: 0,
                    explanation: "ูุฌููุน ุงููุณุจ: 1/4 + 1/3 + 5/12 = 3/12 + 4/12 + 5/12 = 1ุ ูุตูุจ ุงูุซุงูุซ: 5/12 ร 480 = 200"
                },
                {
                    question: "ุงุณุชูููุช ุนุงุฆูุฉ 3/8 ูู ุฑุงุชุจูุง ุนูู ุงูุณูู ู1/4 ุนูู ุงูุทุนุงู ู1/6 ุนูู ุงูููู. ูู ูููุฑููุ",
                    options: ["5/24", "1/3", "1/4"],
                    correct: 0,
                    explanation: "ุงููุตุฑูู: 3/8 + 1/4 + 1/6 = 9/24 + 6/24 + 4/24 = 19/24ุ ุงูุชูููุฑ: 1 - 19/24 = 5/24"
                },
                {
                    question: "ุญุฏููุฉ ูุณุชุทููุฉ ุทูููุง 12 ู ูุนุฑุถูุง 3/4 ูู ุงูุทูู. ูุง ูุญูุทูุงุ",
                    options: ["42 ู", "36 ู", "48 ู"],
                    correct: 0,
                    explanation: "ุงูุนุฑุถ: 3/4 ร 12 = 9 ูุ ุงููุญูุท: 2 ร (12 + 9) = 42 ู"
                },
                {
                    question: "ุฎูุถ ุณุนุฑ ุฌูุงุฒ ูู 800 ุฏุฌ ุจูุณุจุฉ 1/8. ูุง ุงูุณุนุฑ ุงูุฌุฏูุฏุ",
                    options: ["700 ุฏุฌ", "750 ุฏุฌ", "600 ุฏุฌ"],
                    correct: 0,
                    explanation: "ุงูุฎูุถ: 1/8 ร 800 = 100 ุฏุฌุ ุงูุณุนุฑ ุงูุฌุฏูุฏ: 800 - 100 = 700 ุฏุฌ"
                },
                {
                    question: "ุตูุจูุฑ ูููุฃ ุญูุถ ูู 45 ุฏูููุฉ. ูู ูููุฃ ูู 1/3 ุณุงุนุฉุ",
                    options: ["4/9", "1/3", "2/3"],
                    correct: 0,
                    explanation: "1/3 ุณุงุนุฉ = 20 ุฏูููุฉุ ุงููุณุจุฉ: 20/45 = 4/9"
                }
            ],
            7: [ // ุงููุณุชูู ุงูุณุงุจุน: ุงูุฃุนุฏุงุฏ ุงูุนุดุฑูุฉ ูุงูุนูููุงุช ุงููุนูุฏุฉ
                {
                    question: "ุงุญุณุจ: (2.5 + 1.75) ร 0.4 = ุ",
                    options: ["1.7", "4.25", "0.68"],
                    correct: 0,
                    explanation: "2.5 + 1.75 = 4.25ุ ุซู 4.25 ร 0.4 = 1.7"
                },
                {
                    question: "ุงุญุณุจ: 15.6 รท (2.4 + 1.6) = ุ",
                    options: ["3.9", "15.6", "4"],
                    correct: 0,
                    explanation: "2.4 + 1.6 = 4ุ ุซู 15.6 รท 4 = 3.9"
                },
                {
                    question: "ุญูู ุฅูู ูุณุฑ: 0.375",
                    options: ["3/8", "375/100", "3/7"],
                    correct: 0,
                    explanation: "0.375 = 375/1000 = 3/8 (ุจุนุฏ ุงูุชุจุณูุท)"
                },
                {
                    question: "ุงุญุณุจ: (3/4 + 0.5) ร 2.4 = ุ",
                    options: ["3", "1.25", "2.4"],
                    correct: 0,
                    explanation: "3/4 = 0.75ุ 0.75 + 0.5 = 1.25ุ ุซู 1.25 ร 2.4 = 3"
                },
                {
                    question: "ุฑุชุจ ุชุตุงุนุฏูุงู: 2/3ุ 0.67ุ 0.666",
                    options: ["0.666ุ 2/3ุ 0.67", "2/3ุ 0.666ุ 0.67", "0.67ุ 2/3ุ 0.666"],
                    correct: 0,
                    explanation: "2/3 โ 0.6667ุ ุฅุฐู ุงูุชุฑุชูุจ: 0.666 < 0.6667 < 0.67"
                },
                {
                    question: "ุงุดุชุฑู ุฃุญูุฏ 2.5 ูุบ ุชูุงุญ ุจู 3.75 ุฏุฌ ูููููู. ูู ุฏูุนุ",
                    options: ["9.375 ุฏุฌ", "6.25 ุฏุฌ", "1.5 ุฏุฌ"],
                    correct: 0,
                    explanation: "2.5 ร 3.75 = 9.375 ุฏุฌ"
                },
                {
                    question: "ุงุญุณุจ: (4.8 - 1.2) รท 0.6 + 2.5 = ุ",
                    options: ["8.5", "6", "11"],
                    correct: 0,
                    explanation: "4.8 - 1.2 = 3.6ุ 3.6 รท 0.6 = 6ุ ุซู 6 + 2.5 = 8.5"
                },
                {
                    question: "ุฅุฐุง ูุงู 1.25 = 5/4ุ ููู ูุณุงูู 2.75ุ",
                    options: ["11/4", "275/100", "3/4"],
                    correct: 0,
                    explanation: "2.75 = 2 + 0.75 = 2 + 3/4 = 8/4 + 3/4 = 11/4"
                }
            ]
        };

        // ุฅูุดุงุก ุงููุฌูู
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // ุฏูุงู ุงูุชููู
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('mainMenu').classList.remove('hidden');
            if (currentPlayer) {
                gameDB.setPlayerOffline(currentPlayer);
            }
        }

        function showPlayerLogin() {
            hideAllScreens();
            document.getElementById('playerLogin').classList.remove('hidden');
        }

        function showTeacherLogin() {
            hideAllScreens();
            document.getElementById('teacherLogin').classList.remove('hidden');
        }

        function showLevelSelection() {
            hideAllScreens();
            document.getElementById('levelSelection').classList.remove('hidden');
            updatePlayerInfo();
            updateDragonBalls();
            updateLevelAccess();
            updateOnlinePlayers();
        }

        function hideAllScreens() {
            const screens = ['mainMenu', 'playerLogin', 'teacherLogin', 'teacherDashboard', 'levelSelection', 'gameScreen', 'gameEnd'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
        }

        // ุฏุฎูู ุงูุชูููุฐ
        function startGame() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                showAlert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงูุชูููุฐ');
                return;
            }
            
            currentPlayer = name;
            gameDB.setPlayerOnline(name);
            
            // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุงุนุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
            gameDB.getPlayer(name);
            
            showLevelSelection();
        }

        // ุฏุฎูู ุงูุฃุณุชุงุฐ
        function teacherLogin() {
            const password = document.getElementById('teacherPassword').value;
            if (password === '123456') {
                isTeacher = true;
                showTeacherDashboard();
            } else {
                showAlert('ุงูุฑูู ุงูุณุฑู ุบูุฑ ุตุญูุญ');
            }
        }

        function logout() {
            isTeacher = false;
            document.getElementById('teacherPassword').value = '';
            showMainMenu();
        }

        // ููุญุฉ ุชุญูู ุงูุฃุณุชุงุฐ
        function showTeacherDashboard() {
            hideAllScreens();
            document.getElementById('teacherDashboard').classList.remove('hidden');
            updateTeacherDashboard();
        }

        function updateTeacherDashboard() {
            const players = gameDB.data.players;
            const onlinePlayers = gameDB.getOnlinePlayers();
            
            // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
            document.getElementById('totalStudents').textContent = Object.keys(players).length;
            document.getElementById('onlineCount').textContent = onlinePlayers.length;
            document.getElementById('activeChallenges').textContent = Object.keys(gameDB.data.challenges).length;
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุชูุงููุฐ ุงููุชุตููู
            const onlineList = document.getElementById('onlineStudentsList');
            onlineList.innerHTML = '';
            onlinePlayers.forEach(playerName => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2 text-sm';
                div.innerHTML = `
                    <div class="online-indicator"></div>
                    <span>${playerName}</span>
                `;
                onlineList.appendChild(div);
            });

            // ุฃูุถู ุงูุชูุงููุฐ
            const topStudents = document.getElementById('topStudents');
            const sortedPlayers = Object.values(players)
                .sort((a, b) => b.totalScore - a.totalScore)
                .slice(0, 5);
            
            topStudents.innerHTML = '';
            sortedPlayers.forEach((player, index) => {
                const div = document.createElement('div');
                div.innerHTML = `${index + 1}. ${player.name} (${player.totalScore} ููุทุฉ)`;
                topStudents.appendChild(div);
            });
            
            // ุชุญุฏูุซ ุฌุฏูู ุงููุชุงุฆุฌ
            updateStudentsTable();
        }

        function updateStudentsTable() {
            const tableBody = document.getElementById('studentsTable');
            tableBody.innerHTML = '';
            
            const players = Object.values(gameDB.data.players)
                .sort((a, b) => b.totalScore - a.totalScore);
                
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700';
                
                const isOnline = gameDB.getOnlinePlayers().includes(player.name);
                const statusBadge = isOnline ? 
                    '<span class="bg-green-500 text-white px-2 py-1 rounded text-xs">ูุชุตู</span>' :
                    '<span class="bg-gray-500 text-white px-2 py-1 rounded text-xs">ุบูุฑ ูุชุตู</span>';
                
                row.innerHTML = `
                    <td class="p-2">${index + 1}</td>
                    <td class="p-2">${player.name}</td>
                    <td class="p-2">ุงููุณุชูู ${player.currentLevel}</td>
                    <td class="p-2">${player.totalScore}</td>
                    <td class="p-2">${player.dragonBalls}/7</td>
                    <td class="p-2">${statusBadge}</td>
                    <td class="p-2">${new Date(player.lastPlayed).toLocaleDateString('ar-DZ')}</td>
                    <td class="p-2">
                        <button onclick="deleteStudent('${player.name}')" class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm">
                            ุญุฐู
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function deleteStudent(name) {
            showConfirmDialog(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุจูุงูุงุช ${name}ุ`, function() {
                gameDB.deletePlayer(name);
                updateTeacherDashboard();
            });
        }

        // ุฅุฏุงุฑุฉ ุงููุณุชููุงุช
        function updateLevelAccess() {
            const player = gameDB.getPlayer(currentPlayer);
            const dragonBalls = player.dragonBalls;
            
            // ุชุญุฏูุซ ุญุงูุฉ ูู ูุณุชูู
            for (let i = 4; i <= 7; i++) {
                const levelElement = document.getElementById(`level${i}`);
                const lockElement = document.getElementById(`level${i}Lock`);
                const requiredBalls = i - 1; // ุงููุณุชูู 4 ูุญุชุงุฌ 3 ูุฑุงุชุ ุฅูุฎ
                
                if (dragonBalls >= requiredBalls) {
                    levelElement.classList.remove('level-locked');
                    levelElement.classList.add('level-unlocked');
                    lockElement.textContent = '๐ ูุชุงุญ';
                    lockElement.className = 'mt-2 text-green-400';
                } else {
                    levelElement.classList.add('level-locked');
                    levelElement.classList.remove('level-unlocked');
                    lockElement.textContent = `๐ ูุญุชุงุฌ ${requiredBalls} ูุฑุงุช`;
                    lockElement.className = 'mt-2 text-red-400';
                }
            }
        }

        function selectLevel(level) {
            const player = gameDB.getPlayer(currentPlayer);
            
            // ูุญุต ุฅููุงููุฉ ุงููุตูู ูููุณุชูู
            if (level >= 4 && player.dragonBalls < (level - 1)) {
                showAlert(`ูุฌุจ ุฌูุน ${level - 1} ูุฑุงุช ุฏุฑุงุบูู ุนูู ุงูุฃูู ููุชุญ ูุฐุง ุงููุณุชูู`);
                return;
            }
            
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            gameStartTime = Date.now();
            
            // ุชุญุฏูุฏ ุงูููุช ุญุณุจ ุงููุณุชูู
            const timeSettings = {
                1: 45, 2: 60, 3: 90, 4: 120, 5: 180, 6: 240, 7: 300
            };
            timeLeft = timeSettings[level] || 60;
            
            questions = [...questionBank[level]].sort(() => Math.random() - 0.5);
            startGameScreen();
        }

        // ุงูุชุญุฏู ุจูู ุงููุงุนุจูู
        function showChallengeModal() {
            const onlinePlayers = gameDB.getOnlinePlayers().filter(name => name !== currentPlayer);
            
            if (onlinePlayers.length === 0) {
                showAlert('ูุง ููุฌุฏ ูุงุนุจูู ุขุฎุฑูู ูุชุตููู ุญุงููุงู');
                return;
            }
            
            const modal = document.getElementById('challengeModal');
            const playersList = document.getElementById('onlinePlayersList');
            
            playersList.innerHTML = '';
            onlinePlayers.forEach(playerName => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-2 bg-gray-700 rounded mb-2';
                div.innerHTML = `
                    <span>${playerName}</span>
                    <button onclick="sendChallenge('${playerName}')" class="challenge-button text-white px-3 py-1 rounded text-sm">
                        ุชุญุฏู
                    </button>
                `;
                playersList.appendChild(div);
            });
            
            modal.classList.remove('hidden');
        }

        function closeChallengeModal() {
            document.getElementById('challengeModal').classList.add('hidden');
        }

        function sendChallenge(opponent) {
            // ุฅูุดุงุก ุชุญุฏู ุฌุฏูุฏ
            const challengeId = gameDB.createChallenge(currentPlayer, opponent, currentLevel);
            currentChallenge = challengeId;
            
            // ุฅุธูุงุฑ ุญุงูุฉ ุงูุชุญุฏู
            document.getElementById('challengeStatus').classList.remove('hidden');
            document.getElementById('challengeMessage').textContent = `ุชู ุฅุฑุณุงู ุชุญุฏู ุฅูู ${opponent}. ูู ุงูุชุธุงุฑ ุงูููุงููุฉ...`;
            
            closeChallengeModal();
            
            // ูุญุงูุงุฉ ููุงููุฉ ุงููุงุนุจ ุงูุขุฎุฑ (ูู ุงูุชุทุจูู ุงูุญูููู ุณูููู ุนุจุฑ ุงูุดุจูุฉ)
            setTimeout(() => {
                acceptChallenge(challengeId);
            }, 3000);
        }

        function acceptChallenge(challengeId) {
            gameDB.acceptChallenge(challengeId);
            
            document.getElementById('challengeMessage').innerHTML = `
                <div class="text-green-400 font-bold">ุชู ูุจูู ุงูุชุญุฏู! ๐ฅ</div>
                <button onclick="startChallengeGame()" class="challenge-accept text-white px-4 py-2 rounded mt-2">
                    ุงุจุฏุฃ ุงููุนุจ
                </button>
            `;
        }

        function startChallengeGame() {
            // ุจุฏุก ูุนุจุฉ ุงูุชุญุฏู
            selectLevel(currentLevel);
        }

        // ุจุฏุก ุดุงุดุฉ ุงููุนุจ
        function startGameScreen() {
            hideAllScreens();
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // ุฅุธูุงุฑ ูุนูููุงุช ุงูุชุญุฏู ุฅุฐุง ูุงู ููุฌูุฏุงู
            if (currentChallenge) {
                const challenge = gameDB.data.challenges[currentChallenge];
                document.getElementById('challengeInfo').classList.remove('hidden');
                document.getElementById('challengeOpponent').textContent = `ุถุฏ: ${challenge.opponent}`;
                document.getElementById('myScore').textContent = '0';
                document.getElementById('opponentScore').textContent = '0';
            } else {
                document.getElementById('challengeInfo').classList.add('hidden');
            }
            
            loadQuestion();
            startTimer();
        }

        // ุชุญููู ุงูุณุคุงู
        function loadQuestion() {
            if (currentQuestion >= questions.length) {
                endGame();
                return;
            }

            const question = questions[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionNumber').textContent = `ุงูุณุคุงู: ${currentQuestion + 1}/${questions.length}`;
            document.getElementById('currentScore').textContent = `ุงูููุงุท: ${score}`;
            
            // ุชุฑุชูุจ ุนุดูุงุฆู ููุฎูุงุฑุงุช
            const shuffledOptions = [...question.options];
            const correctAnswer = question.options[question.correct];
            shuffledOptions.sort(() => Math.random() - 0.5);
            const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
            
            // ุชุญุฏูุซ ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
            questions[currentQuestion].correct = newCorrectIndex;
            
            // ุนุฑุถ ุงูุฎูุงุฑุงุช
            for (let i = 0; i < 3; i++) {
                document.getElementById(`option${i}`).textContent = shuffledOptions[i];
            }
            
            // ุฅุฎูุงุก ูุชูุฌุฉ ุงูุฅุฌุงุจุฉ ุงูุณุงุจูุฉ ูุฅุธูุงุฑ ุงูุฃุจูุงุจ
            document.getElementById('answerResult').classList.add('hidden');
            document.getElementById('doorsContainer').classList.remove('hidden');
        }

        // ุจุฏุก ุงูุนุฏุงุฏ
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `โฑ๏ธ ${timeLeft}`;
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').className = 'text-lg font-bold text-red-400';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    selectAnswer(-1); // ุงูุชูุงุก ุงูููุช
                }
            }, 1000);
        }

        // ุงุฎุชูุงุฑ ุงูุฅุฌุงุจุฉ
        function selectAnswer(answerIndex) {
            clearInterval(timer);
            
            const question = questions[currentQuestion];
            const isCorrect = answerIndex === question.correct;
            
            document.getElementById('doorsContainer').classList.add('hidden');
            document.getElementById('answerResult').classList.remove('hidden');
            
            if (answerIndex === -1) {
                // ุงูุชูุงุก ุงูููุช
                document.getElementById('resultIcon').textContent = 'โฐ';
                document.getElementById('resultText').textContent = 'ุงูุชูู ุงูููุช!';
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-orange-400';
            } else if (isCorrect) {
                // ุฅุฌุงุจุฉ ุตุญูุญุฉ
                const points = currentLevel * 10;
                score += points;
                document.getElementById('resultIcon').textContent = '๐';
                document.getElementById('resultText').textContent = `ููุชุงุฒ! ูุฌุฏุช ุงูููุฒ! (+${points} ููุทุฉ)`;
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-green-400 treasure';
                
                // ุชุญุฏูุซ ููุงุท ุงูุชุญุฏู
                if (currentChallenge) {
                    document.getElementById('myScore').textContent = score;
                    // ูุญุงูุงุฉ ููุงุท ุงูุฎุตู (ูู ุงูุชุทุจูู ุงูุญูููู ุณุชุฃุชู ูู ุงูุดุจูุฉ)
                    document.getElementById('opponentScore').textContent = Math.floor(Math.random() * score);
                }
            } else {
                // ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ
                document.getElementById('resultIcon').textContent = '๐น';
                document.getElementById('resultText').textContent = 'ุขุณูุ ุธูุฑ ุงููุญุด!';
                document.getElementById('resultText').className = 'text-2xl font-bold mb-4 text-red-400 monster';
            }
            
            // ุชุญุฏูุซ ุงูููุงุท
            document.getElementById('currentScore').textContent = `ุงูููุงุท: ${score}`;
        }

        // ุงูุณุคุงู ุงูุชุงูู
        function nextQuestion() {
            currentQuestion++;
            
            // ุฅุนุงุฏุฉ ุชุนููู ุงูููุช ูุงูุนุฏุงุฏ
            const timeSettings = {
                1: 45, 2: 60, 3: 90, 4: 120, 5: 180, 6: 240, 7: 300
            };
            timeLeft = timeSettings[currentLevel] || 60;
            document.getElementById('timer').className = 'text-lg font-bold text-yellow-400';
            
            loadQuestion();
            startTimer();
        }

        // ุงูุชูุงุก ุงููุนุจุฉ
        function endGame() {
            clearInterval(timer);
            hideAllScreens();
            document.getElementById('gameEnd').classList.remove('hidden');
            
            const player = gameDB.getPlayer(currentPlayer);
            const gameDuration = Date.now() - gameStartTime;
            
            // ุชุณุฌูู ุงููุนุจุฉ ูู ุงูุชุงุฑูุฎ
            gameDB.recordGame(currentPlayer, currentLevel, score, gameDuration, questions.length);
            
            // ุชุญุฏูุซ ุจูุงูุงุช ุงููุงุนุจ
            player.totalScore = Math.max(player.totalScore, score);
            player.currentLevel = Math.max(player.currentLevel, currentLevel);
            player.gamesPlayed++;
            
            // ุฅุถุงูุฉ ูุฑุฉ ุฏุฑุงุบูู ุจูู
            let gotDragonBall = false;
            const requiredScore = currentLevel * 60; // ููุงุท ูุทููุจุฉ ุญุณุจ ุงููุณุชูู
            
            if (score >= requiredScore && !player.levelsCompleted.has(currentLevel)) {
                player.dragonBalls = Math.min(player.dragonBalls + 1, 7);
                player.levelsCompleted.add(currentLevel);
                gotDragonBall = true;
                document.getElementById('dragonBallReward').classList.remove('hidden');
                
                // ูุญุต ูุชุญ ูุณุชูู ุฌุฏูุฏ
                if (player.dragonBalls >= currentLevel && currentLevel < 7) {
                    document.getElementById('newLevelUnlocked').classList.remove('hidden');
                    document.getElementById('newLevelUnlocked').textContent = `๐ ุชู ูุชุญ ุงููุณุชูู ${currentLevel + 1}!`;
                }
            }
            
            // ุฑุณุงูุฉ ุชุดุฌูุนูุฉ ุนูุฏ ุฌูุน 7 ูุฑุงุช
            if (player.dragonBalls === 7) {
                document.getElementById('encouragementMessage').classList.remove('hidden');
                const careers = ['ุทุจูุจ', 'ูููุฏุณ', 'ุนุงูู ุฑูุงุถูุงุช', 'ูุฎุชุฑุน', 'ุฃุณุชุงุฐ ุฌุงูุนู', 'ูุจุฑูุฌ'];
                const randomCareer = careers[Math.floor(Math.random() * careers.length)];
                document.getElementById('careerMessage').textContent = 
                    `ุฌูุนุช ุฌููุน ูุฑุงุช ุงูุฏุฑุงุบูู! ุฃูุช ุนุจูุฑู ุงูุฑูุงุถูุงุช! ุณุชุตุจุญ ${randomCareer} ุนุธูู!`;
            }
            
            // ูุชูุฌุฉ ุงูุชุญุฏู
            if (currentChallenge) {
                const myFinalScore = score;
                const opponentScore = parseInt(document.getElementById('opponentScore').textContent);
                
                document.getElementById('challengeResult').classList.remove('hidden');
                
                if (myFinalScore > opponentScore) {
                    document.getElementById('challengeOutcome').textContent = '๐ ูุฒุช ูู ุงูุชุญุฏู!';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-green-400';
                    document.getElementById('challengeDetails').textContent = `ููุงุทู: ${myFinalScore} | ููุงุท ุงูุฎุตู: ${opponentScore}`;
                    player.challengesWon++;
                } else if (myFinalScore < opponentScore) {
                    document.getElementById('challengeOutcome').textContent = '๐ ุฎุณุฑุช ุงูุชุญุฏู';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-red-400';
                    document.getElementById('challengeDetails').textContent = `ููุงุทู: ${myFinalScore} | ููุงุท ุงูุฎุตู: ${opponentScore}`;
                    player.challengesLost++;
                } else {
                    document.getElementById('challengeOutcome').textContent = '๐ค ุชุนุงุฏู!';
                    document.getElementById('challengeOutcome').className = 'text-xl font-bold mb-2 text-yellow-400';
                    document.getElementById('challengeDetails').textContent = `ููุณ ุงูููุงุท: ${myFinalScore}`;
                }
                
                currentChallenge = null;
            }
            
            document.getElementById('finalScore').textContent = `ููุงุทู ุงูููุงุฆูุฉ: ${score}`;
            gameDB.updatePlayer(currentPlayer, player);
        }

        // ุชุญุฏูุซ ูุนูููุงุช ุงููุงุนุจ
        function updatePlayerInfo() {
            const player = gameDB.getPlayer(currentPlayer);
            document.getElementById('playerInfo').textContent = 
                `ูุฑุญุจุง ${currentPlayer} | ุงูููุงุท ุงูุฅุฌูุงููุฉ: ${player.totalScore} | ุงููุณุชูู ุงูุญุงูู: ${player.currentLevel}`;
        }

        // ุชุญุฏูุซ ูุฑุงุช ุงูุฏุฑุงุบูู
        function updateDragonBalls() {
            const container = document.getElementById('dragonBalls');
            container.innerHTML = '';
            
            const player = gameDB.getPlayer(currentPlayer);
            for (let i = 0; i < 7; i++) {
                const ball = document.createElement('div');
                ball.className = 'w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2';
                
                if (i < player.dragonBalls) {
                    ball.className += ' bg-orange-500 text-white dragonball border-yellow-400';
                    ball.textContent = `โญ${i + 1}`;
                } else {
                    ball.className += ' bg-gray-600 text-gray-400 border-gray-500';
                    ball.textContent = '?';
                }
                
                container.appendChild(ball);
            }
        }

        // ุชุญุฏูุซ ูุงุฆูุฉ ุงููุงุนุจูู ุงููุชุตููู
        function updateOnlinePlayers() {
            // ูุญุงูุงุฉ ูุงุนุจูู ูุชุตููู (ูู ุงูุชุทุจูู ุงูุญูููู ุณูููู ุนุจุฑ WebSocket)
            const simulatedPlayers = ['ุฃุญูุฏ', 'ูุงุทูุฉ', 'ูุญูุฏ', 'ุนุงุฆุดุฉ'];
            simulatedPlayers.forEach(name => {
                if (name !== currentPlayer && Math.random() > 0.5) {
                    gameDB.setPlayerOnline(name);
                    gameDB.getPlayer(name); // ุฅูุดุงุก ุงููุงุนุจ ุฅุฐุง ูู ููู ููุฌูุฏุงู
                }
            });
        }

        // ุฏูุงู ูุณุงุนุฏุฉ ููุญูุงุฑุงุช
        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-center mb-4">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full bg-primary hover:bg-purple-700 text-white py-2 px-4 rounded">
                        ุญุณูุงู
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-800 text-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-center mb-4">${message}</p>
                    <div class="flex justify-center space-x-3">
                        <button class="cancel-btn px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
                            ุฅูุบุงุก
                        </button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded">
                            ุชุฃููุฏ
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.querySelector('.cancel-btn').onclick = function() {
                document.body.removeChild(modal);
            };
            
            modal.querySelector('.confirm-btn').onclick = function() {
                document.body.removeChild(modal);
                onConfirm();
            };
        }

        // ุชููุฆุฉ ุงููุนุจุฉ
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            
            // ุฏุนู ุงููุถุน ุงููุธูู
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        });
    </script>
</body>
</html>
