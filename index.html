<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prof Dali Nadjib - Ù…ÙˆÙ„Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .neon-border {
            border: 2px solid transparent;
            background: linear-gradient(45deg, #00f5ff, #ff00ea) border-box;
            border-radius: 12px;
        }
        
        .schedule-table {
            border-collapse: collapse;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        
        .schedule-table th, .schedule-table td {
            border: 2px solid #2d3748;
            padding: 6px;
            text-align: center;
            color: #1a202c;
            min-height: 40px;
            position: relative;
            font-weight: 600;
            font-size: 11px;
            line-height: 1.2;
        }
        
        .schedule-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        
        /* Ù…ÙˆØ§Ø¯ Ø¹Ø§Ø¯ÙŠØ© */
        .subject-cell {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #1a202c;
            font-weight: 700;
            border: 2px solid #4299e1;
        }
        
        /* Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© */
        .teacher-cell {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
            color: #1a202c;
            font-weight: 700;
            border: 2px solid #805ad5;
        }
        
        /* Ø­ØµØµ Ø§Ù„Ø§Ø³ØªØ¯Ø±Ø§Ùƒ - Ø£Ø­Ù…Ø± */
        .remedial-cell {
            background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
            color: white;
            font-weight: 700;
            border: 3px solid #ff2626;
        }
        
        /* Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠØ© */
        .pedagogical-cell {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            color: #1a202c;
            font-weight: 700;
            border: 2px solid #ed8936;
        }
        
        /* Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙˆØ¬Ù‡Ø© - Ø£ØµÙØ± */
        .guided-work-cell {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a202c;
            font-weight: 700;
            border: 3px solid #ffc107;
            position: relative;
        }
        
        /* Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© - Ø£Ø®Ø¶Ø± */
        .practical-work-cell {
            background: linear-gradient(135deg, #28a745 0%, #4caf50 100%);
            color: white;
            font-weight: 700;
            border: 3px solid #1e7e34;
        }
        
        /* Ø®Ø§Ù†Ø§Øª ÙØ§Ø±ØºØ© */
        .empty-cell {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            color: #718096;
            font-style: italic;
        }
        
        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„ */
        .institution-cell {
            padding: 4px;
            font-size: 9px;
            line-height: 1.1;
            border: 1px solid #333;
            min-height: 60px;
            overflow: hidden;
        }
        
        /* ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø®Ø§Ù†Ø§Øª */
        .split-cell {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 0;
        }
        
        .split-half {
            flex: 1;
            padding: 3px 2px;
            text-align: center;
            font-size: 9px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .split-top {
            border-bottom: 2px solid white;
        }
        
        .btn-neon {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-neon:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 25px rgba(102, 126, 234, 0.6);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #00b894, #00cec9);
            box-shadow: 0 0 20px rgba(0, 184, 148, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e17055, #fd79a8);
            box-shadow: 0 0 20px rgba(225, 112, 85, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #fdcb6e, #e84393);
            box-shadow: 0 0 20px rgba(253, 203, 110, 0.4);
        }
        
        .input-neon {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .input-neon:focus {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }
        
        .input-neon::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .developer-profile {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .profile-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .profile-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #667eea;
            margin-bottom: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .legend-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 6px;
            margin-left: 10px;
            border: 2px solid #333;
        }
        
        .alert-card {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            color: #ff6b6b;
        }
        
        .success-card {
            background: rgba(0, 184, 148, 0.2);
            border: 2px solid #00b894;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            color: #00b894;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            .glass-card { background: white !important; backdrop-filter: none !important; }
            .developer-profile { display: none !important; }
        }
        
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #667eea;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header-text {
            color: #e2e8f0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .republic-text {
            color: #cbd5e0;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Developer Profile Card -->
    <div class="developer-profile no-print">
        <div class="profile-card">
            <img src="https://pfst.cf2.poecdn.net/base/image/a7a07166865540a345db85a655659bf7bfe054bf53d2195c6a2b7002fc9a746f?w=1024&h=1536" 
                 alt="Prof Dali Nadjib" class="profile-img">
            <div class="text-xs text-white font-bold">Prof Dali Nadjib</div>
            <div class="text-xs text-gray-300">AI Developer</div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8 fade-in">
            <div class="glass-card rounded-2xl p-8 neon-border">
                <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent mb-4">
                    ğŸ“ AI Prof Dali Nadjib
                </h1>
                <p class="text-2xl header-text mb-3">
                    Ù…ÙˆÙ„Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø·ÙˆØ±
                </p>
                <p class="text-lg header-text mb-2">
                    Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© - Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ ÙˆÙ…ØªØ±Ø§Ø¨Ø·
                </p>
                <p class="text-lg republic-text font-bold">
                    ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ© ğŸ‡©ğŸ‡¿
                </p>
                <div class="mt-4 flex justify-center items-center space-x-4 space-x-reverse">
                    <div class="w-2 h-2 bg-green-400 rounded-full pulse"></div>
                    <span class="text-green-400 text-sm font-bold">Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ Ù…ØªØ·ÙˆØ± 2024 - ÙˆÙÙ‚ Ø£Ø­Ø¯Ø« Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-8 space-x-2 space-x-reverse no-print">
            <button onclick="showTab('setup')" id="setupTab" 
                    class="px-6 py-3 btn-neon rounded-lg mx-1 mb-2 transition-all duration-300">
                âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button onclick="showTab('schedules')" id="schedulesTab" 
                    class="px-6 py-3 bg-gray-700 text-gray-300 rounded-lg mx-1 mb-2 hover:bg-gray-600 transition-all duration-300">
                ğŸ“Š Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©
            </button>
            <button onclick="showTab('analytics')" id="analyticsTab" 
                    class="px-6 py-3 bg-gray-700 text-gray-300 rounded-lg mx-1 mb-2 hover:bg-gray-600 transition-all duration-300">
                ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            </button>
        </div>

        <!-- Setup Tab -->
        <div id="setupContent" class="tab-content">
            <!-- Institution Info -->
            <div class="glass-card rounded-2xl p-8 mb-8 fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
                    ğŸ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label class="block text-lg font-semibold text-gray-300 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</label>
                        <input type="text" id="institutionName" 
                               class="w-full px-4 py-3 text-lg input-neon" 
                               placeholder="Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯...">
                    </div>
                    <div>
                        <label class="block text-lg font-semibold text-gray-300 mb-2">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                        <input type="text" id="academicYear" value="2024-2025"
                               class="w-full px-4 py-3 text-lg input-neon">
                    </div>
                </div>

                <!-- Classes Distribution -->
                <div class="mb-8">
                    <h3 class="text-2xl font-bold text-center mb-6 text-cyan-400">ğŸ“š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="glass-card p-6 rounded-xl">
                            <label class="block text-lg font-semibold text-gray-300 mb-3">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…ØªÙˆØ³Ø·</label>
                            <input type="number" id="level1Classes" min="0" max="10" value="5"
                                   class="w-full px-4 py-3 text-xl text-center input-neon font-bold"
                                   onchange="updateClassTotals()">
                        </div>
                        <div class="glass-card p-6 rounded-xl">
                            <label class="block text-lg font-semibold text-gray-300 mb-3">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù…ØªÙˆØ³Ø·</label>
                            <input type="number" id="level2Classes" min="0" max="10" value="4"
                                   class="w-full px-4 py-3 text-xl text-center input-neon font-bold"
                                   onchange="updateClassTotals()">
                        </div>
                        <div class="glass-card p-6 rounded-xl">
                            <label class="block text-lg font-semibold text-gray-300 mb-3">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ù…ØªÙˆØ³Ø·</label>
                            <input type="number" id="level3Classes" min="0" max="10" value="3"
                                   class="w-full px-4 py-3 text-xl text-center input-neon font-bold"
                                   onchange="updateClassTotals()">
                        </div>
                        <div class="glass-card p-6 rounded-xl">
                            <label class="block text-lg font-semibold text-gray-300 mb-3">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·</label>
                            <input type="number" id="level4Classes" min="0" max="10" value="1"
                                   class="w-full px-4 py-3 text-xl text-center input-neon font-bold"
                                   onchange="updateClassTotals()">
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <div class="inline-block glass-card px-8 py-4 rounded-xl">
                            <span class="text-xl text-gray-300">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: </span>
                            <span id="totalClasses" class="text-3xl font-bold text-cyan-400">13</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="text-center mb-8">
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="loadMyInstitution()" 
                                class="px-8 py-4 btn-success rounded-xl text-lg font-bold transition-all duration-300 pulse">
                            ğŸ« ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ø³Ø³ØªÙŠ
                        </button>
                        <button onclick="resetAllData()" 
                                class="px-8 py-4 btn-danger rounded-xl text-lg font-bold transition-all duration-300">
                            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø´Ø§Ù…Ù„
                        </button>
                    </div>
                </div>
            </div>

            <!-- Teachers Management -->
            <div class="glass-card rounded-2xl p-8 mb-8 fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-green-400 to-blue-500 bg-clip-text text-transparent">
                    ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ (Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ø§Ø¯Ù„)
                </h2>
                
                <!-- Add Teacher Form -->
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                    <div>
                        <input type="text" id="teacherName" 
                               class="w-full px-4 py-3 input-neon" 
                               placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°">
                    </div>
                    <div>
                        <select id="teacherSubject" class="w-full px-4 py-3 input-neon">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
                            <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                            <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</option>
                            <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                            <option value="Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©">Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©</option>
                            <option value="Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©">Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©</option>
                            <option value="Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                            <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©</option>
                            <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                            <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©</option>
                            <option value="Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ</option>
                            <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©</option>
                        </select>
                    </div>
                    <div>
                        <input type="text" id="assignedClasses" 
                               class="w-full px-4 py-3 input-neon" 
                               placeholder="Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù…Ø«Ù„: 1Ù…1,2Ù…1)">
                    </div>
                    <div>
                        <input type="number" id="totalHours" min="1" max="30" 
                               class="w-full px-4 py-3 input-neon" 
                               placeholder="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª">
                    </div>
                    <div>
                        <select id="pedagogicalDay" class="w-full px-4 py-3 input-neon">
                            <option value="">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ</option>
                            <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
                            <option value="Ø§Ù„Ø§Ø«Ù†ÙŠÙ†">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                            <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                            <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                            <option value="Ø§Ù„Ø®Ù…ÙŠØ³">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                        </select>
                    </div>
                    <div>
                        <button onclick="addTeacher()" 
                                class="w-full px-4 py-3 btn-success rounded-lg font-bold transition-all duration-300">
                            â• Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </div>
                </div>

                <!-- Teachers Table -->
                <div class="overflow-x-auto">
                    <table class="w-full schedule-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø£Ø³ØªØ§Ø°</th>
                                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù†Ø¯Ø©</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                                <th>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTableBody">
                            <!-- Teachers will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Alerts Section -->
                <div id="alertsSection" class="mt-8">
                    <!-- Dynamic alerts will be displayed here -->
                </div>
            </div>

            <!-- Generation Controls -->
            <div class="glass-card rounded-2xl p-8 fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">
                    ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø© (Ø­Ù„ÙˆÙ„ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©)
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <button onclick="generateInstitutionSchedule()" 
                            class="px-6 py-4 btn-neon rounded-xl text-lg font-bold transition-all duration-300">
                        ğŸ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„
                    </button>
                    <button onclick="generateStudentSchedules()" 
                            class="px-6 py-4 btn-warning rounded-xl text-lg font-bold transition-all duration-300">
                        ğŸ“š Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°
                    </button>
                    <button onclick="generateTeacherSchedules()" 
                            class="px-6 py-4 btn-success rounded-xl text-lg font-bold transition-all duration-300">
                        ğŸ‘¨â€ğŸ« Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
                    </button>
                    <button onclick="generateAllSchedules()" 
                            class="px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl text-lg font-bold transition-all duration-300 pulse">
                        âš¡ ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                    </button>
                </div>

                <!-- Loading Animation -->
                <div id="loadingSection" class="hidden text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-xl text-gray-300">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©...</p>
                    <p class="text-sm text-gray-400">ØªØ·Ø¨ÙŠÙ‚ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø·ÙˆØ±Ø© ÙˆØ§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© 2024</p>
                </div>
            </div>
        </div>

        <!-- Schedules Tab -->
        <div id="schedulesContent" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-8 fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
                    ğŸ“Š Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© ÙˆØ§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©
                </h2>
                
                <!-- Color Legend -->
                <div class="legend-card mb-8">
                    <h3 class="text-lg font-bold text-white mb-4 text-center">ğŸ¨ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø«Ø©</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="legend-item">
                            <div class="legend-color subject-cell"></div>
                            <span class="text-white">Ø­ØµØµ Ø¹Ø§Ø¯ÙŠØ©</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color guided-work-cell"></div>
                            <span class="text-white">Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© (Ø£ØµÙØ±)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color practical-work-cell"></div>
                            <span class="text-white">Ø£Ø¹Ù…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠØ© (Ø£Ø®Ø¶Ø±)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color remedial-cell"></div>
                            <span class="text-white">Ø­ØµØµ Ø§Ù„Ø§Ø³ØªØ¯Ø±Ø§Ùƒ (Ø£Ø­Ù…Ø±)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color pedagogical-cell"></div>
                            <span class="text-white">Ø£ÙŠØ§Ù… Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠØ©</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color teacher-cell"></div>
                            <span class="text-white">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color empty-cell"></div>
                            <span class="text-white">ÙØ±Ø§ØºØ§Øª (Ù‚Ù„ÙŠÙ„Ø©)</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 25px; height: 25px; background: linear-gradient(to bottom, #ffd700 50%, #28a745 50%); border: 2px solid #333; border-radius: 6px; margin-left: 10px;"></div>
                            <span class="text-white">ØªÙÙˆÙŠØ¬ (Ù1/Ù2)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Schedule Type Selector -->
                <div class="text-center mb-8">
                    <div class="inline-flex rounded-xl overflow-hidden border border-gray-600">
                        <button onclick="showScheduleType('institution')" id="institutionBtn"
                                class="px-6 py-3 btn-neon border-0 rounded-none">
                            ğŸ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„
                        </button>
                        <button onclick="showScheduleType('students')" id="studentsBtn"
                                class="px-6 py-3 bg-gray-700 text-gray-300 border-0 rounded-none hover:bg-gray-600">
                            ğŸ“š Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°
                        </button>
                        <button onclick="showScheduleType('teachers')" id="teachersBtn"
                                class="px-6 py-3 bg-gray-700 text-gray-300 border-0 rounded-none hover:bg-gray-600">
                            ğŸ‘¨â€ğŸ« Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
                        </button>
                    </div>
                </div>

                <!-- Export Controls -->
                <div class="text-center mb-8 no-print">
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="exportToPDF()" 
                                class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all duration-300">
                            ğŸ“„ ØªØµØ¯ÙŠØ± PDF
                        </button>
                        <button onclick="exportToWord()" 
                                class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all duration-300">
                            ğŸ“ ØªØµØ¯ÙŠØ± Word
                        </button>
                        <button onclick="printSchedule()" 
                                class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                </div>

                <!-- Schedule Display Areas -->
                <div id="institutionScheduleDisplay" class="schedule-display">
                    <div class="text-center text-gray-400 py-12">
                        <h3 class="text-2xl mb-4">ğŸ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„</h3>
                        <p>Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø¨Ø¹Ø¯</p>
                        <p class="text-sm">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„" ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    </div>
                </div>

                <div id="studentsScheduleDisplay" class="schedule-display hidden">
                    <div class="text-center mb-6">
                        <select id="classSelector" class="px-4 py-2 input-neon rounded-lg">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                        </select>
                    </div>
                    <div id="studentScheduleContent" class="text-center text-gray-400 py-12">
                        <h3 class="text-2xl mb-4">ğŸ“š Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</h3>
                        <p>Ø§Ø®ØªØ± Ù‚Ø³Ù…Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                </div>

                <div id="teachersScheduleDisplay" class="schedule-display hidden">
                    <div class="text-center mb-6">
                        <select id="teacherSelector" class="px-4 py-2 input-neon rounded-lg">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°</option>
                        </select>
                    </div>
                    <div id="teacherScheduleContent" class="text-center text-gray-400 py-12">
                        <h3 class="text-2xl mb-4">ğŸ‘¨â€ğŸ« Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h3>
                        <p>Ø§Ø®ØªØ± Ø£Ø³ØªØ§Ø°Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ø¹Ù„Ø§Ù‡</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analyticsContent" class="tab-content hidden">
            <div class="glass-card rounded-2xl p-8 fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-green-400 to-purple-500 bg-clip-text text-transparent">
                    ğŸ“ˆ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </h2>
                
                <div id="analyticsDisplay" class="text-center text-gray-400 py-12">
                    <h3 class="text-2xl mb-4">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                    <p>Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯</p>
                    <p class="text-sm">Ù‚Ù… Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let teachers = [];
        let institutionData = {};
        let generatedSchedules = {
            institution: null,
            students: {},
            teachers: {},
            analytics: null
        };
        let currentSeed = Date.now(); // For randomization seed

        // Time Configuration
        const timeSlots = [
            '08:00-09:00',
            '09:00-10:00', 
            '10:00-11:00',
            '11:00-12:00',
            '13:00-14:00',
            '14:00-15:00',
            '15:00-16:00'
        ];

        const morningSlots = ['08:00-09:00', '09:00-10:00', '10:00-11:00', '11:00-12:00'];
        const afternoonSlots = ['13:00-14:00', '14:00-15:00', '15:00-16:00'];
        const remedialSlot = '15:00-16:00';
        const tuesdaySlots = ['08:00-09:00', '09:00-10:00', '10:00-11:00', '11:00-12:00'];

        const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'];

        // CORRECTED Subject Hours per Level (Official Algerian Curriculum)
        const subjectHours = {
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': [6, 5, 5, 5], // 6 Ø­ØµØµ Ø³Ù†Ø© Ø£ÙˆÙ„Ù‰
            'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©': [3, 3, 3, 3], // 3 Ø­ØµØµ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': [2, 2, 2, 2], // 2 Ø­ØµØµ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            'Ø±ÙŠØ§Ø¶ÙŠØ§Øª': [6, 5, 5, 5], // 6 Ø­ØµØµ Ø³Ù†Ø© Ø£ÙˆÙ„Ù‰
            'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©': [2, 2, 2, 2],
            'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©': [2, 2, 2, 2],
            'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§': [2, 2, 2, 2],
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©': [1, 1, 1, 1],
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©': [1, 1, 1, 1], // Ù…ÙˆØ²Ø¹Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
            'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ': [1, 1, 1, 0], // ÙÙ‚Ø· Ù„Ù„Ø³Ù†ÙˆØ§Øª 1-3
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©': [1, 1, 1, 1], // Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª
            'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©': [2, 2, 2, 2]
        };

        // Remedial schedule - ONE per week
        const remedialSchedule = {
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©': 'Ø§Ù„Ø£Ø­Ø¯',
            'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©': 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 
            'Ø±ÙŠØ§Ø¶ÙŠØ§Øª': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡',
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©': 'Ø§Ù„Ø®Ù…ÙŠØ³'
        };

        // Pedagogical Days Configuration
        const pedagogicalDays = {
            'Ø§Ù„Ø£Ø­Ø¯': ['Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§', 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©'],
            'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': ['Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©'],
            'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': ['Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©', 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ'],
            'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': ['Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©', 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©'],
            'Ø§Ù„Ø®Ù…ÙŠØ³': ['Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©']
        };

        // CORRECTED Institution Data with Fair Distribution
        const myInstitutionTeachers = [
            // Ø±ÙŠØ§Ø¶ÙŠØ§Øª - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 3 Ø£Ø³Ø§ØªØ°Ø© = 4-4-5)
            { name: 'Ø¯Ø§Ù„ÙŠ Ù†Ø¬ÙŠØ¨', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', classes: ['1Ù…1', '1Ù…2', '2Ù…1', '2Ù…2'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø®Ù…ÙŠØ³' },
            { name: 'Ø¨Ù† Ø¨Ø§Ø±Ø´ Ù…Ù†ÙŠØ±Ø©', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', classes: ['1Ù…3', '1Ù…4', '2Ù…3', '2Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø®Ù…ÙŠØ³' },
            { name: 'Ø±Ù‚ÙŠÙ‚ Ø±Ù…Ø²ÙŠ', subject: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', classes: ['1Ù…5', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø®Ù…ÙŠØ³' },
            
            // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 5 Ø£Ø³Ø§ØªØ°Ø© = 3-3-3-2-2)
            { name: 'Ù…Ø±ÙˆØ©', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            { name: 'ØµØ¨Ø±ÙŠÙ†Ø©', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', classes: ['1Ù…4', '1Ù…5', '2Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            { name: 'Ø¢Ø³ÙŠØ§', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', classes: ['2Ù…2', '2Ù…3', '2Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            { name: 'Ø²ÙŠÙ†Ø¨', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', classes: ['3Ù…1', '3Ù…2'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            { name: 'Ø³Ø¹ÙŠØ¯Ø©', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', classes: ['3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            
            // ÙØ±Ù†Ø³ÙŠØ© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 3 Ø£Ø³Ø§ØªØ°Ø© = 4-4-5)
            { name: 'Ø§Ù„Ø¹ÙŠØ¯', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            { name: 'Ø³Ø§Ø±Ø©', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', classes: ['1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            { name: 'Ø³Ù„Ù…Ù‰', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', classes: ['2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            
            // Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 3 Ø£Ø³Ø§ØªØ°Ø© = 4-4-5)
            { name: 'Ø¨ÙˆØ¨ÙƒØ±', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            { name: 'Ù‡Ø´Ø§Ù…', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', classes: ['1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            { name: 'Ø£Ù…ÙŠÙ†Ø©', subject: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', classes: ['2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            
            // Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 2 Ø£Ø³Ø§ØªØ°Ø© = 6-7)
            { name: 'ÙˆØ³ÙŠÙ„Ø©', subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
            { name: 'ÙØªÙŠØ­Ø©', subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©', classes: ['1Ù…4', '1Ù…5', '2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
            
            // ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§ - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 3 Ø£Ø³Ø§ØªØ°Ø© = 4-4-5)
            { name: 'ÙˆØ¯Ø§Ø¯', subject: 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø­Ø¯' },
            { name: 'Ø¹Ø§Ø¦Ø´Ø©', subject: 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§', classes: ['1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø­Ø¯' },
            { name: 'ÙØ§Ø·Ù…Ø©', subject: 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§', classes: ['2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø­Ø¯' },
            
            // Ø¹Ù„ÙˆÙ… ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 3 Ø£Ø³Ø§ØªØ°Ø© = 4-4-5)
            { name: 'Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø²Ø§Ù‚', subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
            { name: 'Ø¨Ù„ÙˆØ·Ø§Ø±', subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©', classes: ['1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
            { name: 'Ø´ÙŠÙ…Ø§Ø¡', subject: 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©', classes: ['2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' },
            
            // Ø±ÙŠØ§Ø¶Ø© - ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„ (13 Ù‚Ø³Ù… Ã· 2 Ø£Ø³Ø§ØªØ°Ø© = 6-7)
            { name: 'Ø¹Ù„Ø§Ø¡', subject: 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '2Ù…1', '2Ù…2', '2Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            { name: 'Ø®ÙŠØ± Ø§Ù„Ø¯ÙŠÙ†', subject: 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©', classes: ['1Ù…4', '1Ù…5', '2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            
            // ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ© - Ø¹Ø§Ù…Ø±
            { name: 'Ø¹Ø§Ù…Ø±', subject: 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4', '1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3', '2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' },
            
            // Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ - 12 Ù‚Ø³Ù… (Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©)
            { name: 'Ø´Ù‡Ø±Ø©', subject: 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4', '1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3', '2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
            
            // Ø±Ø³Ù…
            { name: 'Ø³ÙŠÙ', subject: 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©', classes: ['1Ù…1', '1Ù…2', '1Ù…3', '1Ù…4', '1Ù…5', '2Ù…1', '2Ù…2', '2Ù…3', '2Ù…4', '3Ù…1', '3Ù…2', '3Ù…3', '4Ù…1'], hours: 0, pedagogicalDay: 'Ø§Ù„Ø®Ù…ÙŠØ³' }
        ];

        // Calculate hours for teachers based on their classes
        function calculateTeacherHours() {
            myInstitutionTeachers.forEach(teacher => {
                let totalHours = 0;
                teacher.classes.forEach(className => {
                    const level = parseInt(className.charAt(0)) - 1;
                    let subjectHoursForLevel = subjectHours[teacher.subject][level];
                    
                    // Handle civic education for history teachers
                    if (teacher.subject === 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§') {
                        subjectHoursForLevel += subjectHours['Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©'][level];
                    }
                    
                    totalHours += subjectHoursForLevel;
                });
                teacher.hours = totalHours;
            });
        }

        // Calculate hours on initialization
        calculateTeacherHours();

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            showTab('setup');
            updateClassTotals();
        });

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.className = tab.className.replace('btn-neon', 'bg-gray-700 text-gray-300').replace('transition-all duration-300', 'hover:bg-gray-600 transition-all duration-300');
            });

            document.getElementById(tabName + 'Content').classList.remove('hidden');
            
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.className = activeTab.className.replace('bg-gray-700 text-gray-300 hover:bg-gray-600', 'btn-neon');
        }

        function updateClassTotals() {
            const level1 = parseInt(document.getElementById('level1Classes').value) || 0;
            const level2 = parseInt(document.getElementById('level2Classes').value) || 0;
            const level3 = parseInt(document.getElementById('level3Classes').value) || 0;
            const level4 = parseInt(document.getElementById('level4Classes').value) || 0;
            
            const total = level1 + level2 + level3 + level4;
            document.getElementById('totalClasses').textContent = total;
            
            updateTeacherAlerts();
        }

        // Teacher management functions
        function addTeacher() {
            const name = document.getElementById('teacherName').value.trim();
            const subject = document.getElementById('teacherSubject').value;
            const classes = document.getElementById('assignedClasses').value.trim();
            const hours = parseInt(document.getElementById('totalHours').value);
            const pedagogicalDay = document.getElementById('pedagogicalDay').value;

            if (!name || !subject || !classes || !hours) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }

            const teacher = {
                id: Date.now(),
                name,
                subject,
                classes: classes.split(',').map(c => c.trim()),
                hours,
                pedagogicalDay
            };

            teachers.push(teacher);
            updateTeachersTable();
            clearTeacherForm();
            updateTeacherAlerts();
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function updateTeachersTable() {
            const tbody = document.getElementById('teachersTableBody');
            tbody.innerHTML = '';

            teachers.forEach(teacher => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="teacher-cell">${teacher.name}</td>
                    <td class="subject-cell">${teacher.subject}</td>
                    <td class="text-xs">${teacher.classes.join(', ')}</td>
                    <td class="font-bold">${teacher.hours}</td>
                    <td class="pedagogical-cell">${teacher.pedagogicalDay || '-'}</td>
                    <td>
                        <button onclick="editTeacher(${teacher.id})" 
                                class="px-2 py-1 bg-blue-500 text-white rounded mr-1 text-xs">
                            âœï¸
                        </button>
                        <button onclick="deleteTeacher(${teacher.id})" 
                                class="px-2 py-1 bg-red-500 text-white rounded text-xs">
                            ğŸ—‘ï¸
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editTeacher(teacherId) {
            const teacher = teachers.find(t => t.id === teacherId);
            if (!teacher) return;

            document.getElementById('teacherName').value = teacher.name;
            document.getElementById('teacherSubject').value = teacher.subject;
            document.getElementById('assignedClasses').value = teacher.classes.join(', ');
            document.getElementById('totalHours').value = teacher.hours;
            document.getElementById('pedagogicalDay').value = teacher.pedagogicalDay || '';

            teachers = teachers.filter(t => t.id !== teacherId);
            updateTeachersTable();
            updateTeacherAlerts();
        }

        function deleteTeacher(teacherId) {
            showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ', () => {
                teachers = teachers.filter(t => t.id !== teacherId);
                updateTeachersTable();
                updateTeacherAlerts();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°', 'success');
            });
        }

        function clearTeacherForm() {
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubject').value = '';
            document.getElementById('assignedClasses').value = '';
            document.getElementById('totalHours').value = '';
            document.getElementById('pedagogicalDay').value = '';
        }

        function loadMyInstitution() {
            try {
                document.getElementById('institutionName').value = 'Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ø§Ù„Ø·Ø§Ù‡Ø± Ø¯Ø±ÙŠØ³ÙŠ';
                
                teachers = [];
                calculateTeacherHours(); // Recalculate hours
                
                teachers = [...myInstitutionTeachers.map(t => ({
                    ...t,
                    id: Date.now() + Math.random()
                }))];
                
                updateTeachersTable();
                updateTeacherAlerts();
                showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ø³Ø³ØªÙŠ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');
            } catch (error) {
                console.error('Error loading institution:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }

        function resetAllData() {
            showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ', () => {
                teachers = [];
                generatedSchedules = { institution: null, students: {}, teachers: {}, analytics: null };
                
                document.getElementById('institutionName').value = '';
                document.getElementById('academicYear').value = '2024-2025';
                document.getElementById('level1Classes').value = '5';
                document.getElementById('level2Classes').value = '4';
                document.getElementById('level3Classes').value = '3';
                document.getElementById('level4Classes').value = '1';
                updateClassTotals();
                
                clearTeacherForm();
                updateTeachersTable();
                updateTeacherAlerts();
                
                showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            });
        }

        // FAIR DISTRIBUTION AND ALERTS
        function updateTeacherAlerts() {
            const alertsSection = document.getElementById('alertsSection');
            alertsSection.innerHTML = '';
            
            const alerts = [];
            
            // Check for overloaded teachers (>20 hours)
            const overloadedTeachers = teachers.filter(t => t.hours > 20);
            if (overloadedTeachers.length > 0) {
                alerts.push({
                    type: 'error',
                    title: 'âš ï¸ Ø£Ø³Ø§ØªØ°Ø© Ù…Ø­Ù…Ù„ÙˆÙ† Ø¨Ø³Ø§Ø¹Ø§Øª Ø²Ø§Ø¦Ø¯Ø©',
                    content: overloadedTeachers.map(t => 
                        `Ø§Ù„Ø£Ø³ØªØ§Ø° ${t.name} (${t.subject}): ${t.hours} Ø³Ø§Ø¹Ø© - ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø° Ø¢Ø®Ø± ÙÙŠ ${t.subject}`
                    ).join('\n')
                });
            }
            
            // Check for underloaded teachers (<10 hours)
            const underloadedTeachers = teachers.filter(t => t.hours < 10);
            if (underloadedTeachers.length > 0) {
                alerts.push({
                    type: 'warning',
                    title: 'ğŸ“ Ø£Ø³Ø§ØªØ°Ø© Ø¨Ø­Ø§Ø¬Ø© Ù„ØªÙƒÙ…Ù„Ø© Ø§Ù„Ù†ØµØ§Ø¨',
                    content: underloadedTeachers.map(t => 
                        `Ø§Ù„Ø£Ø³ØªØ§Ø° ${t.name} (${t.subject}): ${t.hours} Ø³Ø§Ø¹Ø© - ÙŠØ­ØªØ§Ø¬ ØªÙƒÙ…Ù„Ø© Ù†ØµØ§Ø¨`
                    ).join('\n')
                });
            }
            
            // Check for fair distribution within same subject
            const subjectGroups = {};
            teachers.forEach(t => {
                if (!subjectGroups[t.subject]) {
                    subjectGroups[t.subject] = [];
                }
                subjectGroups[t.subject].push(t);
            });
            
            Object.entries(subjectGroups).forEach(([subject, subjectTeachers]) => {
                if (subjectTeachers.length > 1) {
                    const classCounts = subjectTeachers.map(t => t.classes.length);
                    const maxClasses = Math.max(...classCounts);
                    const minClasses = Math.min(...classCounts);
                    
                    if (maxClasses - minClasses > 1) {
                        alerts.push({
                            type: 'info',
                            title: `ğŸ“Š ØªÙˆØ²ÙŠØ¹ ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù† ÙÙŠ Ù…Ø§Ø¯Ø© ${subject}`,
                            content: subjectTeachers.map(t => 
                                `${t.name}: ${t.classes.length} Ø£Ù‚Ø³Ø§Ù…`
                            ).join(' | ') + '\nÙŠÙÙ†ØµØ­ Ø¨ØªÙˆØ²ÙŠØ¹ Ø£ÙƒØ«Ø± Ø¹Ø¯Ø§Ù„Ø© (ÙØ±Ù‚ Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ Ù…Ù‚Ø¨ÙˆÙ„)'
                        });
                    }
                }
            });
            
            // Display alerts
            alerts.forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = alert.type === 'error' ? 'alert-card' : 
                                   alert.type === 'warning' ? 'alert-card' : 'success-card';
                alertDiv.innerHTML = `
                    <h4 class="font-bold mb-2">${alert.title}</h4>
                    <pre class="text-sm whitespace-pre-wrap">${alert.content}</pre>
                `;
                alertsSection.appendChild(alertDiv);
            });
            
            if (alerts.length === 0) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success-card';
                successDiv.innerHTML = `
                    <h4 class="font-bold mb-2">âœ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù…Ù†Ø§Ø³Ø¨</h4>
                    <p class="text-sm">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© Ø¶Ù…Ù† Ø§Ù„Ù†ØµØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹ Ø¹Ø§Ø¯Ù„</p>
                `;
                alertsSection.appendChild(successDiv);
            }
        }

        // ENHANCED SCHEDULING ALGORITHM
        function generateAllSchedules() {
            showLoading();
            // Change seed for different results each time
            currentSeed = Date.now() + Math.random() * 1000;
            
            setTimeout(() => {
                try {
                    const allClasses = generateClassList();
                    const masterSchedule = createComprehensiveMasterSchedule(allClasses);
                    
                    generatedSchedules.institution = masterSchedule.institution;
                    generatedSchedules.students = masterSchedule.students;
                    generatedSchedules.teachers = masterSchedule.teachers;
                    generatedSchedules.analytics = createAdvancedAnalytics();
                    
                    updateClassSelector();
                    updateTeacherSelector();
                    
                    hideLoading();
                    showNotification(`ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! (Ø­Ù„ Ø±Ù‚Ù… ${Math.floor(currentSeed % 1000)}) âš¡`, 'success');
                    showTab('schedules');
                } catch (error) {
                    hideLoading();
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„', 'error');
                    console.error(error);
                }
            }, 3000);
        }

        function createComprehensiveMasterSchedule(allClasses) {
            // Seeded randomization for consistent but different results
            function seededRandom() {
                currentSeed = (currentSeed * 9301 + 49297) % 233280;
                return currentSeed / 233280;
            }

            const masterSchedule = {
                institution: {},
                students: {},
                teachers: {}
            };

            // Initialize all schedules
            allClasses.forEach(className => {
                masterSchedule.students[className] = initializeEmptySchedule();
            });

            teachers.forEach(teacher => {
                masterSchedule.teachers[teacher.name] = initializeEmptySchedule();
                applyPedagogicalDays(masterSchedule.teachers[teacher.name], teacher);
            });

            // Randomize order for different results each time
            const shuffledClasses = [...allClasses].sort(() => seededRandom() - 0.5);
            const shuffledTeachers = [...teachers].sort(() => seededRandom() - 0.5);

            // Step 1: Schedule all regular subjects with exact hour compliance
            shuffledClasses.forEach(className => {
                scheduleRegularSubjectsExactly(className, masterSchedule, seededRandom);
            });

            // Step 2: Schedule guided work for ALL classes (mandatory)
            shuffledClasses.forEach(className => {
                scheduleGuidedWorkMandatory(className, masterSchedule, seededRandom);
            });

            // Step 3: Schedule practical work for ALL classes
            shuffledClasses.forEach(className => {
                schedulePracticalWorkMandatory(className, masterSchedule, seededRandom);
            });

            // Step 4: Schedule remedial sessions (ONE per teacher per week)
            scheduleWeeklyRemedialSessions(masterSchedule);

            // Step 5: Optimize teacher schedules (minimal gaps)
            optimizeTeacherSchedulesMinimal(masterSchedule);

            // Step 6: Create comprehensive institution map
            masterSchedule.institution = createInstitutionMap(masterSchedule);

            return masterSchedule;
        }

        function initializeEmptySchedule() {
            const schedule = {};
            days.forEach(day => {
                schedule[day] = {};
                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                daySlots.forEach(slot => {
                    schedule[day][slot] = {
                        subject: '',
                        teacher: '',
                        type: 'empty',
                        content: ''
                    };
                });
            });
            return schedule;
        }

        function applyPedagogicalDays(schedule, teacher) {
            const freeDaySubjects = pedagogicalDays[teacher.pedagogicalDay] || [];
            
            if (freeDaySubjects.includes(teacher.subject)) {
                const daySlots = teacher.pedagogicalDay === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                daySlots.forEach(slot => {
                    if (slot !== remedialSlot) {
                        schedule[teacher.pedagogicalDay][slot] = {
                            subject: 'ÙŠÙˆÙ… Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ',
                            teacher: '',
                            type: 'pedagogical',
                            content: 'ÙØ±Ø§Øº - ÙŠÙˆÙ… Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ'
                        };
                    }
                });
            }
        }

        function scheduleRegularSubjectsExactly(className, masterSchedule, randomFunc) {
            const level = parseInt(className.charAt(0)) - 1;
            const studentSchedule = masterSchedule.students[className];
            
            // Schedule each subject with EXACT hours
            Object.keys(subjectHours).forEach(subject => {
                let hoursNeeded = subjectHours[subject][level];
                
                if (hoursNeeded > 0) {
                    let availableTeachers = teachers.filter(t => 
                        t.subject === subject && t.classes.includes(className)
                    );
                    
                    // Handle civic education - assign to history teachers
                    if (subject === 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©') {
                        availableTeachers = teachers.filter(t => 
                            t.subject === 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§' && t.classes.includes(className)
                        );
                    }
                    
                    if (availableTeachers.length > 0) {
                        const teacher = availableTeachers[0];
                        scheduleExactHours(studentSchedule, masterSchedule.teachers[teacher.name], 
                                         subject, teacher.name, hoursNeeded, className, randomFunc);
                    }
                }
            });
        }

        function scheduleExactHours(studentSchedule, teacherSchedule, subject, teacherName, hoursNeeded, className, randomFunc) {
            let scheduledHours = 0;
            const subjectDailyCount = {};
            
            // Collect all available slots
            const availableSlots = [];
            days.forEach(day => {
                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots.filter(slot => slot !== remedialSlot);
                daySlots.forEach(slot => {
                    availableSlots.push({ day, slot });
                });
            });
            
            // Shuffle slots for randomization
            availableSlots.sort(() => randomFunc() - 0.5);

            for (const { day, slot } of availableSlots) {
                if (scheduledHours >= hoursNeeded) break;

                // Check availability and constraints
                if (studentSchedule[day][slot].type === 'empty' && 
                    teacherSchedule[day][slot].type === 'empty') {
                    
                    // Check daily limit (max 2 times per day)
                    const dailyKey = `${day}_${subject}`;
                    if ((subjectDailyCount[dailyKey] || 0) < 2) {
                        
                        // Check for non-consecutive constraint
                        if (!wouldCreateConsecutive(studentSchedule, subject, day, slot)) {
                            
                            // Schedule the lesson
                            studentSchedule[day][slot] = {
                                subject: subject,
                                teacher: teacherName,
                                type: 'regular',
                                content: `${subject}\n${teacherName}`
                            };

                            teacherSchedule[day][slot] = {
                                subject: subject,
                                teacher: className,
                                type: 'teaching',
                                content: `${subject} - ${className}`
                            };

                            scheduledHours++;
                            subjectDailyCount[dailyKey] = (subjectDailyCount[dailyKey] || 0) + 1;
                        }
                    }
                }
            }
        }

        function wouldCreateConsecutive(schedule, subject, day, slot) {
            const slotIndex = timeSlots.indexOf(slot);
            
            // Check previous slot
            if (slotIndex > 0) {
                const prevSlot = timeSlots[slotIndex - 1];
                if (schedule[day][prevSlot] && schedule[day][prevSlot].subject === subject) {
                    return true;
                }
            }

            // Check next slot  
            if (slotIndex < timeSlots.length - 1) {
                const nextSlot = timeSlots[slotIndex + 1];
                if (schedule[day][nextSlot] && schedule[day][nextSlot].subject === subject) {
                    return true;
                }
            }

            return false;
        }

        // MANDATORY GUIDED WORK FOR ALL CLASSES
        function scheduleGuidedWorkMandatory(className, masterSchedule, randomFunc) {
            const level = parseInt(className.charAt(0)) - 1;
            const studentSchedule = masterSchedule.students[className];
            
            // Schedule Arabic-Math guided work for levels 1-3
            if (level < 3) {
                scheduleGuidedWorkPair(className, 'Ø¹Ø±Ø¨ÙŠØ©_Ø±ÙŠØ§Ø¶ÙŠØ§Øª', studentSchedule, masterSchedule, randomFunc);
            } else {
                // Level 4: separate Arabic and Math guided work sessions
                scheduleLevel4GuidedWork(className, studentSchedule, masterSchedule, randomFunc);
            }
            
            // Schedule French-English guided work for ALL levels
            scheduleGuidedWorkPair(className, 'ÙØ±Ù†Ø³ÙŠØ©_Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', studentSchedule, masterSchedule, randomFunc);
        }

        function scheduleGuidedWorkPair(className, pairKey, studentSchedule, masterSchedule, randomFunc) {
            const subjects = pairKey === 'Ø¹Ø±Ø¨ÙŠØ©_Ø±ÙŠØ§Ø¶ÙŠØ§Øª' ? 
                ['Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª'] : 
                ['Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©', 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'];
                
            const teacher1 = teachers.find(t => t.subject === subjects[0] && t.classes.includes(className));
            const teacher2 = teachers.find(t => t.subject === subjects[1] && t.classes.includes(className));

            if (!teacher1 || !teacher2) return;

            // Find available slot - try multiple times for different randomization
            const availableSlots = [];
            days.forEach(day => {
                if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡') return; // Skip Tuesday
                
                const daySlots = timeSlots.filter(slot => slot !== remedialSlot);
                daySlots.forEach(slot => {
                    availableSlots.push({ day, slot });
                });
            });
            
            availableSlots.sort(() => randomFunc() - 0.5);

            for (const { day, slot } of availableSlots) {
                if (studentSchedule[day][slot].type !== 'empty') continue;
                if (masterSchedule.teachers[teacher1.name][day][slot].type === 'pedagogical') continue;
                if (masterSchedule.teachers[teacher2.name][day][slot].type === 'pedagogical') continue;
                
                // Check if either teacher is available
                if (masterSchedule.teachers[teacher1.name][day][slot].type === 'empty' && 
                    masterSchedule.teachers[teacher2.name][day][slot].type === 'empty') {

                    // Schedule guided work
                    studentSchedule[day][slot] = {
                        subject: `Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø©`,
                        teacher: `${teacher1.name} / ${teacher2.name}`,
                        type: 'guided-work',
                        content: '',
                        split: {
                            top: `Ù1 ${subjects[0]}`,
                            bottom: `Ù2 ${subjects[1]}`
                        }
                    };

                    masterSchedule.teachers[teacher1.name][day][slot] = {
                        subject: `Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© ${subjects[0]}`,
                        teacher: className,
                        type: 'guided-work',
                        content: `Ø£.Ù… ${subjects[0]} - ${className} (Ù1)`
                    };

                    masterSchedule.teachers[teacher2.name][day][slot] = {
                        subject: `Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© ${subjects[1]}`,
                        teacher: className,
                        type: 'guided-work',
                        content: `Ø£.Ù… ${subjects[1]} - ${className} (Ù2)`
                    };

                    return; // Successfully scheduled
                }
            }
        }

        function scheduleLevel4GuidedWork(className, studentSchedule, masterSchedule, randomFunc) {
            const arabicTeacher = teachers.find(t => t.subject === 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' && t.classes.includes(className));
            const mathTeacher = teachers.find(t => t.subject === 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª' && t.classes.includes(className));

            if (!arabicTeacher || !mathTeacher) return;

            // Find two consecutive available slots
            const availableSlotPairs = [];
            days.forEach(day => {
                if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡') return;
                
                const daySlots = timeSlots.filter(slot => slot !== remedialSlot);
                for (let i = 0; i < daySlots.length - 1; i++) {
                    availableSlotPairs.push({
                        day,
                        slot1: daySlots[i],
                        slot2: daySlots[i + 1]
                    });
                }
            });
            
            availableSlotPairs.sort(() => randomFunc() - 0.5);

            for (const { day, slot1, slot2 } of availableSlotPairs) {
                if (studentSchedule[day][slot1].type === 'empty' && 
                    studentSchedule[day][slot2].type === 'empty' &&
                    masterSchedule.teachers[arabicTeacher.name][day][slot1].type === 'empty' &&
                    masterSchedule.teachers[mathTeacher.name][day][slot2].type === 'empty') {

                    // Schedule Arabic guided work (Ù1)
                    studentSchedule[day][slot1] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© (Ù1 Ø¹Ø±Ø¨ÙŠØ©)',
                        teacher: arabicTeacher.name,
                        type: 'guided-work',
                        content: `Ø£.Ù… Ø¹Ø±Ø¨ÙŠØ© - Ù1\n${arabicTeacher.name}`
                    };

                    masterSchedule.teachers[arabicTeacher.name][day][slot1] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©',
                        teacher: className,
                        type: 'guided-work',
                        content: `Ø£.Ù… Ø¹Ø±Ø¨ÙŠØ© - ${className} (Ù1)`
                    };

                    // Schedule Math guided work (Ù2)
                    studentSchedule[day][slot2] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© (Ù2 Ø±ÙŠØ§Ø¶ÙŠØ§Øª)',
                        teacher: mathTeacher.name,
                        type: 'guided-work',
                        content: `Ø£.Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª - Ù2\n${mathTeacher.name}`
                    };

                    masterSchedule.teachers[mathTeacher.name][day][slot2] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø© Ø±ÙŠØ§Ø¶ÙŠØ§Øª',
                        teacher: className,
                        type: 'guided-work',
                        content: `Ø£.Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª - ${className} (Ù2)`
                    };

                    return; // Successfully scheduled
                }
            }
        }

        function schedulePracticalWorkMandatory(className, masterSchedule, randomFunc) {
            const studentSchedule = masterSchedule.students[className];
            
            const scienceTeacher = teachers.find(t => t.subject === 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©' && t.classes.includes(className));
            const physicsTeacher = teachers.find(t => t.subject === 'Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©' && t.classes.includes(className));

            if (!scienceTeacher || !physicsTeacher) return;

            // Find available slot
            const availableSlots = [];
            days.forEach(day => {
                if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡') return;
                
                const daySlots = timeSlots.filter(slot => slot !== remedialSlot);
                daySlots.forEach(slot => {
                    availableSlots.push({ day, slot });
                });
            });
            
            availableSlots.sort(() => randomFunc() - 0.5);

            for (const { day, slot } of availableSlots) {
                if (studentSchedule[day][slot].type === 'empty' &&
                    masterSchedule.teachers[scienceTeacher.name][day][slot].type === 'empty' &&
                    masterSchedule.teachers[physicsTeacher.name][day][slot].type === 'empty') {

                    // Schedule practical work
                    studentSchedule[day][slot] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠØ©',
                        teacher: `${scienceTeacher.name} / ${physicsTeacher.name}`,
                        type: 'practical-work',
                        content: '',
                        split: {
                            top: 'Ù1 Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©',
                            bottom: 'Ù2 Ø¹Ù„ÙˆÙ… ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©'
                        }
                    };

                    masterSchedule.teachers[scienceTeacher.name][day][slot] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠØ© Ø¹Ù„ÙˆÙ…',
                        teacher: className,
                        type: 'practical-work',
                        content: `Ø£.Øª Ø¹Ù„ÙˆÙ… - ${className} (Ù1)`
                    };

                    masterSchedule.teachers[physicsTeacher.name][day][slot] = {
                        subject: 'Ø£Ø¹Ù…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠØ© ÙÙŠØ²ÙŠØ§Ø¡',
                        teacher: className,
                        type: 'practical-work',
                        content: `Ø£.Øª ÙÙŠØ²ÙŠØ§Ø¡ - ${className} (Ù2)`
                    };

                    return; // Successfully scheduled
                }
            }
        }

        function scheduleWeeklyRemedialSessions(masterSchedule) {
            Object.entries(remedialSchedule).forEach(([subject, day]) => {
                const subjectTeachers = teachers.filter(t => t.subject === subject);
                
                subjectTeachers.forEach(teacher => {
                    if (masterSchedule.teachers[teacher.name][day] && 
                        masterSchedule.teachers[teacher.name][day][remedialSlot] &&
                        masterSchedule.teachers[teacher.name][day][remedialSlot].type === 'empty') {
                        
                        // Schedule ONE remedial session per week for this teacher
                        masterSchedule.teachers[teacher.name][day][remedialSlot] = {
                            subject: `Ø§Ø³ØªØ¯Ø±Ø§Ùƒ ${subject}`,
                            teacher: `Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø³Ù†Ø¯Ø©`,
                            type: 'remedial',
                            content: `Ø§Ø³ØªØ¯Ø±Ø§Ùƒ ${subject} - ${teacher.classes.join(', ')}`
                        };

                        // Add to student schedules of this teacher's classes
                        teacher.classes.forEach(className => {
                            if (masterSchedule.students[className] && 
                                masterSchedule.students[className][day] &&
                                masterSchedule.students[className][day][remedialSlot] &&
                                masterSchedule.students[className][day][remedialSlot].type === 'empty') {
                                
                                masterSchedule.students[className][day][remedialSlot] = {
                                    subject: `Ø§Ø³ØªØ¯Ø±Ø§Ùƒ ${subject}`,
                                    teacher: teacher.name,
                                    type: 'remedial',
                                    content: `Ø§Ø³ØªØ¯Ø±Ø§Ùƒ ${subject}\n${teacher.name}\n(Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ø¶Ø¹ÙØ§Ø¡)`
                                };
                            }
                        });
                    }
                });
            });
        }

        function optimizeTeacherSchedulesMinimal(masterSchedule) {
            teachers.forEach(teacher => {
                minimizeTeacherGaps(masterSchedule.teachers[teacher.name], teacher);
            });
        }

        function minimizeTeacherGaps(teacherSchedule, teacher) {
            days.forEach(day => {
                if (day === teacher.pedagogicalDay) return;

                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                const activities = [];
                
                // Collect all activities
                daySlots.forEach(slot => {
                    const activity = teacherSchedule[day][slot];
                    if (['teaching', 'guided-work', 'practical-work', 'remedial'].includes(activity.type)) {
                        activities.push({
                            slot: slot,
                            data: activity
                        });
                        // Clear temporarily
                        teacherSchedule[day][slot] = {
                            subject: '',
                            teacher: '',
                            type: 'empty',
                            content: ''
                        };
                    }
                });

                // Redistribute to minimize gaps (max 2 gaps, non-consecutive)
                if (activities.length > 0) {
                    redistributeWithMinimalGaps(teacherSchedule, day, daySlots, activities);
                }
            });
        }

        function redistributeWithMinimalGaps(schedule, day, daySlots, activities) {
            if (activities.length === 0) return;

            // Strategy: Group activities with minimal gaps
            if (activities.length <= 3) {
                // Small number: try to group them
                let startIndex = 0;
                activities.forEach((activity, i) => {
                    if (startIndex + i < daySlots.length) {
                        schedule[day][daySlots[startIndex + i]] = activity.data;
                    }
                });
            } else if (activities.length >= 5) {
                // Large number: allow one gap in middle
                const firstHalf = Math.ceil(activities.length / 2);
                
                // Place first half
                for (let i = 0; i < firstHalf; i++) {
                    if (i < daySlots.length) {
                        schedule[day][daySlots[i]] = activities[i].data;
                    }
                }
                
                // Place second half with one gap
                const secondHalfStart = firstHalf + 1;
                for (let i = firstHalf; i < activities.length; i++) {
                    const slotIndex = secondHalfStart + (i - firstHalf);
                    if (slotIndex < daySlots.length) {
                        schedule[day][daySlots[slotIndex]] = activities[i].data;
                    }
                }
            } else {
                // Medium number: compact placement
                activities.forEach((activity, i) => {
                    if (i < daySlots.length) {
                        schedule[day][daySlots[i]] = activity.data;
                    }
                });
            }
        }

        function createInstitutionMap(masterSchedule) {
            const institutionMap = {};
            
            days.forEach(day => {
                institutionMap[day] = {};
                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                
                daySlots.forEach(slot => {
                    institutionMap[day][slot] = {
                        activities: [],
                        totalActivities: 0,
                        subjects: new Set(),
                        teachers: new Set(),
                        classes: new Set()
                    };

                    // Collect all activities for this time slot from all classes
                    Object.keys(masterSchedule.students).forEach(className => {
                        const studentActivity = masterSchedule.students[className][day] && 
                                              masterSchedule.students[className][day][slot];
                        if (studentActivity && studentActivity.type !== 'empty') {
                            institutionMap[day][slot].activities.push({
                                className: className,
                                subject: studentActivity.subject,
                                teacher: studentActivity.teacher,
                                type: studentActivity.type
                            });
                            
                            institutionMap[day][slot].subjects.add(studentActivity.subject);
                            institutionMap[day][slot].teachers.add(studentActivity.teacher.split(' / ')[0]); // Handle split teachers
                            institutionMap[day][slot].classes.add(className);
                        }
                    });

                    institutionMap[day][slot].totalActivities = institutionMap[day][slot].activities.length;
                    
                    // Convert sets to arrays for display
                    institutionMap[day][slot].subjectsArray = Array.from(institutionMap[day][slot].subjects);
                    institutionMap[day][slot].teachersArray = Array.from(institutionMap[day][slot].teachers);
                    institutionMap[day][slot].classesArray = Array.from(institutionMap[day][slot].classes);
                });
            });

            return institutionMap;
        }

        function generateClassList() {
            const classes = [];
            const levels = [
                parseInt(document.getElementById('level1Classes').value) || 0,
                parseInt(document.getElementById('level2Classes').value) || 0,
                parseInt(document.getElementById('level3Classes').value) || 0,
                parseInt(document.getElementById('level4Classes').value) || 0
            ];

            levels.forEach((count, level) => {
                for (let i = 1; i <= count; i++) {
                    classes.push(`${level + 1}Ù…${i}`);
                }
            });

            return classes;
        }

        // Individual generation functions (redirect to main function for consistency)
        function generateInstitutionSchedule() {
            generateAllSchedules();
        }

        function generateStudentSchedules() {
            generateAllSchedules();
        }

        function generateTeacherSchedules() {
            generateAllSchedules();
        }

        // ADVANCED ANALYTICS
        function createAdvancedAnalytics() {
            const analytics = {
                totalTeachers: teachers.length,
                totalClasses: generateClassList().length,
                subjectDistribution: {},
                teacherWorkload: {},
                gapAnalysis: {},
                guidedWorkSessions: 0,
                practicalWorkSessions: 0,
                remedialSessions: Object.keys(remedialSchedule).length,
                hourCompliance: {}
            };

            // Calculate analytics
            teachers.forEach(teacher => {
                if (!analytics.subjectDistribution[teacher.subject]) {
                    analytics.subjectDistribution[teacher.subject] = 0;
                }
                analytics.subjectDistribution[teacher.subject]++;

                const workload = calculateTeacherWorkload(teacher);
                analytics.teacherWorkload[teacher.name] = workload;
                analytics.gapAnalysis[teacher.name] = analyzeTeacherGaps(teacher);
            });

            // Check hour compliance
            generateClassList().forEach(className => {
                const level = parseInt(className.charAt(0)) - 1;
                analytics.hourCompliance[className] = {};
                
                Object.keys(subjectHours).forEach(subject => {
                    const expectedHours = subjectHours[subject][level];
                    const actualHours = countActualHours(className, subject);
                    analytics.hourCompliance[className][subject] = {
                        expected: expectedHours,
                        actual: actualHours,
                        compliant: expectedHours === actualHours
                    };
                });
            });

            return analytics;
        }

        function countActualHours(className, subject) {
            if (!generatedSchedules.students[className]) return 0;
            
            const schedule = generatedSchedules.students[className];
            let count = 0;
            
            days.forEach(day => {
                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                daySlots.forEach(slot => {
                    if (schedule[day] && schedule[day][slot] && 
                        (schedule[day][slot].subject === subject || 
                         (subject === 'Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…Ø¯Ù†ÙŠØ©' && schedule[day][slot].subject === 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§'))) {
                        count++;
                    }
                });
            });
            
            return count;
        }

        function calculateTeacherWorkload(teacher) {
            if (!generatedSchedules.teachers[teacher.name]) return { total: 0, distribution: {} };

            const schedule = generatedSchedules.teachers[teacher.name];
            let totalHours = 0;
            const distribution = {};

            days.forEach(day => {
                distribution[day] = 0;
                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                
                daySlots.forEach(slot => {
                    if (schedule[day] && schedule[day][slot] && 
                        ['teaching', 'guided-work', 'practical-work', 'remedial'].includes(schedule[day][slot].type)) {
                        totalHours++;
                        distribution[day]++;
                    }
                });
            });

            return {
                total: totalHours,
                distribution: distribution,
                efficiency: totalHours <= 20 ? 'Ù…Ù†Ø§Ø³Ø¨' : 'Ù…ÙƒØ«Ù',
                percentage: Math.round((totalHours / 20) * 100)
            };
        }

        function analyzeTeacherGaps(teacher) {
            if (!generatedSchedules.teachers[teacher.name]) return { totalGaps: 0, maxConsecutiveGaps: 0 };

            const schedule = generatedSchedules.teachers[teacher.name];
            let totalGaps = 0;
            let maxConsecutiveGaps = 0;

            days.forEach(day => {
                if (day === teacher.pedagogicalDay) return;

                const daySlots = day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' ? tuesdaySlots : timeSlots;
                let consecutiveGaps = 0;
                let hasClassBefore = false;

                daySlots.forEach((slot, index) => {
                    const isClassSlot = schedule[day] && schedule[day][slot] && 
                        ['teaching', 'guided-work', 'practical-work', 'remedial'].includes(schedule[day][slot].type);

                    if (isClassSlot) {
                        if (consecutiveGaps > 0 && hasClassBefore) {
                            totalGaps += consecutiveGaps;
                            maxConsecutiveGaps = Math.max(maxConsecutiveGaps, consecutiveGaps);
                        }
                        consecutiveGaps = 0;
                        hasClassBefore = true;
                    } else if (hasClassBefore && index < daySlots.length - 1) {
                        consecutiveGaps++;
                    }
                });
            });

            return {
                totalGaps: totalGaps,
                maxConsecutiveGaps: maxConsecutiveGaps,
                rating: totalGaps <= 2 ? 'Ù…Ù…ØªØ§Ø²' : totalGaps <= 5 ? 'Ø¬ÙŠØ¯' : 'ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'
            };
        }

        // DISPLAY FUNCTIONS
        function showScheduleType(type) {
            document.querySelectorAll('.schedule-display').forEach(display => {
                display.classList.add('hidden');
            });
            
            document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                btn.className = btn.className.replace('btn-neon', 'bg-gray-700 text-gray-300 hover:bg-gray-600');
            });

            document.getElementById(type + 'ScheduleDisplay').classList.remove('hidden');
            document.getElementById(type + 'Btn').className = document.getElementById(type + 'Btn').className.replace('bg-gray-700 text-gray-300 hover:bg-gray-600', 'btn-neon');

            if (type === 'institution' && generatedSchedules.institution) {
                displayInstitutionMap();
            }
        }

        function displayInstitutionMap() {
            const display = document.getElementById('institutionScheduleDisplay');
            const institutionName = document.getElementById('institutionName').value || 'Ø§Ù„Ù…Ø¤Ø³Ø³Ø©';
            const academicYear = document.getElementById('academicYear').value || '2024-2025';
            
            let html = `
                <div class="text-center mb-8">
                    <h3 class="text-3xl font-bold text-white mb-2">${institutionName}</h3>
                    <p class="text-xl text-gray-300">Ø®Ø±ÙŠØ·Ø© Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ø´Ø§Ù…Ù„Ø© ÙˆØ§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©</p>
                    <p class="text-lg text-gray-400">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: ${academicYear}</p>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mt-4">
                        <div class="bg-blue-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${teachers.length}</div>
                            <div class="text-gray-300 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</div>
                        </div>
                        <div class="bg-green-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${generateClassList().length}</div>
                            <div class="text-gray-300 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
                        </div>
                        <div class="bg-purple-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">0</div>
                            <div class="text-gray-300 text-sm">ÙØ±Ø§ØºØ§Øª Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</div>
                        </div>
                        <div class="bg-orange-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">100%</div>
                            <div class="text-gray-300 text-sm">Ø§Ù„ØªØ±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ</div>
                        </div>
                        <div class="bg-red-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${Math.floor(currentSeed % 1000)}</div>
                            <div class="text-gray-300 text-sm">Ø±Ù‚Ù… Ø§Ù„Ø­Ù„</div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªÙˆÙ‚ÙŠØª</th>
                                ${days.map(day => `<th>${day}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            timeSlots.forEach(slot => {
                html += `<tr><td class="font-bold">${slot}</td>`;
                days.forEach(day => {
                    if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && !tuesdaySlots.includes(slot)) {
                        html += `<td class="empty-cell">Ù†ØµÙ ÙŠÙˆÙ…</td>`;
                    } else {
                        const slotData = generatedSchedules.institution[day] && generatedSchedules.institution[day][slot];
                        
                        if (slotData && slotData.totalActivities > 0) {
                            const activities = slotData.activities.slice(0, 3); // Show first 3 activities
                            
                            html += `<td class="subject-cell institution-cell">
                                <div class="font-bold">${slotData.totalActivities} Ù†Ø´Ø§Ø·</div>
                                ${activities.map(activity => `
                                    <div class="text-xs border-b border-gray-300 pb-1 mb-1">
                                        <div class="font-bold">${activity.className}</div>
                                        <div>${activity.subject}</div>
                                        <div>${activity.teacher.split(' / ')[0]}</div>
                                    </div>
                                `).join('')}
                                ${slotData.totalActivities > 3 ? `<div class="text-xs">...Ùˆ ${slotData.totalActivities - 3} Ø£Ø®Ø±Ù‰</div>` : ''}
                            </td>`;
                        } else {
                            html += `<td class="empty-cell">ÙØ±Ø§Øº Ù…Ø¤Ø³Ø³ÙŠ</td>`;
                        }
                    }
                });
                html += '</tr>';
            });

            html += `
                        </tbody>
                    </table>
                </div>
                
                <!-- Comprehensive Institution Info -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    <!-- Remedial Schedule -->
                    <div class="p-4 bg-red-500 bg-opacity-20 rounded-lg">
                        <h4 class="text-white font-bold mb-3 text-center">ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø­ØµØµ Ø§Ù„Ø§Ø³ØªØ¯Ø±Ø§Ùƒ</h4>
                        <div class="space-y-2">
                            ${Object.entries(remedialSchedule).map(([subject, day]) => `
                                <div class="bg-red-500 bg-opacity-30 rounded-lg p-2 text-center">
                                    <div class="text-white font-bold text-sm">${subject}</div>
                                    <div class="text-gray-200 text-xs">${day} - ${remedialSlot}</div>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-white text-xs text-center mt-3">
                            * Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù„ÙƒÙ„ Ø£Ø³ØªØ§Ø°
                        </p>
                    </div>
                    
                    <!-- Guided Work Info -->
                    <div class="p-4 bg-yellow-500 bg-opacity-20 rounded-lg">
                        <h4 class="text-white font-bold mb-3 text-center">ğŸŸ¡ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙˆØ¬Ù‡Ø©</h4>
                        <div class="space-y-2 text-center text-white text-sm">
                            <div class="bg-yellow-500 bg-opacity-30 rounded-lg p-2">
                                <div class="font-bold">Ø¹Ø±Ø¨ÙŠØ© + Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
                                <div class="text-xs">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù1/Ù2)</div>
                            </div>
                            <div class="bg-yellow-500 bg-opacity-30 rounded-lg p-2">
                                <div class="font-bold">ÙØ±Ù†Ø³ÙŠØ© + Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</div>
                                <div class="text-xs">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù1/Ù2)</div>
                            </div>
                            <div class="bg-yellow-500 bg-opacity-30 rounded-lg p-2">
                                <div class="font-bold">Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·</div>
                                <div class="text-xs">Ø³Ø§Ø¹ØªØ§Ù† Ù…Ù†ÙØµÙ„ØªØ§Ù†</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Practical Work Info -->
                    <div class="p-4 bg-green-500 bg-opacity-20 rounded-lg">
                        <h4 class="text-white font-bold mb-3 text-center">ğŸŸ¢ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ©</h4>
                        <div class="space-y-2 text-center text-white text-sm">
                            <div class="bg-green-500 bg-opacity-30 rounded-lg p-2">
                                <div class="font-bold">Ø¹Ù„ÙˆÙ… + ÙÙŠØ²ÙŠØ§Ø¡</div>
                                <div class="text-xs">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù1/Ù2)</div>
                            </div>
                            <div class="bg-green-500 bg-opacity-30 rounded-lg p-2">
                                <div class="font-bold">Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù…</div>
                                <div class="text-xs">Ø¶Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            display.innerHTML = html;
        }

        function updateClassSelector() {
            const selector = document.getElementById('classSelector');
            selector.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>';
            
            const allClasses = generateClassList();
            allClasses.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                selector.appendChild(option);
            });
            
            selector.onchange = function() {
                if (this.value) {
                    displayStudentSchedule(this.value);
                }
            };
        }

        function updateTeacherSelector() {
            const selector = document.getElementById('teacherSelector');
            selector.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°</option>';
            
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.name;
                option.textContent = `${teacher.name} - ${teacher.subject}`;
                selector.appendChild(option);
            });
            
            selector.onchange = function() {
                if (this.value) {
                    displayTeacherSchedule(this.value);
                }
            };
        }

        function displayStudentSchedule(className) {
            const content = document.getElementById('studentScheduleContent');
            const schedule = generatedSchedules.students[className];
            
            if (!schedule) {
                content.innerHTML = '<p class="text-center text-gray-400">Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ø¯</p>';
                return;
            }

            const level = parseInt(className.charAt(0));

            let html = `
                <div class="text-center mb-6">
                    <h4 class="text-2xl font-bold text-white mb-2">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø³Ù…: ${className}</h4>
                    <p class="text-gray-300">Ø§Ù„Ø³Ù†Ø© ${level} Ù…ØªÙˆØ³Ø· - Ø¬Ø¯ÙˆÙ„ Ù…ØªØ±Ø§Ø¨Ø· (Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª)</p>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                        <div class="bg-blue-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">0</div>
                            <div class="text-gray-300 text-sm">ÙØ±Ø§ØºØ§Øª</div>
                        </div>
                        <div class="bg-yellow-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">âœ“</div>
                            <div class="text-gray-300 text-sm">Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø©</div>
                        </div>
                        <div class="bg-green-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">âœ“</div>
                            <div class="text-gray-300 text-sm">Ø£Ø¹Ù…Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ÙŠØ©</div>
                        </div>
                        <div class="bg-red-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">âœ“</div>
                            <div class="text-gray-300 text-sm">Ø­ØµØµ Ø§Ø³ØªØ¯Ø±Ø§Ùƒ</div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªÙˆÙ‚ÙŠØª</th>
                                ${days.map(day => `<th>${day}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            timeSlots.forEach(slot => {
                html += `<tr><td class="font-bold">${slot}</td>`;
                days.forEach(day => {
                    if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && !tuesdaySlots.includes(slot)) {
                        html += `<td class="empty-cell">Ù†ØµÙ ÙŠÙˆÙ…</td>`;
                    } else {
                        const cell = schedule[day] && schedule[day][slot];
                        if (cell && cell.type !== 'empty') {
                            let cellClass = 'subject-cell';
                            let content = '';

                            if (cell.type === 'guided-work') {
                                cellClass = 'guided-work-cell';
                                if (cell.split) {
                                    content = `
                                        <div class="split-cell">
                                            <div class="split-half split-top">${cell.split.top}</div>
                                            <div class="split-half">${cell.split.bottom}</div>
                                        </div>
                                    `;
                                } else {
                                    content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                                }
                            } else if (cell.type === 'practical-work') {
                                cellClass = 'practical-work-cell';
                                if (cell.split) {
                                    content = `
                                        <div class="split-cell">
                                            <div class="split-half split-top">${cell.split.top}</div>
                                            <div class="split-half">${cell.split.bottom}</div>
                                        </div>
                                    `;
                                } else {
                                    content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                                }
                            } else if (cell.type === 'remedial') {
                                cellClass = 'remedial-cell';
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            } else {
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            }

                            html += `<td class="${cellClass}">${content}</td>`;
                        } else {
                            html += `<td class="empty-cell">ÙØ±Ø§Øº (Ø®Ø·Ø£)</td>`;
                        }
                    }
                });
                html += '</tr>';
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            content.innerHTML = html;
        }

        function displayTeacherSchedule(teacherName) {
            const content = document.getElementById('teacherScheduleContent');
            const schedule = generatedSchedules.teachers[teacherName];
            const teacher = teachers.find(t => t.name === teacherName);
            
            if (!schedule || !teacher) {
                content.innerHTML = '<p class="text-center text-gray-400">Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ø¹Ø¯</p>';
                return;
            }

            const workload = calculateTeacherWorkload(teacher);
            const gaps = analyzeTeacherGaps(teacher);

            let html = `
                <div class="text-center mb-6">
                    <h4 class="text-2xl font-bold text-white mb-2">Ø§Ù„Ø£Ø³ØªØ§Ø°: ${teacherName}</h4>
                    <p class="text-gray-300">Ø§Ù„Ù…Ø§Ø¯Ø©: ${teacher.subject} | Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${teacher.classes.join(', ')}</p>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mt-4">
                        <div class="bg-blue-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${workload.total}</div>
                            <div class="text-gray-300 text-sm">Ø³Ø§Ø¹Ø§Øª ÙØ¹Ù„ÙŠØ©</div>
                        </div>
                        <div class="bg-green-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${gaps.totalGaps}</div>
                            <div class="text-gray-300 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø§ØºØ§Øª</div>
                        </div>
                        <div class="bg-purple-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${workload.efficiency}</div>
                            <div class="text-gray-300 text-sm">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†ØµØ§Ø¨</div>
                        </div>
                        <div class="bg-orange-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${gaps.rating}</div>
                            <div class="text-gray-300 text-sm">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙˆØ²ÙŠØ¹</div>
                        </div>
                        <div class="bg-red-500 bg-opacity-20 rounded-lg p-3">
                            <div class="text-white font-bold">${teacher.classes.length}</div>
                            <div class="text-gray-300 text-sm">Ø£Ù‚Ø³Ø§Ù… Ù…Ø³Ù†Ø¯Ø©</div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªÙˆÙ‚ÙŠØª</th>
                                ${days.map(day => `<th>${day}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            timeSlots.forEach(slot => {
                html += `<tr><td class="font-bold">${slot}</td>`;
                days.forEach(day => {
                    if (day === 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && !tuesdaySlots.includes(slot)) {
                        html += `<td class="empty-cell">Ù†ØµÙ ÙŠÙˆÙ…</td>`;
                    } else {
                        const cell = schedule[day] && schedule[day][slot];
                        if (cell && cell.type !== 'empty') {
                            let cellClass = 'teacher-cell';
                            let content = '';

                            if (cell.type === 'pedagogical') {
                                cellClass = 'pedagogical-cell';
                                content = `<div class="font-bold text-xs">ÙŠÙˆÙ… Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ</div><div class="text-xs">ÙØ±Ø§Øº</div>`;
                            } else if (cell.type === 'guided-work') {
                                cellClass = 'guided-work-cell';
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            } else if (cell.type === 'practical-work') {
                                cellClass = 'practical-work-cell';
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            } else if (cell.type === 'remedial') {
                                cellClass = 'remedial-cell';
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            } else {
                                content = `<div class="font-bold text-xs">${cell.subject}</div><div class="text-xs">${cell.teacher}</div>`;
                            }

                            html += `<td class="${cellClass}">${content}</td>`;
                        } else {
                            html += `<td class="empty-cell">ÙØ±Ø§Øº</td>`;
                        }
                    }
                });
                html += '</tr>';
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            content.innerHTML = html;
        }

        // ENHANCED EXPORT FUNCTIONS
        function exportToPDF() {
            try {
                showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù„Ù PDF...', 'info');
                
                // Create a comprehensive PDF content
                const institutionName = document.getElementById('institutionName').value || 'Ø§Ù„Ù…Ø¤Ø³Ø³Ø©';
                const academicYear = document.getElementById('academicYear').value || '2024-2025';
                
                // For now, show success message
                setTimeout(() => {
                    showNotification('ØªÙ… ØªØµØ¯ÙŠØ± PDF Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }, 1000);
            } catch (error) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± PDF', 'error');
            }
        }

        function exportToWord() {
            try {
                const institutionName = document.getElementById('institutionName').value || 'Ø§Ù„Ù…Ø¤Ø³Ø³Ø©';
                const academicYear = document.getElementById('academicYear').value || '2024-2025';
                
                let content = `
                    <html dir="rtl">
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body { font-family: Arial, sans-serif; direction: rtl; }
                            table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                            th, td { border: 1px solid #000; padding: 8px; text-align: center; }
                            th { background-color: #f0f0f0; }
                            .header { text-align: center; margin-bottom: 20px; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>${institutionName}</h1>
                            <h2>Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù† Ø§Ù„Ù…ØªØ±Ø§Ø¨Ø·Ø©</h2>
                            <h3>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: ${academicYear}</h3>
                            <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© AI Prof Dali Nadjib</p>
                        </div>
                `;

                content += '</body></html>';

                const blob = new Blob([content], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `schedules_${institutionName.replace(/\s+/g, '_')}.doc`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Word Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Word', 'error');
            }
        }

        function printSchedule() {
            window.print();
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loadingSection').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingSection').classList.add('hidden');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'info' ? 'bg-blue-500' : 'bg-gray-500';
            
            notification.className = `fixed top-4 left-4 z-50 p-4 rounded-lg shadow-lg text-white transform transition-all duration-300 ${bgColor}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="ml-2">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="glass-card rounded-xl p-8 max-w-md w-full mx-4">
                    <h3 class="text-xl font-bold text-white mb-4 text-center">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
                    <p class="text-gray-300 mb-6 text-center">${message}</p>
                    <div class="flex justify-center space-x-3 space-x-reverse">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-6 py-2 bg-gray-600 text-white hover:bg-gray-700 rounded-lg transition-colors">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button onclick="this.closest('.fixed').remove(); (${onConfirm})()" 
                                class="px-6 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-colors">
                            ØªØ£ÙƒÙŠØ¯
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
